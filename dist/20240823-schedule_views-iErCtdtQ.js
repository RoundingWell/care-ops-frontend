import{Z as B,r as ie,N as ae,e as oe,s as re,b as M,J as L,x as ce,d as T,w as ue,ax as W,L as me,b5 as H,y as de,A as he,a0 as pe,bg as we,B as fe,o as ge}from"./20240823-index-BGsFU5cT.js";import{R as p,B as b,_ as h,V as f,C as D,b as A}from"./20240823-runtime-Bl8sZXuA.js";import{i as E,r as z}from"./20240823-index-CGr4Yuqt.js";import{S as K}from"./20240823-list-pages-CfUD_Jkv.js";import{A as P}from"./20240823-app-BJIi6Sv9.js";import{d as y}from"./20240823-parsePhoneNumber-DSWZu1ne.js";import"./20240823-iframe-form-DGAMwvKr.js";import{O as I,T as _e}from"./20240823-app-DINeOD2S.js";import{S as v,O as k,D as O,T as x,f as U,R as S,e as ke,a as C,C as J,b as R,c as q,F as G,d as be}from"./20240823-app-frame_app-BQvvQb2Q.js";import{P as Z}from"./20240823-sidebar_app-C72X1PEJ.js";import{P as V,a as $}from"./20240823-prelogin_views-sSsdxX8V.js";import{a as F}from"./20240823-workspaces-BZBkQvK3.js";import{b as ve}from"./20240823-build-matchers-array-B_S9Y_KB.js";const ye={setSelectedList(t,e){return this.set({[`${this.getType()}Selected`]:t,lastSelectedIndex:e})},getSelectedList(){return B(this.get(`${this.getType()}Selected`))},isSelected(t){return!!this.getSelectedList()[t.id]},getSelected(t){const e=this.getSelectedList(),i=ie(ae(e),(u,n)=>(e[n]&&t.get(n)&&u.push({id:n}),u),[]);return p.request("entities",`${this.getType()}:collection`,i)},clearSelected(){this.setSelectedList({},null),this.trigger("select:none")},selectRange(t,e,i){const u=this.isSelected(e),n=t.findIndex(e),s=this.get("lastSelectedIndex");if(!i||s===null||u){this.selectOne(e.id,!u,n);return}const l=Math.min(n,s),a=Math.max(n,s),o=t.map("id").slice(l,a+1);this.selectMultiple(o,n)},selectOne(t,e,i){const u=this.getSelectedList();u[t]=e,this.setSelectedList(u,e?i:null)},selectMultiple(t,e=null){const i=this.getSelectedList(),u=t.reduce((n,s)=>(n[s]=!0,n),i);this.setSelectedList(u,e),this.trigger("select:multiple")}},X=b.Model.extend({defaults(){return{actionBeingEdited:null,lastSelectedIndex:null,actionsSelected:{}}},isBeingEdited(t){return this.get("actionBeingEdited")===t.id},getType(){return"actions"}});oe(X.prototype,ye);const Ce=X,ee=P.extend({beforeStart({actionId:t,patientId:e}){return p.request("entities","fetch:actions:model",t)},onFail(){p.request("alert","show:error",E.patients.patient.actionApp.notFound),this.stop()},onStart(t,e){const i=p.request("sidebar","start","action",{action:e});this.listenTo(i,"stop",this.stop)}}),Oe=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=t.lambda,o=t.escapeExpression,r=e??(t.nullContext||{}),d=t.hooks.helperMissing,c="function",m=t.lookupProperty||function(w,g){if(Object.prototype.hasOwnProperty.call(w,g))return w[g]};return'<div class="flex"><h4 class="sidebar__label u-margin--t-8">'+o(a((s=(s=(s=(s=(s=(s=n&&m(n,"intl"))&&m(s,"patients"))&&m(s,"shared"))&&m(s,"bulkEdit"))&&m(s,"bulkEditViews"))&&m(s,"bulkEditActionBodyTemplate"))&&m(s,"stateLabel"),e))+`</h4><div class="flex-grow" data-state-region></div></div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+o(a((s=(s=(s=(s=(s=(s=n&&m(n,"intl"))&&m(s,"patients"))&&m(s,"shared"))&&m(s,"bulkEdit"))&&m(s,"bulkEditViews"))&&m(s,"bulkEditActionBodyTemplate"))&&m(s,"ownerLabel"),e))+`</h4><div class="flex-grow" data-owner-region></div></div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+o(a((s=(s=(s=(s=(s=(s=n&&m(n,"intl"))&&m(s,"patients"))&&m(s,"shared"))&&m(s,"bulkEdit"))&&m(s,"bulkEditViews"))&&m(s,"bulkEditActionBodyTemplate"))&&m(s,"dueDateLabel"),e))+`</h4>
  <div class="flex flex-grow">`+o((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:d,typeof l===c?l.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:4,column:30},end:{line:4,column:55}}}):l))+'<div class="flex-grow" data-due-date-region></div>'+o((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:d,typeof l===c?l.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:5,column:54},end:{line:5,column:79}}}):l))+'<div class="flex-grow" data-due-time-region></div>'+o((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:d,typeof l===c?l.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:54},end:{line:6,column:79}}}):l))+`</div>
</div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+o(a((s=(s=(s=(s=(s=(s=n&&m(n,"intl"))&&m(s,"patients"))&&m(s,"shared"))&&m(s,"bulkEdit"))&&m(s,"bulkEditViews"))&&m(s,"bulkEditActionBodyTemplate"))&&m(s,"durationLabel"),e))+`</h4><div class="flex-grow" data-duration-region></div></div>
`},useData:!0}),xe=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return'<div class="flex"><h4 class="sidebar__label u-margin--t-8">'+a(l((s=(s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"shared"))&&o(s,"bulkEdit"))&&o(s,"bulkEditViews"))&&o(s,"bulkEditFlowBodyTemplate"))&&o(s,"stateLabel"),e))+`</h4><div class="flex-grow" data-state-region></div></div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+a(l((s=(s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"shared"))&&o(s,"bulkEdit"))&&o(s,"bulkEditViews"))&&o(s,"bulkEditFlowBodyTemplate"))&&o(s,"ownerLabel"),e))+`</h4><div class="flex-grow" data-owner-region></div></div>
<div class="flex u-margin--t-8 u-margin--b-8"><h4 class="sidebar__label u-margin--t-8"></h4><div class="flex-grow" data-apply-owner-region></div></div>
`},useData:!0}),_=E.patients.shared.bulkEdit.bulkEditViews;function Y(t,e){if(!t)return!1;const i=y(e?`${t} ${e}`:t);return i.isBefore(y(),"day")||i.isBefore(y(),"minute")}const N=v.extend({onPicklistSelect({model:t}){if(t.isDone()&&this.getOption("flows")){this.shouldSelectDone(t);return}this.setSelectedStatus(t)},shouldSelectDone(t){const e=this.getOption("flows");if(!re(e.invoke("isAllDone"),n=>!n)){this.setSelectedStatus(t);return}if(this.popRegion.empty(),p.request("settings","get","require_done_flow")){p.request("modal","show:small",{bodyText:_.flowsStateComponent.requireDoneModal.bodyText,headingText:_.flowsStateComponent.requireDoneModal.headingText,submitText:_.flowsStateComponent.requireDoneModal.submitText,cancelText:!1,buttonClass:"button--blue"});return}const u=p.request("modal","show:small",{bodyText:_.flowsStateComponent.doneModal.bodyText,headingText:_.flowsStateComponent.doneModal.headingText,submitText:_.flowsStateComponent.doneModal.submitText,onSubmit:()=>{this.setSelectedStatus(t),u.destroy()}})},setSelectedStatus(t){this.setState("selected",t),this.popRegion.empty()}}),De=f.extend({template:h.template({1:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return"        "+t.escapeExpression((o(i,"formatMessage")||e&&o(e,"formatMessage")||a).call(l,(o(i,"intlGet")||e&&o(e,"intlGet")||a).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkEditButtonView.editFlows",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:25},end:{line:4,column:104}}}),{name:"formatMessage",hash:{itemCount:(s=e!=null?o(e,"items"):e)!=null?o(s,"length"):s},data:n,loc:{start:{line:4,column:8},end:{line:4,column:129}}}))+`
`},3:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return"        "+t.escapeExpression((o(i,"formatMessage")||e&&o(e,"formatMessage")||a).call(l,(o(i,"intlGet")||e&&o(e,"intlGet")||a).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkEditButtonView.editActions",{name:"intlGet",hash:{},data:n,loc:{start:{line:6,column:25},end:{line:6,column:106}}}),{name:"formatMessage",hash:{itemCount:(s=e!=null?o(e,"items"):e)!=null?o(s,"length"):s},data:n,loc:{start:{line:6,column:8},end:{line:6,column:131}}}))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
   <button class="button--blue js-bulk-edit">
`+((s=l(i,"if").call(e??(t.nullContext||{}),e!=null?l(e,"isFlowList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(3,n,0),data:n,loc:{start:{line:3,column:6},end:{line:7,column:13}}}))!=null?s:"")+`    </button>
    <span class="button--text js-cancel">`+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"shared"))&&l(s,"bulkEdit"))&&l(s,"bulkEditViews"))&&l(s,"bulkEditButtonView"))&&l(s,"cancel"),e))+`</span>
  `},useData:!0}),templateContext(){return{isFlowList:this.getOption("isFlowType")}},triggers:{"click .js-cancel":"click:cancel","click .js-bulk-edit":"click:edit"}}),Ee=f.extend({className:"modal__header--sidebar",template:h.template({1:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return'<button class="button--icon u-margin--r-8 js-menu">'+t.escapeExpression((s(i,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"ellipsis",{name:"far",hash:{},data:n,loc:{start:{line:7,column:76},end:{line:7,column:94}}}))+"</button>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
    <div class="flex">
      <div class="flex-grow">
      <h3 class="sidebar__heading">`+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(l,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkEditActionsHeaderView.headingText",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:52},end:{line:4,column:140}}}),{name:"formatMessage",hash:{itemCount:(s=e!=null?r(e,"items"):e)!=null?r(s,"length"):s},data:n,loc:{start:{line:4,column:35},end:{line:4,column:165}}}))+`</h3>
      </div>
      <div>
        `+((s=r(i,"if").call(l,e!=null?r(e,"isDevelop"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:7,column:8},end:{line:7,column:110}}}))!=null?s:"")+`
        <button class="button--icon js-close">`+o((r(i,"far")||e&&r(e,"far")||a).call(l,"xmark",{name:"far",hash:{},data:n,loc:{start:{line:8,column:46},end:{line:8,column:61}}}))+`</button>
      </div>
    </div>
  `},useData:!0}),templateContext(){return{isDevelop:!1}},triggers:{"click @ui.menu":"click:menu"},ui:{menu:".js-menu"},onClickMenu(){const t=this.collection.length,e=new b.Collection([{onSelect:M(this.triggerMethod,this,"confirm:delete")}]);new I({ui:this.ui.menu,uiView:this,headingText:_.bulkEditActionsHeaderView.menuOptions.headingText,itemTemplate:h.template({compiler:[8,">= 4.3.0"],main:function(u,n,s,l,a){var o=n??(u.nullContext||{}),r=u.hooks.helperMissing,d=u.escapeExpression,c=u.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return d((c(s,"far")||n&&c(n,"far")||r).call(o,"trash-can",{name:"far",hash:{classes:"sidebar__delete-icon"},data:a,loc:{start:{line:1,column:0},end:{line:1,column:50}}}))+"<span>"+d((c(s,"formatMessage")||n&&c(n,"formatMessage")||r).call(o,(c(s,"intlGet")||n&&c(n,"intlGet")||r).call(o,"patients.shared.bulkEdit.bulkEditViews.bulkEditActionsHeaderView.menuOptions.delete",{name:"intlGet",hash:{},data:a,loc:{start:{line:1,column:73},end:{line:1,column:168}}}),{name:"formatMessage",hash:{itemCount:n!=null?c(n,"itemCount"):n},data:a,loc:{start:{line:1,column:56},end:{line:1,column:190}}}))+"</span>"},useData:!0}),itemTemplateContext:{itemCount:t},lists:[{collection:e}],align:"right",popWidth:248}).show()},onConfirmDelete(){const t=p.request("modal","show:small",{bodyText:_.confirmDeleteActionsModal.bodyText,headingText:_.confirmDeleteActionsModal.headingText,submitText:_.confirmDeleteActionsModal.submitText,buttonClass:"button--red",onSubmit:()=>{t.destroy(),this.triggerMethod("delete",this.collection)}})}}),Bt=f.extend({className:"modal__header--sidebar",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
    <div class="flex">
      <div class="flex-grow">
        <h3 class="sidebar__heading">`+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(l,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkEditFlowsHeaderView.headingText",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:54},end:{line:4,column:140}}}),{name:"formatMessage",hash:{itemCount:(s=e!=null?r(e,"items"):e)!=null?r(s,"length"):s},data:n,loc:{start:{line:4,column:37},end:{line:4,column:165}}}))+`</h3>
      </div>
      <div>
        <button class="button--icon u-margin--r-8 js-menu">`+o((r(i,"far")||e&&r(e,"far")||a).call(l,"ellipsis",{name:"far",hash:{},data:n,loc:{start:{line:7,column:59},end:{line:7,column:77}}}))+`</button>
        <button class="button--icon js-close">`+o((r(i,"far")||e&&r(e,"far")||a).call(l,"xmark",{name:"far",hash:{},data:n,loc:{start:{line:8,column:46},end:{line:8,column:61}}}))+`</button>
      </div>
    </div>
  `},useData:!0}),triggers:{"click @ui.menu":"click:menu"},ui:{menu:".js-menu"},onClickMenu(){const t=this.collection.length,e=new b.Collection([{onSelect:M(this.triggerMethod,this,"confirm:delete")}]);new I({ui:this.ui.menu,uiView:this,headingText:_.bulkEditFlowsHeaderView.menuOptions.headingText,itemTemplate:h.template({compiler:[8,">= 4.3.0"],main:function(u,n,s,l,a){var o=n??(u.nullContext||{}),r=u.hooks.helperMissing,d=u.escapeExpression,c=u.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return d((c(s,"far")||n&&c(n,"far")||r).call(o,"trash-can",{name:"far",hash:{classes:"sidebar__delete-icon"},data:a,loc:{start:{line:1,column:0},end:{line:1,column:50}}}))+"<span>"+d((c(s,"formatMessage")||n&&c(n,"formatMessage")||r).call(o,(c(s,"intlGet")||n&&c(n,"intlGet")||r).call(o,"patients.shared.bulkEdit.bulkEditViews.bulkEditFlowsHeaderView.menuOptions.delete",{name:"intlGet",hash:{},data:a,loc:{start:{line:1,column:73},end:{line:1,column:166}}}),{name:"formatMessage",hash:{itemCount:n!=null?c(n,"itemCount"):n},data:a,loc:{start:{line:1,column:56},end:{line:1,column:188}}}))+"</span>"},useData:!0}),itemTemplateContext:{itemCount:t},lists:[{collection:e}],align:"right",popWidth:248}).show()},onConfirmDelete(){const t=p.request("modal","show:small",{bodyText:_.confirmDeleteFlowsModal.bodyText,headingText:_.confirmDeleteFlowsModal.headingText,submitText:_.confirmDeleteFlowsModal.submitText,buttonClass:"button--red",onSubmit:()=>{t.destroy(),this.triggerMethod("delete",this.collection)}})}}),Pe=f.extend({modelEvents:{"change:stateMulti":"showState","change:ownerMulti":"showOwner","change:dateMulti":"showDueDateTime","change:date":"showDueDateTime","change:timeMulti":"showDueTime","change:durationMulti":"showDuration"},className:"modal__content--sidebar",template:Oe,regions:{state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",duration:"[data-duration-region]"},onRender(){this.showState(),this.showOwner(),this.showDueDateTime(),this.showDuration()},getStateComponent(){return this.model.get("stateMulti")?new v({viewOptions:{className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.escapeExpression,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return l((a(i,"fas")||e&&a(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"circle-dot",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:20}}}))+'<span class="button__value--indeterminate">'+l(t.lambda((s=(s=(s=(s=(s=n&&a(n,"intl"))&&a(s,"patients"))&&a(s,"shared"))&&a(s,"bulkEdit"))&&a(s,"bulkEditViews"))&&a(s,"bulkStateDefaultText"),e))+"</span>"},useData:!0})}}):new v({stateId:this.model.get("stateId")})},getOwnerComponent(){const t=this.model.someComplete();return this.model.get("ownerMulti")?new k({viewOptions:{attributes:{disabled:t},className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(e,i,u,n,s){var l,a=e.escapeExpression,o=e.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(u,"far")||i&&o(i,"far")||e.hooks.helperMissing).call(i??(e.nullContext||{}),"circle-user",{name:"far",hash:{},data:s,loc:{start:{line:1,column:0},end:{line:1,column:21}}}))+'<span class="button__value--indeterminate">'+a(e.lambda((l=(l=(l=(l=(l=s&&o(s,"intl"))&&o(l,"patients"))&&o(l,"shared"))&&o(l,"bulkEdit"))&&o(l,"bulkEditViews"))&&o(l,"bulkOwnerDefaultText"),i))+"</span>"},useData:!0})}}):new k({owner:this.model.get("owner"),workspaces:this.model.get("workspaces"),state:{isDisabled:t}})},getDueDateComponent(){const t=this.model.someComplete();if(this.model.get("dateMulti"))return new O({state:{isDisabled:t},viewOptions:{attributes:{disabled:t},tagName:"button",className:"button-secondary w-100 due-component",triggers:{click:"click"},template:h.template({compiler:[8,">= 4.3.0"],main:function(i,u,n,s,l){var a,o=i.escapeExpression,r=i.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return o((r(n,"far")||u&&r(u,"far")||i.hooks.helperMissing).call(u??(i.nullContext||{}),"calendar-days",{name:"far",hash:{},data:l,loc:{start:{line:1,column:0},end:{line:1,column:23}}}))+'<span class="button__value--indeterminate">'+o(i.lambda((a=(a=(a=(a=(a=l&&r(l,"intl"))&&r(a,"patients"))&&r(a,"shared"))&&r(a,"bulkEdit"))&&r(a,"bulkEditViews"))&&r(a,"bulkDueDateDefaultText"),u))+"</span>"},useData:!0})}});const e=Y(this.model.get("date"));return new O({date:this.model.get("date"),state:{isDisabled:t},isOverdue:e})},getDueTimeComponent(){if(this.model.get("timeMulti"))return new x({viewOptions:{attributes:{disabled:this.model.get("dateMulti")||this.model.someComplete()},className:"button-secondary time-component w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(u,n,s,l,a){var o,r=u.escapeExpression,d=u.lookupProperty||function(c,m){if(Object.prototype.hasOwnProperty.call(c,m))return c[m]};return r((d(s,"far")||n&&d(n,"far")||u.hooks.helperMissing).call(n??(u.nullContext||{}),"clock",{name:"far",hash:{},data:a,loc:{start:{line:1,column:0},end:{line:1,column:15}}}))+' <span class="button__value--indeterminate">'+r(u.lambda((o=(o=(o=(o=(o=a&&d(a,"intl"))&&d(o,"patients"))&&d(o,"shared"))&&d(o,"bulkEdit"))&&d(o,"bulkEditViews"))&&d(o,"bulkDueTimeDefaultText"),n))+"</span>"},useData:!0})}});const t=this.model.get("time"),e=this.model.get("dateMulti")&&!t||!this.model.get("date")||this.model.someComplete(),i=Y(this.model.get("date"),t);return new x({time:t,state:{isDisabled:e},isOverdue:i})},getDurationComponent(){const t=this.model.someComplete();return this.model.get("durationMulti")?new U({viewOptions:{className:"button-secondary w-100",attributes:{disabled:t},template:h.template({compiler:[8,">= 4.3.0"],main:function(e,i,u,n,s){var l,a=e.escapeExpression,o=e.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(u,"far")||i&&o(i,"far")||e.hooks.helperMissing).call(i??(e.nullContext||{}),"stopwatch",{name:"far",hash:{},data:s,loc:{start:{line:1,column:0},end:{line:1,column:19}}}))+'<span class="button__value--indeterminate">'+a(e.lambda((l=(l=(l=(l=(l=s&&o(s,"intl"))&&o(l,"patients"))&&o(l,"shared"))&&o(l,"bulkEdit"))&&o(l,"bulkEditViews"))&&o(l,"bulkDurationDefaultText"),i))+"</span>"},useData:!0})}}):new U({duration:this.model.get("duration"),state:{isDisabled:t}})},showState(){const t=this.getStateComponent();this.listenTo(t,"change:state",e=>{this.model.setState(e)}),this.showChildView("state",t)},showOwner(){const t=this.getOwnerComponent();this.listenTo(t,"change:owner",e=>{this.model.setOwner(e)}),this.showChildView("owner",t)},showDueDateTime(){this.showDueDate(),this.showDueTime()},showDueDate(){const t=this.getDueDateComponent();this.listenTo(t,"change:due",e=>{this.model.setDueDate(e)}),this.showChildView("dueDate",t)},showDueTime(){const t=this.getDueTimeComponent();this.listenTo(t,"change:time",e=>{this.model.setDueTime(e)}),this.showChildView("dueTime",t)},showDuration(){const t=this.getDurationComponent();this.listenTo(t,"change:duration",e=>{this.model.setDuration(e)}),this.showChildView("duration",t)}}),Se=f.extend({modelEvents:{"change:applyOwner":"render","change:ownerMulti":"render"},className:"u-margin--t-4 u-margin--l-16",template:h.template({1:function(t,e,i,u,n){return" disabled"},3:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-check",{name:"fas",hash:{},data:n,loc:{start:{line:3,column:24},end:{line:3,column:46}}}))},5:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fal")||e&&s(e,"fal")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square",{name:"fal",hash:{},data:n,loc:{start:{line:3,column:54},end:{line:3,column:70}}}))},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return`
    <button class="button--checkbox js-apply-owner"`+((s=a(i,"if").call(l,e!=null?a(e,"ownerMulti"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:51},end:{line:2,column:85}}}))!=null?s:"")+`>
      `+((s=a(i,"if").call(l,e!=null?a(e,"applyOwner"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.program(5,n,0),data:n,loc:{start:{line:3,column:6},end:{line:3,column:78}}}))!=null?s:"")+"<span>"+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=(s=n&&a(n,"intl"))&&a(s,"patients"))&&a(s,"shared"))&&a(s,"bulkEdit"))&&a(s,"bulkEditViews"))&&a(s,"bulkEditFlowBodyTemplate"))&&a(s,"applyOwnerLabel"),e))+`</span>
    </button>`},useData:!0}),triggers:{"click .js-apply-owner":"click:select"},onClickSelect(){this.model.set("applyOwner",!this.model.get("applyOwner"))}}),Lt=f.extend({modelEvents:{"change:stateMulti":"showState","change:ownerMulti":"showOwner"},className:"modal__content--sidebar",template:xe,regions:{state:"[data-state-region]",owner:"[data-owner-region]",applyOwner:"[data-apply-owner-region]"},onRender(){this.showState(),this.showOwner(),this.showApplyOwner()},getStateComponent(){return this.model.get("stateMulti")?new N({flows:this.collection,viewOptions:{className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.escapeExpression,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return l((a(i,"fas")||e&&a(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"circle-dot",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:20}}}))+'<span class="button__value--indeterminate">'+l(t.lambda((s=(s=(s=(s=(s=n&&a(n,"intl"))&&a(s,"patients"))&&a(s,"shared"))&&a(s,"bulkEdit"))&&a(s,"bulkEditViews"))&&a(s,"bulkStateDefaultText"),e))+"</span>"},useData:!0})}}):new N({flows:this.collection,stateId:this.model.get("stateId")})},getOwnerComponent(){const t=this.model.someComplete();return this.model.get("ownerMulti")?new k({viewOptions:{className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(e,i,u,n,s){var l,a=e.escapeExpression,o=e.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(u,"far")||i&&o(i,"far")||e.hooks.helperMissing).call(i??(e.nullContext||{}),"circle-user",{name:"far",hash:{},data:s,loc:{start:{line:1,column:0},end:{line:1,column:21}}}))+'<span class="button__value--indeterminate">'+a(e.lambda((l=(l=(l=(l=(l=s&&o(s,"intl"))&&o(l,"patients"))&&o(l,"shared"))&&o(l,"bulkEdit"))&&o(l,"bulkEditViews"))&&o(l,"bulkOwnerDefaultText"),i))+"</span>"},useData:!0})},state:{isDisabled:t}}):new k({owner:this.model.get("owner"),workspaces:this.model.get("workspaces"),state:{isDisabled:t}})},showState(){const t=this.getStateComponent();this.listenTo(t,"change:state",e=>{this.model.setState(e)}),this.showChildView("state",t)},showOwner(){const t=this.getOwnerComponent();this.listenTo(t,"change:owner",e=>{this.model.setOwner(e)}),this.showChildView("owner",t)},showApplyOwner(){this.showChildView("applyOwner",new Se({model:this.model}))}}),It=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||l).call(s,(a(i,"intlGet")||e&&a(e,"intlGet")||l).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkEditFlowsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:88}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:110}}}))},useData:!0}),Ve=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||l).call(s,(a(i,"intlGet")||e&&a(e,"intlGet")||l).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkEditActionsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:90}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:112}}}))},useData:!0}),Rt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||l).call(s,(a(i,"intlGet")||e&&a(e,"intlGet")||l).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkDeleteFlowsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:90}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:112}}}))},useData:!0}),Te=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||l).call(s,(a(i,"intlGet")||e&&a(e,"intlGet")||l).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkDeleteActionsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:92}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:114}}}))},useData:!0}),Me=b.Model.extend({initialize({collection:t}){const e=t.at(0);this.initBulkState(t,e),this.initBulkOwner(t,e),this.initBulkDueDate(t,e),this.initBulkDueTime(t,e),this.initBulkDuration(t,e)},initBulkState(t,e){const i=e.getState().id,u=t.some(n=>n.getState().id!==i);this.set({stateMulti:u,stateId:u?null:i})},initBulkOwner(t,e){const i=e.getOwner(),u=e.getProgram(),n=t.some(s=>{const l=s.getOwner().id!==i.id,a=s.getProgram().id!==u.id;return l||a});this.set({ownerMulti:n,owner:n?null:i,workspaces:u.getUserWorkspaces()})},initBulkDueDate(t,e){const i=e.get("due_date"),u=t.some(n=>n.get("due_date")!==i);this.set({dateMulti:u,date:u?null:i})},initBulkDueTime(t,e){const i=e.get("due_time"),u=t.some(n=>n.get("due_time")!==i);this.set({timeMulti:u,time:u?null:i})},initBulkDuration(t,e){const i=e.get("duration"),u=t.some(n=>n.get("duration")!==i);this.set({durationMulti:u,duration:u?null:i})},setState(t){return this.set({stateId:t.id,stateMulti:!1,stateChanged:!0})},setOwner(t){return this.set({owner:t,ownerMulti:!1,ownerChanged:!0})},setDueDate(t){return t?this.set({date:t.format("YYYY-MM-DD"),dateMulti:!1,dateChanged:!0}):this.set({date:null,time:null,dateMulti:!1,timeMulti:!1})},setDueTime(t){return this.set({time:t||null,timeMulti:!1,timeChanged:!0})},setDuration(t){return this.set({duration:t,durationMulti:!1,durationChanged:!0})},someComplete(){return this.get("collection").some(t=>t.isDone())},getData(){const{stateChanged:t,stateId:e,ownerChanged:i,owner:u,dateChanged:n,date:s,timeChanged:l,time:a,durationChanged:o,duration:r}=this.attributes,d={};return t&&(d._state=e),i&&(d._owner=ce(u,"id","type")),n&&(d.due_date=s),l&&(d.due_time=a),o&&(d.duration=r),d}}),Ae=P.extend({StateModel:Me,onStart(){const t=new Ee({collection:this.getState("collection")}),e=new Pe({model:this.getState(),collection:this.getState("collection")});this.modal=p.request("modal","show:sidebar",{headerView:t,bodyView:e,onSubmit:this.onSubmit.bind(this)}),this.listenTo(t,{delete:L(this.triggerMethod,"delete")}),this.listenTo(this.modal,{destroy:this.stop})},onSubmit(){this.modal.disableSubmit(),this.triggerMethod("save",this.getState().getData())},onStop(){this.modal.destroy()}}),Fe=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,g){if(Object.prototype.hasOwnProperty.call(w,g))return w[g]};return'<h1 class="patient-flow__name">'+r((m(i,"fas")||e&&m(e,"fas")||o).call(a,"folder-open",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:31},end:{line:1,column:52}}}))+" "+r((l=(l=m(i,"name")||(e!=null?m(e,"name"):e))!=null?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:1,column:53},end:{line:1,column:63}}}):l))+`</h1>
<table class="table-list">
  <td class="patient-flow__details">`+r((l=(l=m(i,"details")||(e!=null?m(e,"details"):e))!=null?l:o,typeof l===d?l.call(a,{name:"details",hash:{},data:n,loc:{start:{line:3,column:36},end:{line:3,column:49}}}):l))+"</td>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:3,column:54},end:{line:3,column:79}}}):l))+`<td class="patient-flow__meta">
    <span class="table-list__meta" data-state-region></span>
    <span class="table-list__meta" data-owner-region></span>
    <progress class="js-progress progress-bar patient-flow__progress" value=`+r(c((s=e!=null?m(e,"_progress"):e)!=null?m(s,"complete"):s,e))+" max="+r(c((s=e!=null?m(e,"_progress"):e)!=null?m(s,"total"):s,e))+"></progress>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:138},end:{line:7,column:163}}}):l))+`</td>
</table>
`},useData:!0}),je=h.template({1:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"<em>"+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"patient"))&&l(s,"dashboard"))&&l(s,"dashboardViews"))&&l(s,"newAction"),e))+"</em>"},3:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return'<span class="patient__action-attachment">'+t.escapeExpression((s(i,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"paperclip",{name:"far",hash:{},data:n,loc:{start:{line:17,column:65},end:{line:17,column:84}}}))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`<td class="table-list__cell table-list__item-check js-no-click"><span data-check-region></span></td>
<td class="table-list__cell">
  <span class="patient__action-icon">`+r((c(i,"far")||e&&c(e,"far")||o).call(a,e!=null?c(e,"icon"):e,{name:"far",hash:{},data:n,loc:{start:{line:3,column:37},end:{line:3,column:49}}}))+"</span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:3,column:56},end:{line:3,column:81}}}):l))+`<span class="patient__action-name">
    `+r((l=(l=c(i,"name")||(e!=null?c(e,"name"):e))!=null?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:5,column:4},end:{line:5,column:14}}}):l))+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:5,column:14},end:{line:5,column:39}}}):l))+((s=c(i,"unless").call(a,e!=null?c(e,"name"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:6,column:4},end:{line:6,column:105}}}))!=null?s:"")+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta" data-state-region></span>`+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:58},end:{line:10,column:83}}}):l))+'<span class="table-list__meta" data-owner-region></span>'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:11,column:58},end:{line:11,column:83}}}):l))+'<span class="table-list__meta">'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:12,column:33},end:{line:12,column:58}}}):l))+"<span data-due-date-region></span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:38},end:{line:13,column:63}}}):l))+"<span data-due-time-region></span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:14,column:38},end:{line:14,column:63}}}):l))+"</span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:15,column:9},end:{line:15,column:34}}}):l))+'<span class="table-list__meta" data-form-region></span>'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:57},end:{line:16,column:82}}}):l))+((s=c(i,"if").call(a,e!=null?c(e,"hasAttachments"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:17,column:2},end:{line:17,column:98}}}))!=null?s:"")+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:17,column:98},end:{line:17,column:123}}}):l))+'<span class="patient__action-ts">'+r((c(i,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:18,column:35},end:{line:18,column:78}}}))+`</span>
</td>
`},useData:!0}),Be=f.extend({initialize(){this.patient=this.model.getPatient()},className:"patient-flow__context-trail",template:h.template({1:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`      <a class="js-back patient-flow__context-link">
        `+o((r(i,"fas")||e&&r(e,"fas")||a).call(l,"chevron-left",{name:"fas",hash:{},data:n,loc:{start:{line:4,column:8},end:{line:4,column:30}}}))+o(t.lambda((s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"patient"))&&r(s,"flowViews"))&&r(s,"contextBackBtn"),e))+`
      </a>
      `+o((r(i,"fas")||e&&r(e,"fas")||a).call(l,"chevron-right",{name:"fas",hash:{},data:n,loc:{start:{line:6,column:6},end:{line:6,column:29}}}))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r="function",d=t.escapeExpression,c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`
`+((s=c(i,"if").call(a,e!=null?c(e,"hasLatestList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:4},end:{line:7,column:11}}}))!=null?s:"")+'    <a class="js-patient patient-flow__context-link">'+d((l=(l=c(i,"firstName")||(e!=null?c(e,"firstName"):e))!=null?l:o,typeof l===r?l.call(a,{name:"firstName",hash:{},data:n,loc:{start:{line:8,column:53},end:{line:8,column:68}}}):l))+" "+d((l=(l=c(i,"lastName")||(e!=null?c(e,"lastName"):e))!=null?l:o,typeof l===r?l.call(a,{name:"lastName",hash:{},data:n,loc:{start:{line:8,column:69},end:{line:8,column:83}}}):l))+"</a>"+d((c(i,"fas")||e&&c(e,"fas")||o).call(a,"chevron-right",{name:"fas",hash:{},data:n,loc:{start:{line:8,column:87},end:{line:8,column:110}}}))+d((l=(l=c(i,"name")||(e!=null?c(e,"name"):e))!=null?l:o,typeof l===r?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:8,column:110},end:{line:8,column:120}}}):l))+`
  `},useData:!0}),triggers:{"click .js-back":"click:back","click .js-patient":"click:patient"},onClickBack(){p.request("history","go:latestList")},onClickPatient(){p.trigger("event-router","patient:dashboard",this.patient.id)},templateContext(){return{hasLatestList:p.request("history","has:latestList"),firstName:this.patient.get("first_name"),lastName:this.patient.get("last_name")}}}),Le=f.extend({className:"patient-flow__header",modelEvents:{editing:"onEditing",change:"render","change:_progress":"onChangeFlowProgress"},onEditing(t){this.$el.toggleClass("is-selected",t)},template:Fe,regions:{state:"[data-state-region]",owner:"[data-owner-region]"},triggers:{click:"edit"},ui:{progress:".js-progress"},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner()},showState(){if(!this.canEdit){const e=new S({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new ke({flow:this.model,stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const u=new C({model:this.model,isCompact:!0});this.showChildView("owner",u);return}const t=this.model.isDone(),e=this.model.getProgram(),i=new k({owner:this.model.getOwner(),workspaces:e.getUserWorkspaces(),isCompact:!0,state:{isDisabled:t}});this.listenTo(i,"change:owner",u=>{this.model.saveOwner(u)}),this.showChildView("owner",i)},onChangeFlowProgress(){const t=this.model.get("_progress");this.ui.progress.attr({value:t.complete,max:t.total})}}),Ie=f.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="patient-flow__empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"patient"))&&l(s,"flowViews"))&&l(s,"emptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),Re=f.extend({className:"table-list__item",modelEvents:{change:"render",editing:"onEditing"},initialize({state:t}){this.state=t,this.listenTo(t,{"select:multiple":this.showCheck,"select:none":this.showCheck}),this.flow=this.model.getFlow(),this.listenTo(this.flow,{"change:_state":this.render})},template:je,templateContext(){return{hasForm:this.model.getForm(),icon:this.model.hasOutreach()?"share-from-square":"file-lines",hasAttachments:this.model.hasAttachments()}},tagName:"tr",regions:{check:"[data-check-region]",state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",form:"[data-form-region]"},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","flow:action",this.model.get("_flow"),this.model.id)},onEditing(t){this.state.isSelected(this.model)||this.$el.toggleClass("is-selected",t)},onRender(){const t=this.canEdit;this.canEdit=!this.flow.isDone()&&this.model.canEdit(),this.showCheck(),this.showState(),this.showOwner(),this.showDueDate(),this.showDueTime(),this.showForm(),t!==this.canEdit&&(this.canEdit||this.toggleSelected(!1),this.triggerMethod("change:canEdit"))},toggleSelected(t){this.state.isBeingEdited(this.model)||this.$el.toggleClass("is-selected",t)},showCheck(){if(!this.canEdit)return;const t=this.state.isSelected(this.model);this.toggleSelected(t);const e=new J({state:{isSelected:t}});this.listenTo(e,{select(i){this.triggerMethod("select",this,!!i.shiftKey)},"change:isSelected":this.toggleSelected}),this.showChildView("check",e)},showState(){if(!this.canEdit){const t=new S({model:this.model,isCompact:!0});this.showChildView("state",t);return}this.stateComponent=new v({stateId:this.model.get("_state"),isCompact:!0}),this.listenTo(this.stateComponent,"change:state",t=>{this.model.saveState(t)}),this.showChildView("state",this.stateComponent)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.isDone(),e=this.model.getProgram();this.ownerComponent=new k({owner:this.model.getOwner(),workspaces:e.getUserWorkspaces(),isCompact:!0,state:{isDisabled:t}}),this.listenTo(this.ownerComponent,"change:owner",i=>{this.model.saveOwner(i)}),this.showChildView("owner",this.ownerComponent)},showDueDate(){if(!this.canEdit){const e=new R({model:this.model});this.showChildView("dueDate",e);return}const t=this.model.isDone();this.dueDateComponent=new O({date:this.model.get("due_date"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()}),this.listenTo(this.dueDateComponent,"change:due",e=>{this.model.saveDueDate(e)}),this.showChildView("dueDate",this.dueDateComponent)},showDueTime(){if(!this.canEdit){const e=new q({model:this.model});this.showChildView("dueTime",e);return}const t=this.model.isDone()||!this.model.get("due_date");this.dueTimeComponent=new x({time:this.model.get("due_time"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()}),this.listenTo(this.dueTimeComponent,"change:time",e=>{this.model.saveDueTime(e)}),this.showChildView("dueTime",this.dueTimeComponent)},showForm(){this.model.getForm()&&this.showChildView("form",new G({model:this.model}))}}),qe=D.extend({className:"table-list patient-flow__list",tagName:"table",childView:Re,childViewOptions(){return{state:this.getOption("state")}},childViewTriggers:{select:"select","change:canEdit":"listItem:canEdit"},emptyView:Ie,viewComparator({model:t}){return t.get("sequence")},initialize({state:t,editableCollection:e}){this.state=t,this.editableCollection=e,this.onListItemCanEdit=T(this.onListItemCanEdit,60)},onListItemCanEdit(){this.triggerMethod("change:canEdit")},onSelect(t,e){this.state.selectRange(this.editableCollection,t.model,e)}}),Ge=f.extend({className:"patient-flow__frame",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){return`
    <div class="patient-flow__layout">
      <div data-context-trail-region></div>
      <div data-header-region></div>
      <div class="patient-flow__actions">
        <div data-select-all-region></div>
        <div data-tools-region></div>
      </div>
      <div data-action-list-region></div>
    </div>
    <div class="patient-flow__sidebar" data-sidebar-region></div>
  `},useData:!0}),regions:{contextTrail:{el:"[data-context-trail-region]",replaceElement:!0},header:"[data-header-region]",sidebar:"[data-sidebar-region]",actionList:{el:"[data-action-list-region]",regionClass:V,replaceElement:!0},tools:{el:"[data-tools-region]",replaceElement:!0},selectAll:{el:"[data-select-all-region]",replaceElement:!0}}}),Q=f.extend({tagName:"button",className:"button--checkbox u-margin--r-16",attributes(){if(this.getOption("isDisabled"))return{disabled:"disabled"}},triggers:{click:"click"},getTemplate(){return this.getOption("isSelectAll")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-check",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0}):this.getOption("isSelectNone")||this.getOption("isDisabled")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fal")||e&&s(e,"fal")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square",{name:"fal",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:16}}}))},useData:!0}):h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-minus",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0})}}),j=E.patients.shared.addWorkflow.addWorkflowViews,$e=I.extend({popWidth:248,isSelectlist:!0,placeholderText:j.addWorkflowOptlist.placeholderText,itemTemplateContext(){const t=this.model.get("itemType")==="program-actions",e=this.model.get("hasOutreach")?"share-from-square":"file-lines";return{icon:{icon:t?e:"folder",type:t?"far":"fas",classes:"add-workflow__picklist-icon"}}}}),te=f.extend({tagName:"button",className:"button-primary",headingText:j.addWorkflowOptlist.headingText,template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return o((r(i,"far")||e&&r(e,"far")||a).call(l,"circle-plus",{name:"far",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:21}}}))+"<span>"+o(t.lambda((s=(s=(s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"shared"))&&r(s,"addWorkflow"))&&r(s,"addWorkflowViews"))&&r(s,"addButtonView"))&&r(s,"label"),e))+"</span>"+o((r(i,"far")||e&&r(e,"far")||a).call(l,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:110},end:{line:1,column:130}}}))},useData:!0}),triggers:{click:"click"},onClick(){new $e({headingText:this.getOption("headingText"),ui:this.$el,uiView:this,lists:this.getOption("lists")}).show()}}),We={new:"u-text--italic",noResults:"picklist--no-results"},qt=K.extend({StateModel:Ce,routerAppName:"FlowApp",childApps:{action:ee,patient:Z,bulkEditActions:Ae},eventRoutes:{"flow:action":"showActionSidebar"},stateEvents:{"change:actionsSelected":"onChangeSelected"},onChangeSelected(){this.toggleBulkSelect()},onBeforeStart(){this.resetStateDefaults(),this.showView(new Ge)},beforeStart({flowId:t}){return[p.request("entities","fetch:flows:model",t),p.request("entities","fetch:actions:collection:byFlow",t),p.request("entities","fetch:patients:model:byFlow",t)]},onFail(){p.trigger("event-router","notFound"),this.stop()},onStart({currentRoute:t},e,i,u){this.flow=e,this.actions=i,this.editableCollection=i.clone(),this.patient=u,this.addOpts=this.getAddOpts(this.flow.getProgramFlow()),this.showChildView("contextTrail",new Be({model:this.flow})),this.listenTo(this.editableCollection,"reset",this.toggleBulkSelect),this.toggleBulkSelect(),this.showHeader(),this.showActionList(),this.showSidebar(),this.listenTo(this.actions,{"change:_state":this.onActionChangeState,destroy:this.onActionDestroy}),this.listenTo(this.flow,"change:_owner",this.onFlowChangeOwner),this.startRoute(t)},onActionChangeState(t){const{complete:e,total:i}=this.flow.get("_progress"),u=t.isDone();p.request("entities","states:model",t.previous("_state")).isDone()!==u&&this.flow.set({_progress:{complete:e+(u?1:-1),total:i}})},onActionDestroy(t){const{complete:e,total:i}=this.flow.get("_progress"),u=t.isDone();this.flow.set({_progress:{complete:e-(u?1:0),total:i-1}})},onFlowChangeOwner(t,e){if(e.type==="teams")return;const i=t.getOwner().getTeam();this.actions.each(u=>{!u.isDone()&&u.getOwner()===i&&u.set({_owner:e})})},showHeader(){const t=new Le({model:this.flow});this.listenTo(t,{edit:this.onEditFlow}),this.showChildView("header",t)},getAddOpts(t){return t.getAddableActions().map(e=>({text:e.get("name"),itemType:e.type,hasOutreach:e.hasOutreach(),onSelect:M(this.triggerMethod,this,"add:programAction",e)}))},showAdd(){this.showChildView("tools",new te({headingText:j.addActionHeadingText,lists:[{collection:new b.Collection(this.addOpts)}]}))},toggleBulkSelect(){if(this.selected=this.getState().getSelected(this.editableCollection),this.showSelectAll(),this.selected.length){this.showBulkEditButtonView();return}this.showAdd()},showBulkEditButtonView(){const t=new De({tagName:"span",collection:this.selected});this.listenTo(t,{"click:cancel":this.onClickBulkCancel,"click:edit":this.onClickBulkEdit}),this.showChildView("tools",t)},onClickBulkCancel(){this.getState().clearSelected()},onClickBulkEdit(){const t=this.startChildApp("bulkEditActions",{state:{collection:this.selected}});this.listenTo(t,{save(e){const i=this.selected.length;this.selected.save(e).then(()=>{this.showUpdateSuccess(i),t.stop(),this.getState().clearSelected()}).catch(()=>{p.request("alert","show:error",E.patients.worklist.worklistApp.bulkEditFailure),this.getState().clearSelected(),this.restart()})},delete(){const e=this.selected.length;this.selected.destroy().then(()=>{this.showDeleteSuccess(e),t.stop(),this.getState().clearSelected()})}})},showDeleteSuccess(t){p.request("alert","show:success",z(Te,{itemCount:t}))},showUpdateSuccess(t){p.request("alert","show:success",z(Ve,{itemCount:t}))},showDisabledSelectAll(){this.showChildView("selectAll",new Q({isDisabled:!0}))},showSelectAll(){if(!this.editableCollection.length){this.showDisabledSelectAll();return}const t=new Q({isSelectAll:this.selected.length===this.editableCollection.length,isSelectNone:!this.selected.length});this.listenTo(t,"click",this.onClickBulkSelect),this.showChildView("selectAll",t)},onClickBulkSelect(){if(this.selected.length===this.editableCollection.length){this.getState().clearSelected();return}this.getState().selectMultiple(this.editableCollection.map("id"))},onAddProgramAction(t){const e=t.getAction({flowId:this.flow.id});e.saveAll().then(()=>{this.actions.push(e),p.trigger("event-router","flow:action",this.flow.id,e.id)})},showActionList(){const t=new qe({collection:this.actions,editableCollection:this.editableCollection,state:this.getState()});this.listenTo(t,"change:canEdit",()=>{this.editableCollection.reset(this._getListEditable(t))}),this.showChildView("actionList",t)},_getListEditable(t){return this.flow.isDone()?[]:t.children.reduce((e,{canEdit:i,model:u})=>(i&&e.push(u),e),[])},showSidebar(){this.startChildApp("patient",{region:this.getRegion("sidebar"),patient:this.patient})},showActionSidebar(t,e){const i=this.getChildApp("action");this.listenToOnce(i,{start(u,n){this.setState("actionBeingEdited",n.id),n.trigger("editing",!0)},stop(){this.setState("actionBeingEdited",null)}}),this.startChildApp("action",{actionId:e})},onEditFlow(){p.request("sidebar","start","flow",{flow:this.flow})}}),He={"program-actions":"add:programAction","program-flows":"add:programFlow"},ze=P.extend({beforeStart(){return[p.request("entities","fetch:programs:collection"),p.request("entities","fetch:programActions:collection"),p.request("entities","fetch:programFlows:collection")]},onStart(t,e){e.comparator="name";const i=e.filter(u=>{const n=!!u.get("published_at"),s=!!u.get("archived_at");return n&&!s});e.reset(i),this.showView(new te({lists:this.getProgramsOpts(e)}))},getProgramsOpts(t){return t.map(e=>{const i=e.get("name"),u=e.getAddable(),n={itemType:"program-actions",text:j.noResultsText,isDisabled:!0};if(!u.length)return{itemClassName:We.noResults,headingText:i,collection:new b.Collection([n]),getItemSearchText:ue};const s=this.getProgramItemsOpts(u);return{headingText:i,collection:new b.Collection(s)}})},getProgramItemsOpts(t){return t.map(e=>({text:e.get("name"),itemType:e.type,hasOutreach:e.type==="program-actions"&&e.hasOutreach(),onSelect:M(this.triggerMethod,this,He[e.type],e)}))}}),Ue=h.template({1:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"<em>"+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"patient"))&&l(s,"dashboard"))&&l(s,"dashboardViews"))&&l(s,"newAction"),e))+"</em>"},3:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return'<span class="patient__action-attachment">'+t.escapeExpression((s(i,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"paperclip",{name:"far",hash:{},data:n,loc:{start:{line:16,column:65},end:{line:16,column:84}}}))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`<td class="table-list__cell">
  <span class="patient__action-icon">`+r((c(i,"far")||e&&c(e,"far")||o).call(a,e!=null?c(e,"icon"):e,{name:"far",hash:{},data:n,loc:{start:{line:2,column:37},end:{line:2,column:49}}}))+"</span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:56},end:{line:2,column:81}}}):l))+`<span class="patient__action-name">
    `+r((l=(l=c(i,"name")||(e!=null?c(e,"name"):e))!=null?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:4,column:4},end:{line:4,column:14}}}):l))+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:4,column:14},end:{line:4,column:39}}}):l))+((s=c(i,"unless").call(a,e!=null?c(e,"name"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:5,column:4},end:{line:5,column:105}}}))!=null?s:"")+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta" data-state-region></span>`+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:58},end:{line:9,column:83}}}):l))+'<span class="table-list__meta" data-owner-region></span>'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:58},end:{line:10,column:83}}}):l))+'<span class="table-list__meta">'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:11,column:33},end:{line:11,column:58}}}):l))+"<span data-due-date-region></span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:12,column:38},end:{line:12,column:63}}}):l))+"<span data-due-time-region></span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:38},end:{line:13,column:63}}}):l))+"</span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:14,column:9},end:{line:14,column:34}}}):l))+'<span class="table-list__meta" data-form-region></span>'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:15,column:57},end:{line:15,column:82}}}):l))+((s=c(i,"if").call(a,e!=null?c(e,"hasAttachments"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:16,column:2},end:{line:16,column:98}}}))!=null?s:"")+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:98},end:{line:16,column:123}}}):l))+'<span class="patient__action-ts">'+r((c(i,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:17,column:35},end:{line:17,column:78}}}))+`</span>
</td>
`},useData:!0}),Ye=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,g){if(Object.prototype.hasOwnProperty.call(w,g))return w[g]};return`<td class="table-list__cell">
  <span class="patient__flow-icon">`+r((m(i,"fas")||e&&m(e,"fas")||o).call(a,"folder",{name:"fas",hash:{},data:n,loc:{start:{line:2,column:35},end:{line:2,column:51}}}))+"</span>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:58},end:{line:2,column:83}}}):l))+'<span class="patient__action-name">'+r((l=(l=m(i,"name")||(e!=null?m(e,"name"):e))!=null?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:3,column:37},end:{line:3,column:47}}}):l))+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta">`+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:33},end:{line:6,column:58}}}):l))+'<span class="patient__flow-status action--'+r(c((s=e!=null?m(e,"stateOptions"):e)!=null?m(s,"color"):s,e))+'">'+r((m(i,"fa")||e&&m(e,"fa")||o).call(a,(s=e!=null?m(e,"stateOptions"):e)!=null?m(s,"iconType"):s,(s=e!=null?m(e,"stateOptions"):e)!=null?m(s,"icon"):s,{name:"fa",hash:{},data:n,loc:{start:{line:7,column:72},end:{line:7,column:118}}}))+"</span>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:125},end:{line:7,column:150}}}):l))+"</span>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:8,column:9},end:{line:8,column:34}}}):l))+'<span class="table-list__meta" data-owner-region></span>'+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:58},end:{line:9,column:83}}}):l))+'<progress class="progress-bar patient__flow-progress" value='+r(c((s=e!=null?m(e,"_progress"):e)!=null?m(s,"complete"):s,e))+" max="+r(c((s=e!=null?m(e,"_progress"):e)!=null?m(s,"total"):s,e))+"></progress>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:124},end:{line:10,column:149}}}):l))+'<span class="patient__action-ts">'+r((m(i,"formatDateTime")||e&&m(e,"formatDateTime")||o).call(a,e!=null?m(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:11,column:35},end:{line:11,column:78}}}))+`</span>
</td>
`},useData:!0}),Ne=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`<div>
  <span class="patient__tab--selected">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"patient"))&&o(s,"dashboard"))&&o(s,"dashboardViews"))&&o(s,"dashboardBtn"),e))+`</span>
  <button class="patient__tab js-archive">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"patient"))&&o(s,"dashboard"))&&o(s,"dashboardViews"))&&o(s,"archiveBtn"),e))+`</button>
</div>
<div class="patient__actions" data-add-workflow-region>
  <span class="button-primary">
    <span class="js-loading">
      `+a((o(i,"far")||e&&o(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"circle-plus",{name:"far",hash:{},data:n,loc:{start:{line:12,column:6},end:{line:12,column:27}}}))+`
      <span>`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"patient"))&&o(s,"dashboard"))&&o(s,"dashboardViews"))&&o(s,"actionLoading"),e))+`</span>
    </span>
  </span>
</div>
<div data-content-region></div>
`},useData:!0}),Qe=f.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="patient__empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"patient"))&&l(s,"dashboard"))&&l(s,"dashboardViews"))&&l(s,"emptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),le=A.extend({modelEvents:{editing:"onEditing",change:"onChange"},onChange(){this.view.render()},onEditing(t){this.$el.toggleClass("is-selected",t)}}),Ke=A.extend({modelEvents:{"change:_state":"onChangeState"},onChangeState(){if(this.view.model.isDone()){$({targets:this.el,delay:300,duration:500,opacity:[1,0],easing:"easeOutQuad",complete:()=>{this.view.triggerMethod("change:visible")}});return}this.$el.css({opacity:1}),this.view.triggerMethod("change:visible")}}),Je=f.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[le,Ke],regions:{state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",form:"[data-form-region]"},template:Ue,templateContext(){return{icon:this.model.hasOutreach()?"share-from-square":"file-lines",hasAttachments:this.model.hasAttachments()}},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","patient:action",this.model.get("_patient"),this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner(),this.showDueDate(),this.showDueTime(),this.showForm()},showState(){if(!this.canEdit){const e=new S({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new v({stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new k({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0});this.listenTo(e,"change:owner",i=>{this.model.saveOwner(i)}),this.showChildView("owner",e)},showDueDate(){if(!this.canEdit){const e=new R({model:this.model});this.showChildView("dueDate",e);return}const t=new O({date:this.model.get("due_date"),isCompact:!0,isOverdue:this.model.isOverdue()});this.listenTo(t,"change:due",e=>{this.model.saveDueDate(e)}),this.showChildView("dueDate",t)},showDueTime(){if(!this.canEdit){const i=new q({model:this.model});this.showChildView("dueTime",i);return}const t=!this.model.get("due_date"),e=new x({time:this.model.get("due_time"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()});this.listenTo(e,"change:time",i=>{this.model.saveDueTime(i)}),this.showChildView("dueTime",e)},showForm(){this.model.getForm()&&this.showChildView("form",new G({model:this.model}))}}),Ze=f.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[le],regions:{owner:"[data-owner-region]"},template:Ye,templateContext(){return{stateOptions:this.model.getState().get("options")}},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","flow",this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showOwner()},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new k({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0});this.listenTo(e,"change:owner",i=>{this.model.saveOwner(i)}),this.showChildView("owner",e)}}),Xe=D.extend({childViewEvents:{"change:visible":"filter"},className:"table-list patient__list",tagName:"table",childView(t){return t.type==="flows"?Ze:Je},emptyView:Qe,viewComparator(t,e){return F("desc",t.model.get("updated_at"),e.model.get("updated_at"))},viewFilter({model:t}){return!t.isDone()}}),et=f.extend({className:"flex-region patient__content",regions:{content:{el:"[data-content-region]",regionClass:V,replaceElement:!0},addWorkflow:"[data-add-workflow-region]"},ui:{loading:".js-loading"},template:Ne,triggers:{"click .js-archive":"click:archive"},onClickArchive(){p.trigger("event-router","patient:archive",this.model.id)},onRender(){$({targets:this.ui.loading[0],opacity:.5,loop:!0,easing:"easeInOutSine",duration:400,direction:"alternate"})}}),tt=P.extend({childApps:{addWorkflow:ze},onBeforeStart({patient:t}){this.currentUser=p.request("bootstrap","currentUser"),this.patient=t,this.showView(new et({model:t})),this.currentUser.can("work:own")||this.getRegion("addWorkflow").empty(),this.getRegion("content").startPreloader()},beforeStart({patient:t}){const u={state:p.request("workspace","current").getStates().groupByDone().notDone.getFilterIds()};return[p.request("entities","fetch:actions:collection:byPatient",{patientId:t.id,filter:u}),p.request("entities","fetch:flows:collection:byPatient",{patientId:t.id,filter:u})]},onStart(t,e,i){this.collection=new b.Collection([...e.models,...i.models]),this.showChildView("content",new Xe({collection:this.collection})),this.startAddWorkflow()},startAddWorkflow(){if(!this.currentUser.can("work:own"))return;const t=this.startChildApp("addWorkflow",{region:this.getRegion("addWorkflow"),patient:this.patient});this.listenTo(t,{"add:programAction":this.onAddProgramAction,"add:programFlow":this.onAddProgramFlow})},onAddProgramAction(t){const e=t.getAction({patientId:this.patient.id});e.saveAll().then(()=>{this.collection.unshift(e),p.trigger("event-router","patient:action",this.patient.id,e.id)})},onAddProgramFlow(t){const e=t.getFlow(this.patient.id);e.saveAll().then(()=>{p.trigger("event-router","flow",e.id)})}}),lt=h.template({1:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return'<span class="patient__action-attachment">'+t.escapeExpression((s(i,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"paperclip",{name:"far",hash:{},data:n,loc:{start:{line:13,column:65},end:{line:13,column:84}}}))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`<td class="table-list__cell">
  <span class="patient__action-icon">`+r((c(i,"far")||e&&c(e,"far")||o).call(a,e!=null?c(e,"icon"):e,{name:"far",hash:{},data:n,loc:{start:{line:2,column:37},end:{line:2,column:49}}}))+"</span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:56},end:{line:2,column:81}}}):l))+'<span class="patient__action-name">'+r((l=(l=c(i,"name")||(e!=null?c(e,"name"):e))!=null?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:3,column:37},end:{line:3,column:47}}}):l))+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta" data-state-region></span>`+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:58},end:{line:6,column:83}}}):l))+'<span class="table-list__meta" data-owner-region></span>'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:58},end:{line:7,column:83}}}):l))+'<span class="table-list__meta">'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:8,column:33},end:{line:8,column:58}}}):l))+"<span data-due-date-region></span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:38},end:{line:9,column:63}}}):l))+"<span data-due-time-region></span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:38},end:{line:10,column:63}}}):l))+"</span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:11,column:9},end:{line:11,column:34}}}):l))+'<span class="table-list__meta" data-form-region></span>'+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:12,column:57},end:{line:12,column:82}}}):l))+((s=c(i,"if").call(a,e!=null?c(e,"hasAttachments"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:13,column:2},end:{line:13,column:98}}}))!=null?s:"")+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:98},end:{line:13,column:123}}}):l))+'<span class="patient__action-ts">'+r((c(i,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:14,column:35},end:{line:14,column:78}}}))+"</span>"+r((l=(l=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:14,column:85},end:{line:14,column:110}}}):l))+`</td>
`},useData:!0}),st=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,g){if(Object.prototype.hasOwnProperty.call(w,g))return w[g]};return`    <td class="table-list__cell">
      <span class="patient__flow-icon">`+r((m(i,"fas")||e&&m(e,"fas")||o).call(a,"folder",{name:"fas",hash:{},data:n,loc:{start:{line:2,column:39},end:{line:2,column:55}}}))+"</span>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:62},end:{line:2,column:87}}}):l))+'<span class="patient__action-name">'+r((l=(l=m(i,"name")||(e!=null?m(e,"name"):e))!=null?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:3,column:41},end:{line:3,column:51}}}):l))+`</span>
    </td>
    <td class="table-list__cell patient__list-meta">
      <span class="table-list__meta" data-state-region></span>`+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:62},end:{line:6,column:87}}}):l))+'<span class="table-list__meta" data-owner-region></span>'+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:62},end:{line:7,column:87}}}):l))+'<progress class="progress-bar patient__flow-progress" value='+r(c((s=e!=null?m(e,"_progress"):e)!=null?m(s,"complete"):s,e))+" max="+r(c((s=e!=null?m(e,"_progress"):e)!=null?m(s,"total"):s,e))+"></progress>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:8,column:128},end:{line:8,column:153}}}):l))+'<span class="patient__action-ts">'+r((m(i,"formatDateTime")||e&&m(e,"formatDateTime")||o).call(a,e!=null?m(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:9,column:39},end:{line:9,column:82}}}))+"</span>"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:89},end:{line:9,column:114}}}):l))+`</td>
`},useData:!0}),nt=f.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="patient__empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"patient"))&&l(s,"archive"))&&l(s,"archiveViews"))&&l(s,"emptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),se=A.extend({modelEvents:{editing:"onEditing",change:"onChange"},onChange(){this.view.render()},onEditing(t){this.$el.toggleClass("is-selected",t)}}),ne=A.extend({modelEvents:{"change:_state":"onChangeState"},onChangeState(){if(!this.view.model.isDone()){$({targets:this.el,delay:300,duration:500,opacity:[1,0],easing:"easeOutQuad",complete:()=>{this.view.triggerMethod("change:visible")}});return}this.$el.css({opacity:1}),this.view.triggerMethod("change:visible")}}),it=f.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[se,ne],regions:{state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",form:"[data-form-region]"},template:lt,templateContext(){return{icon:this.model.hasOutreach()?"share-from-square":"file-lines",hasAttachments:this.model.hasAttachments()}},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","patient:action",this.model.get("_patient"),this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner(),this.showDueDay(),this.showDueTime(),this.showForm()},showState(){if(!this.canEdit){const e=new S({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new v({stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new k({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0,state:{isDisabled:!0}});this.showChildView("owner",e)},showDueDay(){if(!this.canEdit){const e=new R({model:this.model});this.showChildView("dueDate",e);return}const t=new O({date:this.model.get("due_date"),isCompact:!0,state:{isDisabled:!0},isOverdue:this.model.isOverdue()});this.showChildView("dueDate",t)},showDueTime(){if(!this.canEdit){const e=new q({model:this.model});this.showChildView("dueTime",e);return}const t=new x({time:this.model.get("due_time"),isCompact:!0,state:{isDisabled:!0},isOverdue:this.model.isOverdue()});this.showChildView("dueTime",t)},showForm(){this.model.getForm()&&this.showChildView("form",new G({model:this.model}))}}),at=f.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[se,ne],regions:{state:"[data-state-region]",owner:"[data-owner-region]"},template:st,triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","flow",this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner()},showState(){if(!this.canEdit){const e=new S({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new v({stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new k({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0,state:{isDisabled:!0}});this.showChildView("owner",e)}}),ot=D.extend({childViewEvents:{"change:visible":"filter"},className:"table-list patient__list",tagName:"table",childView(t){return t.type==="flows"?at:it},emptyView:nt,viewComparator({model:t},{model:e}){return F("desc",t.get("updated_at"),e.get("updated_at"))},viewFilter({model:t}){return t.type==="patient-events"||t.isDone()}}),rt=f.extend({className:"flex-region patient__content",regions:{content:{el:"[data-content-region]",regionClass:V,replaceElement:!0}},template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`
    <div>
      <button class="patient__tab js-dashboard">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"patient"))&&o(s,"archive"))&&o(s,"archiveViews"))&&o(s,"dashboardBtn"),e))+`</button>
      <span class="patient__tab--selected">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"patient"))&&o(s,"archive"))&&o(s,"archiveViews"))&&o(s,"archiveBtn"),e))+`</span>
    </div>
    <div data-content-region></div>
  `},useData:!0}),triggers:{"click .js-dashboard":"click:dashboard"},onClickDashboard(){p.trigger("event-router","patient:dashboard",this.model.id)}}),ct=P.extend({onBeforeStart({patient:t}){this.showView(new rt({model:t})),this.getRegion("content").startPreloader()},beforeStart({patient:t}){const u={state:p.request("workspace","current").getStates().groupByDone().done.getFilterIds()};return[p.request("entities","fetch:actions:collection:byPatient",{patientId:t.id,filter:u}),p.request("entities","fetch:flows:collection:byPatient",{patientId:t.id,filter:u})]},onStart({patient:t},e,i){this.collection=new b.Collection([...e.models,...i.models]),this.showChildView("content",new ot({collection:this.collection}))}}),ut=f.extend({className:"patient__context-trail",template:h.template({1:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`      <a class="js-back patient__context-link">
        `+o((r(i,"fas")||e&&r(e,"fas")||a).call(l,"chevron-left",{name:"fas",hash:{},data:n,loc:{start:{line:4,column:8},end:{line:4,column:30}}}))+o(t.lambda((s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"patient"))&&r(s,"patientViews"))&&r(s,"contextBackBtn"),e))+`
      </a>
      `+o((r(i,"fas")||e&&r(e,"fas")||a).call(l,"chevron-right",{name:"fas",hash:{},data:n,loc:{start:{line:6,column:6},end:{line:6,column:29}}}))+`
    `},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r="function",d=t.escapeExpression,c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`
`+((s=c(i,"if").call(a,e!=null?c(e,"hasLatestList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:4},end:{line:7,column:11}}}))!=null?s:"")+d((l=(l=c(i,"first_name")||(e!=null?c(e,"first_name"):e))!=null?l:o,typeof l===r?l.call(a,{name:"first_name",hash:{},data:n,loc:{start:{line:7,column:11},end:{line:7,column:27}}}):l))+" "+d((l=(l=c(i,"last_name")||(e!=null?c(e,"last_name"):e))!=null?l:o,typeof l===r?l.call(a,{name:"last_name",hash:{},data:n,loc:{start:{line:7,column:28},end:{line:7,column:43}}}):l))+`
  `},useData:!0}),triggers:{"click .js-back":"click:back"},modelEvents:{"change:first_name change:last_name":"render"},onClickBack(){p.request("history","go:latestList")},templateContext(){return{hasLatestList:p.request("history","has:latestList")}}}),mt=f.extend({className:"patient__frame",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){return`
    <div class="patient__layout">
        <div data-context-trail-region></div>
        <div data-content-region></div>
    </div>
    <div class="patient__sidebar" data-sidebar-region></div>
  `},useData:!0}),regions:{contextTrail:{el:"[data-context-trail-region]",replaceElement:!0},sidebar:"[data-sidebar-region]",content:{el:"[data-content-region]",regionClass:V,replaceElement:!0}},onRender(){this.showChildView("contextTrail",new ut({model:this.model}))}}),Gt=K.extend({eventRoutes(){return{"patient:dashboard":L(this.startCurrent,"dashboard"),"patient:archive":L(this.startCurrent,"archive"),"patient:action":this.startPatientAction}},childApps:{dashboard:tt,archive:ct,action:ee,patient:Z},currentAppOptions(){return{region:this.getRegion("content"),patient:this.getOption("patient")}},onBeforeStart(){this.getRegion().startPreloader()},beforeStart({patientId:t}){return p.request("entities","fetch:patients:model",t)},onFail(t,{response:e}){e.status===410&&(p.trigger("event-router","notFound"),this.stop())},onStart({currentRoute:t},e){this.patient=e,this.setView(new mt({model:e})),this.showSidebar(),this.startRoute(t),this.showView()},startPatientAction(t,e){const i=this.getChildApp("action");this.listenToOnce(i,{start(u,n){this.editActionList(n)},fail(){this.startCurrent("dashboard")}}),this.startChildApp("action",{actionId:e,patientId:t})},startActionList(t){return t.isDone()?this.startCurrent("archive"):this.startCurrent("dashboard")},editActionList(t){const e=this.getCurrent()||this.startActionList(t);if(!e.isRunning()){this.listenToOnce(e,"start",()=>{t.trigger("editing",!0)});return}t.trigger("editing",!0)},showSidebar(){this.startChildApp("patient",{region:this.getRegion("sidebar"),patient:this.patient})}}),$t=b.Model.extend({preinitialize(){const e=p.request("workspace","current").getStates(),{done:i,notDone:u}=e.groupByDone();this.states={done:i,notDone:u,all:e}},defaults(){const t=this.get("isDoneOnly"),e=this.states.done.map("id"),i=this.states.notDone.map("id");return{customFilters:{},states:t?e:i,flowStates:i}},initialize(){this.initStates(),this.setFiltersCount=T(this.setFiltersCount,30),this.on("change:customFilters change:states change:flowStates change:listType",this.setFiltersCount),this.setFiltersCount()},isFlowType(){return this.get("listType")==="flows"},initStates(){const t=this.getAvailableStates().map("id");this.set({states:W(this.get("states"),t),flowStates:W(this.get("flowStates"),t)})},getFiltersState(){return{filtersCount:this.get("filtersCount"),customFilters:this.get("customFilters"),states:this.get("states"),flowStates:this.get("flowStates")}},_isSameIds(t,e){return me(H(t),H(e))},setFiltersCount(){const{states:t,flowStates:e}=this.defaults(),i=de(he(this.get("customFilters"),pe)),u=this._isSameIds(this.get("states"),t)?0:1;if(this.isFlowType())return this.set("filtersCount",i+u);const n=this._isSameIds(this.get("flowStates"),e)?0:1;return this.set("filtersCount",i+u+n)},getAvailableStates(){return this.get("isDoneOnly")?this.states.done:this.states.all},setDefaultFilterStates(){return this.set(this.defaults())},selectStatesFilter(t,e,i="states"){const u=B(this.get(`${i}`));return e?this.set(i,[...u,t]):this.set(i,we(u,t))},selectFlowStatesFilter(t,e){return this.selectStatesFilter(t,e,"flowStates")},getFilter(t){return this.get("customFilters")[t]},setFilter(t,e){const i=B(this.get("customFilters"));return i[t]=e,this.set("customFilters",i)}}),dt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return'<span class="list__title-filter-name">'+o((s=(s=r(i,"name")||(e!=null?r(e,"name"):e))!=null?s:a,typeof s=="function"?s.call(l,{name:"name",hash:{},data:n,loc:{start:{line:1,column:38},end:{line:1,column:48}}}):s))+"</span>"+o((r(i,"far")||e&&r(e,"far")||a).call(l,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:55},end:{line:1,column:75}}}))},useData:!0}),ht=h.template({1:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return"      "+t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||l).call(s,(a(i,"intlGet")||e&&a(e,"intlGet")||l).call(s,"patients.shared.listViews.countView.flowsCount",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:22},end:{line:4,column:80}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"count"):e},data:n,loc:{start:{line:4,column:6},end:{line:4,column:98}}}))+`
`},3:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return"      "+t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||l).call(s,(a(i,"intlGet")||e&&a(e,"intlGet")||l).call(s,"patients.shared.listViews.countView.actionsCount",{name:"intlGet",hash:{},data:n,loc:{start:{line:6,column:22},end:{line:6,column:82}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"count"):e},data:n,loc:{start:{line:6,column:6},end:{line:6,column:100}}}))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
  <strong>
`+((s=l(i,"if").call(e??(t.nullContext||{}),e!=null?l(e,"isFlowList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(3,n,0),data:n,loc:{start:{line:3,column:4},end:{line:7,column:11}}}))!=null?s:"")+`  </strong>
`},useData:!0}),pt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
  <div>`+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(l,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(l,"patients.shared.listViews.countView.maximumListCount",{name:"intlGet",hash:{},data:n,loc:{start:{line:2,column:23},end:{line:2,column:87}}}),{name:"formatMessage",hash:{isFlowList:e!=null?r(e,"isFlowList"):e,totalInDb:e!=null?r(e,"totalInDb"):e,maximumCount:e!=null?r(e,"maximumCount"):e},data:n,loc:{start:{line:2,column:7},end:{line:2,column:157}}}))+`</div>
  <div>`+o(t.lambda((s=(s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"shared"))&&r(s,"listViews"))&&r(s,"countView"))&&r(s,"narrowFilters"),e))+`</div>
`},useData:!0}),wt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
  <div>
    `+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(l,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(l,"patients.shared.listViews.countView.maximumListCountNarrowed",{name:"intlGet",hash:{},data:n,loc:{start:{line:3,column:20},end:{line:3,column:92}}}),{name:"formatMessage",hash:{isFlowList:e!=null?r(e,"isFlowList"):e,maximumCount:e!=null?r(e,"maximumCount"):e,itemCount:e!=null?r(e,"count"):e},data:n,loc:{start:{line:3,column:4},end:{line:3,column:158}}}))+`
  </div>
  <div>`+o(t.lambda((s=(s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"shared"))&&r(s,"listViews"))&&r(s,"countView"))&&r(s,"narrowFilters"),e))+`</div>
`},useData:!0}),Wt=f.extend({initialize(){const t=this.getOption("isFlowList")?"flows":"actions";this.totalInDb=fe(this.collection.getMeta(t),"total")},getTemplate(){const t=this.getOption("filteredCollection");if(!this.collection||!t.length)return h.template({compiler:[8,">= 4.3.0"],main:function(u,n,s,l,a){return""},useData:!0});const e=this.collection.length<this.totalInDb,i=e&&t.length<this.collection.length;return e?i?wt:pt:ht},templateContext(){const t=this.getOption("filteredCollection");return{maximumCount:this.collection.length,count:t.length,isFlowList:!!this.getOption("isFlowList"),totalInDb:this.totalInDb}}}),ft=k.extend({align:"right",popWidth:null,viewOptions:{className:"list__title-filter-button",template:dt}}),gt=h.template({1:function(t,e,i,u,n){return`      <div class="flex u-margin--r-24" data-select-all-region></div>
`},3:function(t,e,i,u,n){return" is-reduced"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return`<div class="list-page__header">
  <div class="flex list-page__title">
    <div data-title-region></div>
    <div class="schedule__list-search" data-search-region></div>
  </div>
  <div class="list-page__filters flex">
`+((s=a(i,"unless").call(l,e!=null?a(e,"isReduced"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:7,column:4},end:{line:9,column:15}}}))!=null?s:"")+`    <div class="flex flex-align-center w-100" data-filters-region></div>
    <div class="schedule__count`+((s=a(i,"if").call(l,e!=null?a(e,"isReduced"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:11,column:31},end:{line:11,column:66}}}))!=null?s:"")+`" data-count-region></div>
    <div class="flex u-text--nowrap" data-date-filter-region></div>
  </div>
  <table class="w-100" data-table-region></table>
</div>
<div class="flex-region list-page__list" data-list-region></div>
`},useData:!0}),Ht=f.extend({className:"flex-region",template:gt,regions:{filters:"[data-filters-region]",table:"[data-table-region]",list:{el:"[data-list-region]",regionClass:V},selectAll:"[data-select-all-region]",title:{el:"[data-title-region]",replaceElement:!0},dateFilter:"[data-date-filter-region]",search:"[data-search-region]",count:"[data-count-region]"},templateContext(){return{isReduced:this.getOption("isReduced")}}}),_t=f.extend({className:"u-text--nowrap",getTemplate(){return this.getOption("owner")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||l).call(s,(a(i,"intlGet")||e&&a(e,"intlGet")||l).call(s,"patients.schedule.scheduleViews.titleLabelView.title",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:80}}}),{name:"formatMessage",hash:{owner:e!=null?a(e,"owner"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:94}}}))},useData:!0}):h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"schedule"))&&l(s,"scheduleViews"))&&l(s,"titleLabelView"))&&l(s,"label"),e))},useData:!0})},templateContext(){return{owner:this.getOption("owner")}}}),zt=f.extend({regions:{label:"[data-label-region]",owner:"[data-owner-filter-region]"},className:"flex list-page__title-filter",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=e??(t.nullContext||{}),l=t.hooks.helperMissing,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`
    <span class="list-page__title-icon">`+a((o(i,"far")||e&&o(e,"far")||l).call(s,"calendar-star",{name:"far",hash:{},data:n,loc:{start:{line:2,column:40},end:{line:2,column:63}}}))+`</span>
    <div data-label-region></div>
    <div data-owner-filter-region></div>
    <span class="list-page__header-icon js-title-info">`+a((o(i,"far")||e&&o(e,"far")||l).call(s,"circle-info",{name:"far",hash:{},data:n,loc:{start:{line:5,column:55},end:{line:5,column:76}}}))+`</span>
  `},useData:!0}),ui:{tooltip:".js-title-info"},initialize(){const t=p.request("bootstrap","currentUser");this.shouldShowDroplist=t.can("app:schedule:clinician_filter"),this.owner=this.model.getOwner()},onRender(){this.showLabel(),this.showOwnerDroplist(),new _e({message:E.patients.schedule.scheduleViews.scheduleTitleView.tooltip,uiView:this,ui:this.ui.tooltip,orientation:"vertical"})},showLabel(){const t=new _t({owner:this.shouldShowDroplist?null:this.owner.get("name")});this.showChildView("label",t)},showOwnerDroplist(){if(!this.shouldShowDroplist)return;const t=new ft({owner:this.owner,hasTeams:!1});this.listenTo(t,"change:owner",e=>{this.triggerMethod("change:owner",e)}),this.showChildView("owner",t)}}),Ut=f.extend({tagName:"button",className:"button--link-large",template:h.template({1:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"("+t.escapeExpression((s=(s=l(i,"filtersCount")||(e!=null?l(e,"filtersCount"):e))!=null?s:t.hooks.helperMissing,typeof s=="function"?s.call(e??(t.nullContext||{}),{name:"filtersCount",hash:{},data:n,loc:{start:{line:1,column:133},end:{line:1,column:149}}}):s))+")"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(i,"far")||e&&o(e,"far")||t.hooks.helperMissing).call(l,"sliders",{name:"far",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:17}}}))+"<span>"+a(t.lambda((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"schedule"))&&o(s,"scheduleViews"))&&o(s,"allFiltersButtonView"))&&o(s,"allFiltersButton"),e))+"</span> "+((s=o(i,"if").call(l,e!=null?o(e,"filtersCount"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:1,column:112},end:{line:1,column:157}}}))!=null?s:"")},useData:!0}),triggers:{click:"click"},modelEvents:{"change:filtersCount":"render"}}),Yt=f.extend({tagName:"button",className:"button--checkbox",attributes(){if(this.getOption("isDisabled"))return{disabled:"disabled"}},triggers:{click:"click"},getTemplate(){return this.getOption("isSelectAll")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-check",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0}):this.getOption("isSelectNone")||this.getOption("isDisabled")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fal")||e&&s(e,"fal")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square",{name:"fal",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:16}}}))},useData:!0}):h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-minus",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0})}}),Nt=f.extend({template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`
    <td class="schedule-list__header schedule-list__header-due-date">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"schedule"))&&o(s,"scheduleViews"))&&o(s,"tableHeaderView"))&&o(s,"dueDateHeader"),e))+`</td>
    <td class="schedule-list__header schedule-list__header-state-patient">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"schedule"))&&o(s,"scheduleViews"))&&o(s,"tableHeaderView"))&&o(s,"patientHeader"),e))+`</td>
    <td class="schedule-list__header schedule-list__header-action">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"schedule"))&&o(s,"scheduleViews"))&&o(s,"tableHeaderView"))&&o(s,"actionHeader"),e))+`</td>
    <td class="schedule-list__header schedule-list__header-form">`+a(l((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"schedule"))&&o(s,"scheduleViews"))&&o(s,"tableHeaderView"))&&o(s,"formheader"),e))+`</td>
  `},useData:!0}),tagName:"tr"}),kt=f.extend({tagName:"tr",className(){const t="schedule-list__day-list-row";return this.getOption("state").get("isReduced")?`${t} is-reduced`:t},template:h.template({1:function(t,e,i,u,n){return"is-overdue"},3:function(t,e,i,u,n){return'<span class="u-margin--r-8" data-check-region></span>'},5:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return"        "+t.escapeExpression((s(i,"formatDateTime")||e&&s(e,"formatDateTime")||t.hooks.helperMissing).call(e??(t.nullContext||{}),e!=null?s(e,"due_time"):e,"TIME",{name:"formatDateTime",hash:{inputFormat:"HH:mm:ss"},data:n,loc:{start:{line:5,column:8},end:{line:5,column:65}}}))+`&#8203;
`},7:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return'        <span class="schedule-list__no-time">'+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"schedule"))&&l(s,"scheduleViews"))&&l(s,"dayItemView"))&&l(s,"noTime"),e))+`</span>&#8203;
`},9:function(t,e,i,u,n){return"is-reduced"},11:function(t,e,i,u,n){return"js-patient"},13:function(t,e,i,u,n){return"js-action"},15:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return'<span class="js-form schedule-list__action-form-icon">'+((s=l(i,"if").call(e??(t.nullContext||{}),e!=null?l(e,"hasOutreach"):e,{name:"if",hash:{},fn:t.program(16,n,0),inverse:t.program(18,n,0),data:n,loc:{start:{line:29,column:72},end:{line:29,column:165}}}))!=null?s:"")+"</span>"},16:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"share-from-square",{name:"far",hash:{},data:n,loc:{start:{line:29,column:91},end:{line:29,column:118}}}))},18:function(t,e,i,u,n){var s=t.lookupProperty||function(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]};return t.escapeExpression((s(i,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-poll-horizontal",{name:"far",hash:{},data:n,loc:{start:{line:29,column:126},end:{line:29,column:158}}}))},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,g){if(Object.prototype.hasOwnProperty.call(w,g))return w[g]};return`
    <td class="schedule-list__action-list-cell schedule-list__due-time `+((s=m(i,"if").call(a,e!=null?m(e,"isOverdue"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:71},end:{line:2,column:105}}}))!=null?s:"")+`">
      `+((s=m(i,"unless").call(a,e!=null?m(e,"isReduced"):e,{name:"unless",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:3,column:6},end:{line:3,column:91}}}))!=null?s:"")+`
`+((s=m(i,"if").call(a,e!=null?m(e,"due_time"):e,{name:"if",hash:{},fn:t.program(5,n,0),inverse:t.program(7,n,0),data:n,loc:{start:{line:4,column:6},end:{line:8,column:13}}}))!=null?s:"")+`    </td>
    <td class="schedule-list__action-list-cell schedule-list__patient">
      <div class="schedule-list__patient-details">
        <span class="schedule-list__patient-sidebar-icon">
          <button class="js-patient-sidebar-button">
            `+r((m(i,"far")||e&&m(e,"far")||o).call(a,"address-card",{name:"far",hash:{},data:n,loc:{start:{line:14,column:12},end:{line:14,column:34}}}))+`
          </button>
        </span>&#8203;`+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:22},end:{line:16,column:47}}}):l))+'<span class="schedule-list__patient-name '+((s=m(i,"if").call(a,e!=null?m(e,"isReduced"):e,{name:"if",hash:{},fn:t.program(9,n,0),inverse:t.program(11,n,0),data:n,loc:{start:{line:17,column:49},end:{line:17,column:101}}}))!=null?s:"")+'">'+r(c((s=e!=null?m(e,"patient"):e)!=null?m(s,"first_name"):s,e))+" "+r(c((s=e!=null?m(e,"patient"):e)!=null?m(s,"last_name"):s,e))+`</span>&#8203;
      </div>
    </td>
    <td class="schedule-list__action-list-cell">
      <div class="schedule-list__action-state-name">
        <span class="schedule-list__action-state action--`+r(c((s=e!=null?m(e,"stateOptions"):e)!=null?m(s,"color"):s,e))+'">'+r((m(i,"fa")||e&&m(e,"fa")||o).call(a,(s=e!=null?m(e,"stateOptions"):e)!=null?m(s,"iconType"):s,(s=e!=null?m(e,"stateOptions"):e)!=null?m(s,"icon"):s,{name:"fa",hash:{},data:n,loc:{start:{line:22,column:83},end:{line:22,column:129}}}))+'</span><span class="schedule-list__search-helper">'+r((l=(l=m(i,"state")||(e!=null?m(e,"state"):e))!=null?l:o,typeof l===d?l.call(a,{name:"state",hash:{},data:n,loc:{start:{line:22,column:179},end:{line:22,column:190}}}):l))+"</span>&#8203;"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:22,column:204},end:{line:22,column:229}}}):l))+'<span class="'+((s=m(i,"unless").call(a,e!=null?m(e,"isReduced"):e,{name:"unless",hash:{},fn:t.program(13,n,0),inverse:t.noop,data:n,loc:{start:{line:23,column:21},end:{line:23,column:62}}}))!=null?s:"")+'">'+r((l=(l=m(i,"name")||(e!=null?m(e,"name"):e))!=null?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:n,loc:{start:{line:23,column:64},end:{line:23,column:74}}}):l))+"</span>&#8203;"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:23,column:88},end:{line:23,column:113}}}):l))+'<span class="schedule-list__search-helper">'+r((l=(l=m(i,"flow")||(e!=null?m(e,"flow"):e))!=null?l:o,typeof l===d?l.call(a,{name:"flow",hash:{},data:n,loc:{start:{line:24,column:51},end:{line:24,column:61}}}):l))+"</span>&#8203;"+r((l=(l=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?l:o,typeof l===d?l.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:24,column:75},end:{line:24,column:100}}}):l))+`</div>
    </td>
    <td class="schedule-list__action-list-cell schedule-list__action-details" data-details-region></td>
    <td class="schedule-list__action-list-cell schedule-list__action-form">
      `+((s=m(i,"if").call(a,e!=null?m(e,"form"):e,{name:"if",hash:{},fn:t.program(15,n,0),inverse:t.noop,data:n,loc:{start:{line:29,column:6},end:{line:29,column:179}}}))!=null?s:"")+`
    </td>
  `},useData:!0}),regions:{check:"[data-check-region]",details:"[data-details-region]"},templateContext(){const t=this.model.getState();return{isOverdue:this.model.isOverdue(),state:t.get("name"),stateOptions:t.get("options"),patient:this.model.getPatient().attributes,form:this.model.getForm(),flow:this.model.getFlow()&&this.model.getFlow().get("name"),hasOutreach:this.model.hasOutreach(),isReduced:this.isReduced}},ui:{actionName:".js-action"},triggers:{"click .js-form":"click:form","click .js-patient-sidebar-button":"click:patientSidebarButton","click .js-patient":"click:patient",click:"click"},modelEvents:{change:"render"},initialize({state:t}){this.state=t,this.flow=this.model.getFlow(),this.isReduced=t.get("isReduced"),this.listenTo(t,{"select:multiple":this.showCheck,"select:none":this.showCheck})},onRender(){const t=this.canEdit;this.canEdit=!this.model.isFlowDone()&&this.model.canEdit(),this.showDetailsTooltip(),this.showCheck(),t!==this.canEdit&&(this.canEdit||this.toggleSelected(!1),this.triggerMethod("change:canEdit"))},toggleSelected(t){this.$el.toggleClass("is-selected",t)},showCheck(){if(this.isReduced||!this.canEdit)return;const t=this.state.isSelected(this.model);this.toggleSelected(t);const e=new J({state:{isSelected:t}});this.listenTo(e,{select(i){this.triggerMethod("select",this,!!i.shiftKey)},"change:isSelected":this.toggleSelected}),this.showChildView("check",e)},onClickPatientSidebarButton(){const t=this.model.getPatient(),e=p.request("sidebar","start","patient",{patient:t});this.on("destroy",()=>e.stop())},onClickPatient(){p.trigger("event-router","patient:dashboard",this.model.get("_patient"))},onClickForm(){p.trigger("event-router","form:patientAction",this.model.id,this.model.getForm().id)},onClick(){if(!this.isReduced){if(this.flow){p.trigger("event-router","flow:action",this.flow.id,this.model.id);return}p.trigger("event-router","patient:action",this.model.get("_patient"),this.model.id)}},showDetailsTooltip(){this.model.get("details")&&this.showChildView("details",new be({model:this.model}))}}),bt=D.extend({childView:kt,childViewOptions(){return{state:this.state}},tagName:"tr",className:"schedule-list__list-row",template:h.template({1:function(t,e,i,u,n){return"is-today"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
    <td class="schedule-list__list-cell">
      <div class="schedule-list__row-header">
        <span class="schedule-list__date `+((s=r(i,"if").call(l,e!=null?r(e,"isToday"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:4,column:41},end:{line:4,column:71}}}))!=null?s:"")+'">'+o((r(i,"formatDateTime")||e&&r(e,"formatDateTime")||a).call(l,e!=null?r(e,"date"):e,"D",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:4,column:73},end:{line:4,column:100}}}))+`</span>
        <span class="schedule-list__month-day">`+o((r(i,"formatDateTime")||e&&r(e,"formatDateTime")||a).call(l,e!=null?r(e,"date"):e,"MMM, ddd",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:5,column:47},end:{line:5,column:81}}}))+`</span>
      </div>
      <div class="schedule-list__day-list">
        <table class="schedule-list__day-list-table w-100" data-actions-region></table>
      </div>
    </td>
  `},useData:!0}),templateContext(){const t=y(this.model.get("date")),e=y();return{isToday:t.isSame(e,"day")}},childViewContainer:"[data-actions-region]",viewComparator(t,e){return F("asc",t.model.get("due_time"),e.model.get("due_time"),"24")},initialize({state:t}){this.state=t,this.listenTo(t,"change:searchQuery",this.searchList)},onAttach(){this.searchList(null,this.state.get("searchQuery"))},childViewTriggers:{render:"listItem:render","change:canEdit":"change:canEdit",select:"select"},onSelect(t,e){this.triggerMethod("select:list:item",t,e)},onListItemRender(t){const e=y(this.model.get("date"));t.searchString=`${e.format("D")} ${e.format("MMM, ddd")} ${t.$el.text()}`},searchList(t,e){if(!e){this.removeFilter();return}const i=ve(e);this.setFilter(function({searchString:u}){return ge(i,function(n){return n.test(u)})})}}),vt=f.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="table-empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"schedule"))&&l(s,"scheduleViews"))&&l(s,"emptyView"))&&l(s,"noScheduledActions"),e))+`</h2>
    </td>
  `},useData:!0})}),yt=f.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var s,l=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="table-empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&l(n,"intl"))&&l(s,"patients"))&&l(s,"schedule"))&&l(s,"scheduleViews"))&&l(s,"emptyFindInListView"))&&l(s,"noResults"),e))+`</h2>
    </td>
  `},useData:!0})}),Qt=D.extend({tagName:"table",className:"schedule-list__table",childView:bt,childViewOptions(t){if(t)return{collection:t.get("actions"),state:this.state}},childViewTriggers:{"select:list:item":"select","change:canEdit":"listItem:canEdit"},childViewEvents:{"render:children":"onChildFilter"},emptyView(){return this.collection.length&&this.state.get("searchQuery")?yt:vt},viewComparator(t,e){return F("asc",t.model.get("date"),e.model.get("date"))},viewFilter(t){return this.isAttached()&&this.state.get("searchQuery")?!t.isEmpty():t.model.get("date")!=="null"},initialize({state:t,editableCollection:e}){this.state=t,this.editableCollection=e,this.onListItemCanEdit=T(this.onListItemCanEdit,60)},onListItemCanEdit(){this.triggerMethod("change:canEdit")},onRenderChildren(){this.setVisibleChildren()},onChildFilter:T(function(){this.filter()},10),setVisibleChildren(){const t=this.children.reduce((e,i)=>e.concat(i.children.pluck("model")),[]);this.triggerMethod("filtered",t)},onSelect(t,e){this.state.selectRange(this.editableCollection,t.model,e)}});export{Ut as A,Bt as B,Wt as C,$t as F,Ht as L,ye as M,Gt as P,Qt as S,Nt as T,zt as a,qt as b,Lt as c,ft as d,Ae as e,De as f,Rt as g,Te as h,It as i,Ve as j,Yt as k};
