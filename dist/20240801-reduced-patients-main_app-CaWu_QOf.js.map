{"version":3,"file":"20240801-reduced-patients-main_app-CaWu_QOf.js","sources":["../src/js/apps/patients/schedule/reduced-schedule/reduced_schedule_state.js","../src/js/apps/patients/schedule/reduced-schedule/reduced_schedule_app.js","../src/js/apps/patients/reduced-patients-main_app.js"],"sourcesContent":["import { extend, reduce, omit } from 'underscore';\nimport store from 'store';\nimport Backbone from 'backbone';\nimport Radio from 'backbone.radio';\nimport { NIL as NIL_UUID } from 'uuid';\n\nconst STATE_VERSION = 'v6';\n\nexport default Backbone.Model.extend({\n  defaults() {\n    return {\n      isReduced: true,\n      searchQuery: '',\n    };\n  },\n  getFiltersState() {\n    return {\n      customFilters: this.get('customFilters'),\n      states: this.get('states'),\n      flowStates: this.get('flowStates'),\n      listType: 'actions',\n    };\n  },\n  preinitialize() {\n    this.currentClinician = Radio.request('bootstrap', 'currentUser');\n    this.currentWorkspace = Radio.request('workspace', 'current');\n  },\n  initialize() {\n    this.on('change', this.onChange);\n  },\n  getStoreKey() {\n    return `reduced-schedule_${ this.currentClinician.id }_${ this.currentWorkspace.id }-${ STATE_VERSION }`;\n  },\n  getStore() {\n    return store.get(this.getStoreKey());\n  },\n  onChange() {\n    store.set(this.getStoreKey(), omit(this.attributes, 'filtersCount', 'searchQuery'));\n  },\n  setSearchQuery(searchQuery = '') {\n    return this.set({\n      searchQuery: searchQuery.length > 2 ? searchQuery : '',\n      lastSelectedIndex: null,\n    });\n  },\n  getEntityStatesFilter() {\n    return {\n      'state': this.get('states').join() || NIL_UUID,\n      'flow.state': this.get('flowStates').join() || NIL_UUID,\n    };\n  },\n  getOwner() {\n    return this.currentClinician;\n  },\n  getEntityCustomFilter() {\n    const filtersState = this.get('customFilters');\n    return reduce(filtersState, (filters, selected, slug) => {\n      if (selected !== null) filters[`@${ slug }`] = selected;\n\n      return filters;\n    }, {});\n  },\n  getEntityFilter() {\n    const filters = {\n      clinician: this.currentClinician.id,\n    };\n\n    extend(filters, this.getEntityStatesFilter());\n    extend(filters, this.getEntityCustomFilter());\n\n    return filters;\n  },\n});\n","import Radio from 'backbone.radio';\n\nimport App from 'js/base/app';\n\nimport StateModel from './reduced_schedule_state';\nimport FiltersStateModel from 'js/apps/patients/shared/filters_state';\n\nimport SearchComponent from 'js/views/shared/components/list-search';\n\nimport { CountView } from 'js/views/patients/shared/list_views';\n\nimport { LayoutView, ScheduleTitleView, TableHeaderView, ScheduleListView, AllFiltersButtonView } from 'js/views/patients/schedule/schedule_views';\n\nconst FiltersApp = App.extend({\n  StateModel: FiltersStateModel,\n});\n\nexport default App.extend({\n  StateModel,\n  childApps: {\n    filters: {\n      AppClass: FiltersApp,\n      restartWithParent: false,\n    },\n  },\n  stateEvents: {\n    'change:customFilters change:states change:flowStates': 'restart',\n    'change:searchQuery': 'onChangeSearchQuery',\n  },\n  startFiltersApp({ setDefaults } = {}) {\n    const filtersApp = this.startChildApp('filters', { state: this.getState().getFiltersState() });\n\n    const filterState = filtersApp.getState();\n\n    filtersApp.listenTo(filterState, 'change', () => {\n      this.setState(filterState.getFiltersState());\n    });\n\n    if (setDefaults) filterState.setDefaultFilterStates();\n\n    this.setState(filterState.getFiltersState());\n  },\n  onChangeSearchQuery(state) {\n    this.currentSearchQuery = state.get('searchQuery');\n  },\n  initListState() {\n    const storedState = this.getState().getStore();\n\n    this.getState().setSearchQuery(this.currentSearchQuery);\n\n    if (storedState) {\n      this.setState(storedState);\n      this.startFiltersApp();\n      return;\n    }\n\n    const currentUser = Radio.request('bootstrap', 'currentUser');\n    this.setState({ id: `reduced-schedule_${ currentUser.id }` });\n\n    this.startFiltersApp({ setDefaults: true });\n  },\n  onBeforeStart() {\n    if (this.isRestarting()) {\n      this.getRegion('count').empty();\n\n      this.getRegion('list').startPreloader();\n\n      return;\n    }\n\n    this.initListState();\n\n    this.setView(new LayoutView({\n      isReduced: this.getState('isReduced'),\n    }));\n\n    this.showSearchView();\n    this.showTableHeaders();\n    this.showScheduleTitle();\n    this.showFiltersButtonView();\n\n    this.getRegion('list').startPreloader();\n\n    this.showView();\n  },\n  onBeforeStop() {\n    this.collection = null;\n    if (!this.isRestarting()) this.stopChildApp('filters');\n  },\n  beforeStart() {\n    const filter = this.getState().getEntityFilter();\n    return Radio.request('entities', 'fetch:actions:collection', { data: { filter } });\n  },\n  onStart(options, collection) {\n    this.collection = collection;\n    this.filteredCollection = collection.clone();\n\n    this.listenTo(this.filteredCollection, 'reset', this.showCountView);\n    this.showCountView();\n\n    this.showList();\n  },\n  showList() {\n    const scheduleListView = new ScheduleListView({\n      collection: this.collection.groupByDate(),\n      state: this.getState(),\n    });\n\n    this.listenTo(scheduleListView, 'filtered', filtered => {\n      this.filteredCollection.reset(filtered);\n    });\n\n    this.showChildView('list', scheduleListView);\n  },\n  showFiltersButtonView() {\n    const filtersApp = this.getChildApp('filters');\n    const filtersState = filtersApp.getState();\n\n    const filtersButtonView = new AllFiltersButtonView({\n      model: filtersState,\n    });\n\n    this.listenTo(filtersButtonView, 'click', () => {\n      Radio.request('sidebar', 'start', 'filters', { filtersState });\n    });\n\n    this.showChildView('filters', filtersButtonView);\n  },\n  showCountView() {\n    const countView = new CountView({\n      collection: this.collection,\n      filteredCollection: this.filteredCollection,\n    });\n\n    this.showChildView('count', countView);\n  },\n  showTableHeaders() {\n    const tableHeadersView = new TableHeaderView();\n\n    this.showChildView('table', tableHeadersView);\n  },\n  showScheduleTitle() {\n    this.showChildView('title', new ScheduleTitleView({\n      model: this.getState(),\n    }));\n  },\n  showSearchView() {\n    const searchComponent = new SearchComponent({\n      state: {\n        query: this.getState('searchQuery'),\n      },\n    });\n\n    this.listenTo(searchComponent.getState(), 'change:query', (state, searchQuery) => {\n      this.getState().setSearchQuery(searchQuery);\n    });\n\n    this.showChildView('search', searchComponent);\n  },\n});\n","import RouterApp from 'js/base/routerapp';\n\nimport FlowApp from 'js/apps/patients/patient/flow/flow_app';\nimport PatientApp from 'js/apps/patients/patient/patient_app';\nimport ReducedScheduleApp from 'js/apps/patients/schedule/reduced-schedule/reduced_schedule_app';\n\nexport default RouterApp.extend({\n  routerAppName: 'PatientsApp',\n  childApps() {\n    return {\n      flow: FlowApp,\n      patient: PatientApp,\n      schedule: ReducedScheduleApp,\n    };\n  },\n\n  eventRoutes: {\n    'schedule': {\n      action: 'showSchedule',\n      route: 'schedule',\n      isList: true,\n    },\n    'patient:dashboard': {\n      action: 'showPatient',\n      route: 'patient/dashboard/:id',\n    },\n    'patient:archive': {\n      action: 'showPatient',\n      route: 'patient/archive/:id',\n    },\n    'patient:action': {\n      action: 'showPatient',\n      route: 'patient/:id/action/:id',\n    },\n    'flow': {\n      action: 'showFlow',\n      route: 'flow/:id',\n    },\n    'flow:action': {\n      action: 'showFlow',\n      route: 'flow/:id/action/:id',\n    },\n  },\n  showPatient(patientId) {\n    this.startRoute('patient', { patientId });\n  },\n  showFlow(flowId) {\n    this.startRoute('flow', { flowId });\n  },\n  showSchedule() {\n    this.startCurrent('schedule');\n  },\n});\n"],"names":["STATE_VERSION","StateModel","Backbone","Radio","store","omit","searchQuery","NIL_UUID","filtersState","reduce","filters","selected","slug","extend","FiltersApp","App","FiltersStateModel","ReducedScheduleApp","setDefaults","filtersApp","filterState","state","storedState","currentUser","LayoutView","filter","options","collection","scheduleListView","ScheduleListView","filtered","filtersButtonView","AllFiltersButtonView","countView","CountView","tableHeadersView","TableHeaderView","ScheduleTitleView","searchComponent","SearchComponent","reducedPatientsMain_app","RouterApp","FlowApp","PatientApp","patientId","flowId"],"mappings":"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"}