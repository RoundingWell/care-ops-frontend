import{Z as B,r as ie,N as ae,e as oe,s as re,b as O,J as L,x as ce,d as M,C as ue,w as me,ay as W,L as de,b6 as H,y as he,A as pe,a0 as we,bh as ge,B as fe,o as be}from"./20241010-index-BbW385wO.js";import{R as p,B as k,_ as h,V as g,C as E,b as A}from"./20241010-runtime-Ch9ZL3Ke.js";import{i as P,r as z}from"./20241010-index-BVeVz_uG.js";import{S as K}from"./20241010-list-pages-dafuHcH_.js";import{A as S}from"./20241010-app-BCN0tauN.js";import{d as y}from"./20241010-parsePhoneNumber-CS_7G5tE.js";import"./20241010-iframe-form-C3TZjyHN.js";import{O as I,T as _e}from"./20241010-app-CoUaKxH7.js";import{S as v,O as _,D as x,T as D,f as U,R as V,e as ke,a as C,C as J,b as R,c as q,F as G,d as ve}from"./20241010-app-frame_app-BVo4HqoL.js";import{P as Z}from"./20241010-sidebar_app-CegKJMLk.js";import{P as T,a as $}from"./20241010-prelogin_views-DEK_feFi.js";import{a as F}from"./20241010-workspaces-DTa7yKL1.js";import{b as ye}from"./20241010-build-matchers-array-CTiywa5I.js";const Ce={setSelectedList(t,e){return this.set({[`${this.getType()}Selected`]:t,lastSelectedIndex:e})},getSelectedList(){return B(this.get(`${this.getType()}Selected`))},isSelected(t){return!!this.getSelectedList()[t.id]},getSelected(t){const e=this.getSelectedList(),i=ie(ae(e),(u,n)=>(e[n]&&t.get(n)&&u.push({id:n}),u),[]);return p.request("entities",`${this.getType()}:collection`,i)},clearSelected(){this.setSelectedList({},null),this.trigger("select:none")},selectRange(t,e,i){const u=this.isSelected(e),n=t.findIndex(e),l=this.get("lastSelectedIndex");if(!i||l===null||u){this.selectOne(e.id,!u,n);return}const s=Math.min(n,l),a=Math.max(n,l),o=t.map("id").slice(s,a+1);this.selectMultiple(o,n)},selectOne(t,e,i){const u=this.getSelectedList();u[t]=e,this.setSelectedList(u,e?i:null)},selectMultiple(t,e=null){const i=this.getSelectedList(),u=t.reduce((n,l)=>(n[l]=!0,n),i);this.setSelectedList(u,e),this.trigger("select:multiple")}},X=k.Model.extend({defaults(){return{actionBeingEdited:null,lastSelectedIndex:null,actionsSelected:{}}},isBeingEdited(t){return this.get("actionBeingEdited")===t.id},getType(){return"actions"}});oe(X.prototype,Ce);const ee=S.extend({beforeStart({actionId:t,patientId:e}){return p.request("entities","fetch:actions:model",t)},onFail(){p.request("alert","show:error",P.patients.patient.actionApp.notFound),this.stop()},onStart(t,e){const i=p.request("sidebar","start","action",{action:e});this.listenTo(i,"stop",this.stop)}}),Oe=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=t.lambda,o=t.escapeExpression,r=e??(t.nullContext||{}),d=t.hooks.helperMissing,c="function",m=t.lookupProperty||function(w,f){if(Object.prototype.hasOwnProperty.call(w,f))return w[f]};return'<div class="flex"><h4 class="sidebar__label u-margin--t-8">'+o(a((l=(l=(l=(l=(l=(l=n&&m(n,"intl"))&&m(l,"patients"))&&m(l,"shared"))&&m(l,"bulkEdit"))&&m(l,"bulkEditViews"))&&m(l,"bulkEditActionBodyTemplate"))&&m(l,"stateLabel"),e))+`</h4><div class="flex-grow" data-state-region></div></div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+o(a((l=(l=(l=(l=(l=(l=n&&m(n,"intl"))&&m(l,"patients"))&&m(l,"shared"))&&m(l,"bulkEdit"))&&m(l,"bulkEditViews"))&&m(l,"bulkEditActionBodyTemplate"))&&m(l,"ownerLabel"),e))+`</h4><div class="flex-grow" data-owner-region></div></div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+o(a((l=(l=(l=(l=(l=(l=n&&m(n,"intl"))&&m(l,"patients"))&&m(l,"shared"))&&m(l,"bulkEdit"))&&m(l,"bulkEditViews"))&&m(l,"bulkEditActionBodyTemplate"))&&m(l,"dueDateLabel"),e))+`</h4>
  <div class="flex flex-grow">`+o((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:d,typeof s===c?s.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:4,column:30},end:{line:4,column:55}}}):s))+'<div class="flex-grow" data-due-date-region></div>'+o((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:d,typeof s===c?s.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:5,column:54},end:{line:5,column:79}}}):s))+'<div class="flex-grow" data-due-time-region></div>'+o((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:d,typeof s===c?s.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:54},end:{line:6,column:79}}}):s))+`</div>
</div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+o(a((l=(l=(l=(l=(l=(l=n&&m(n,"intl"))&&m(l,"patients"))&&m(l,"shared"))&&m(l,"bulkEdit"))&&m(l,"bulkEditViews"))&&m(l,"bulkEditActionBodyTemplate"))&&m(l,"durationLabel"),e))+`</h4><div class="flex-grow" data-duration-region></div></div>
`},useData:!0}),xe=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return'<div class="flex"><h4 class="sidebar__label u-margin--t-8">'+a(s((l=(l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"shared"))&&o(l,"bulkEdit"))&&o(l,"bulkEditViews"))&&o(l,"bulkEditFlowBodyTemplate"))&&o(l,"stateLabel"),e))+`</h4><div class="flex-grow" data-state-region></div></div>
<div class="flex u-margin--t-8"><h4 class="sidebar__label u-margin--t-8">`+a(s((l=(l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"shared"))&&o(l,"bulkEdit"))&&o(l,"bulkEditViews"))&&o(l,"bulkEditFlowBodyTemplate"))&&o(l,"ownerLabel"),e))+`</h4><div class="flex-grow" data-owner-region></div></div>
<div class="flex u-margin--t-8 u-margin--b-8"><h4 class="sidebar__label u-margin--t-8"></h4><div class="flex-grow" data-apply-owner-region></div></div>
`},useData:!0}),b=P.patients.shared.bulkEdit.bulkEditViews;function Y(t,e){if(!t)return!1;const i=y(e?`${t} ${e}`:t);return i.isBefore(y(),"day")||i.isBefore(y(),"minute")}const N=v.extend({onPicklistSelect({model:t}){if(t.isDone()&&this.getOption("flows")){this.shouldSelectDone(t);return}this.setSelectedStatus(t)},shouldSelectDone(t){const e=this.getOption("flows");if(!re(e.invoke("isAllDone"),n=>!n)){this.setSelectedStatus(t);return}if(this.popRegion.empty(),p.request("settings","get","require_done_flow")){p.request("modal","show:small",{bodyText:b.flowsStateComponent.requireDoneModal.bodyText,headingText:b.flowsStateComponent.requireDoneModal.headingText,submitText:b.flowsStateComponent.requireDoneModal.submitText,cancelText:!1,buttonClass:"button--blue"});return}const u=p.request("modal","show:small",{bodyText:b.flowsStateComponent.doneModal.bodyText,headingText:b.flowsStateComponent.doneModal.headingText,submitText:b.flowsStateComponent.doneModal.submitText,onSubmit:()=>{this.setSelectedStatus(t),u.destroy()}})},setSelectedStatus(t){this.setState("selected",t),this.popRegion.empty()}}),De=g.extend({template:h.template({1:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return"        "+t.escapeExpression((o(i,"formatMessage")||e&&o(e,"formatMessage")||a).call(s,(o(i,"intlGet")||e&&o(e,"intlGet")||a).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkEditButtonView.editFlows",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:25},end:{line:4,column:104}}}),{name:"formatMessage",hash:{itemCount:(l=e!=null?o(e,"items"):e)!=null?o(l,"length"):l},data:n,loc:{start:{line:4,column:8},end:{line:4,column:129}}}))+`
`},3:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return"        "+t.escapeExpression((o(i,"formatMessage")||e&&o(e,"formatMessage")||a).call(s,(o(i,"intlGet")||e&&o(e,"intlGet")||a).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkEditButtonView.editActions",{name:"intlGet",hash:{},data:n,loc:{start:{line:6,column:25},end:{line:6,column:106}}}),{name:"formatMessage",hash:{itemCount:(l=e!=null?o(e,"items"):e)!=null?o(l,"length"):l},data:n,loc:{start:{line:6,column:8},end:{line:6,column:131}}}))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
   <button class="button--blue js-bulk-edit">
`+((l=s(i,"if").call(e??(t.nullContext||{}),e!=null?s(e,"isFlowList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(3,n,0),data:n,loc:{start:{line:3,column:6},end:{line:7,column:13}}}))!=null?l:"")+`    </button>
    <span class="button--text js-cancel">`+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"shared"))&&s(l,"bulkEdit"))&&s(l,"bulkEditViews"))&&s(l,"bulkEditButtonView"))&&s(l,"cancel"),e))+`</span>
  `},useData:!0}),templateContext(){return{isFlowList:this.getOption("isFlowType")}},triggers:{"click .js-cancel":"click:cancel","click .js-bulk-edit":"click:edit"}}),Ee=g.extend({className:"modal__header--sidebar",template:h.template({1:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return'<button class="button--icon u-margin--r-8 js-menu">'+t.escapeExpression((l(i,"far")||e&&l(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"ellipsis",{name:"far",hash:{},data:n,loc:{start:{line:7,column:76},end:{line:7,column:94}}}))+"</button>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
    <div class="flex">
      <div class="flex-grow">
      <h3 class="sidebar__heading">`+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(s,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkEditActionsHeaderView.headingText",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:52},end:{line:4,column:140}}}),{name:"formatMessage",hash:{itemCount:(l=e!=null?r(e,"items"):e)!=null?r(l,"length"):l},data:n,loc:{start:{line:4,column:35},end:{line:4,column:165}}}))+`</h3>
      </div>
      <div>
        `+((l=r(i,"if").call(s,e!=null?r(e,"isDevelop"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:7,column:8},end:{line:7,column:110}}}))!=null?l:"")+`
        <button class="button--icon js-close">`+o((r(i,"far")||e&&r(e,"far")||a).call(s,"xmark",{name:"far",hash:{},data:n,loc:{start:{line:8,column:46},end:{line:8,column:61}}}))+`</button>
      </div>
    </div>
  `},useData:!0}),templateContext(){return{isDevelop:!1}},triggers:{"click @ui.menu":"click:menu"},ui:{menu:".js-menu"},onClickMenu(){const t=this.collection.length,e=new k.Collection([{onSelect:O(this.triggerMethod,this,"confirm:delete")}]);new I({ui:this.ui.menu,uiView:this,headingText:b.bulkEditActionsHeaderView.menuOptions.headingText,itemTemplate:h.template({compiler:[8,">= 4.3.0"],main:function(u,n,l,s,a){var o=n??(u.nullContext||{}),r=u.hooks.helperMissing,d=u.escapeExpression,c=u.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return d((c(l,"far")||n&&c(n,"far")||r).call(o,"trash-can",{name:"far",hash:{classes:"sidebar__delete-icon"},data:a,loc:{start:{line:1,column:0},end:{line:1,column:50}}}))+"<span>"+d((c(l,"formatMessage")||n&&c(n,"formatMessage")||r).call(o,(c(l,"intlGet")||n&&c(n,"intlGet")||r).call(o,"patients.shared.bulkEdit.bulkEditViews.bulkEditActionsHeaderView.menuOptions.delete",{name:"intlGet",hash:{},data:a,loc:{start:{line:1,column:73},end:{line:1,column:168}}}),{name:"formatMessage",hash:{itemCount:n!=null?c(n,"itemCount"):n},data:a,loc:{start:{line:1,column:56},end:{line:1,column:190}}}))+"</span>"},useData:!0}),itemTemplateContext:{itemCount:t},lists:[{collection:e}],align:"right",popWidth:248}).show()},onConfirmDelete(){const t=p.request("modal","show:small",{bodyText:b.confirmDeleteActionsModal.bodyText,headingText:b.confirmDeleteActionsModal.headingText,submitText:b.confirmDeleteActionsModal.submitText,buttonClass:"button--red",onSubmit:()=>{t.destroy(),this.triggerMethod("delete",this.collection)}})}}),Bt=g.extend({className:"modal__header--sidebar",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
    <div class="flex">
      <div class="flex-grow">
        <h3 class="sidebar__heading">`+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(s,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(s,"patients.shared.bulkEdit.bulkEditViews.bulkEditFlowsHeaderView.headingText",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:54},end:{line:4,column:140}}}),{name:"formatMessage",hash:{itemCount:(l=e!=null?r(e,"items"):e)!=null?r(l,"length"):l},data:n,loc:{start:{line:4,column:37},end:{line:4,column:165}}}))+`</h3>
      </div>
      <div>
        <button class="button--icon u-margin--r-8 js-menu">`+o((r(i,"far")||e&&r(e,"far")||a).call(s,"ellipsis",{name:"far",hash:{},data:n,loc:{start:{line:7,column:59},end:{line:7,column:77}}}))+`</button>
        <button class="button--icon js-close">`+o((r(i,"far")||e&&r(e,"far")||a).call(s,"xmark",{name:"far",hash:{},data:n,loc:{start:{line:8,column:46},end:{line:8,column:61}}}))+`</button>
      </div>
    </div>
  `},useData:!0}),triggers:{"click @ui.menu":"click:menu"},ui:{menu:".js-menu"},onClickMenu(){const t=this.collection.length,e=new k.Collection([{onSelect:O(this.triggerMethod,this,"confirm:delete")}]);new I({ui:this.ui.menu,uiView:this,headingText:b.bulkEditFlowsHeaderView.menuOptions.headingText,itemTemplate:h.template({compiler:[8,">= 4.3.0"],main:function(u,n,l,s,a){var o=n??(u.nullContext||{}),r=u.hooks.helperMissing,d=u.escapeExpression,c=u.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return d((c(l,"far")||n&&c(n,"far")||r).call(o,"trash-can",{name:"far",hash:{classes:"sidebar__delete-icon"},data:a,loc:{start:{line:1,column:0},end:{line:1,column:50}}}))+"<span>"+d((c(l,"formatMessage")||n&&c(n,"formatMessage")||r).call(o,(c(l,"intlGet")||n&&c(n,"intlGet")||r).call(o,"patients.shared.bulkEdit.bulkEditViews.bulkEditFlowsHeaderView.menuOptions.delete",{name:"intlGet",hash:{},data:a,loc:{start:{line:1,column:73},end:{line:1,column:166}}}),{name:"formatMessage",hash:{itemCount:n!=null?c(n,"itemCount"):n},data:a,loc:{start:{line:1,column:56},end:{line:1,column:188}}}))+"</span>"},useData:!0}),itemTemplateContext:{itemCount:t},lists:[{collection:e}],align:"right",popWidth:248}).show()},onConfirmDelete(){const t=p.request("modal","show:small",{bodyText:b.confirmDeleteFlowsModal.bodyText,headingText:b.confirmDeleteFlowsModal.headingText,submitText:b.confirmDeleteFlowsModal.submitText,buttonClass:"button--red",onSubmit:()=>{t.destroy(),this.triggerMethod("delete",this.collection)}})}}),Pe=g.extend({modelEvents:{"change:stateMulti":"showState","change:ownerMulti":"showOwner","change:dateMulti":"showDueDateTime","change:date":"showDueDateTime","change:timeMulti":"showDueTime","change:durationMulti":"showDuration"},className:"modal__content--sidebar",template:Oe,regions:{state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",duration:"[data-duration-region]"},onRender(){this.showState(),this.showOwner(),this.showDueDateTime(),this.showDuration()},getStateComponent(){return this.model.get("stateMulti")?new v({viewOptions:{className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.escapeExpression,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return s((a(i,"fas")||e&&a(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"circle-dot",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:20}}}))+'<span class="button__value--indeterminate">'+s(t.lambda((l=(l=(l=(l=(l=n&&a(n,"intl"))&&a(l,"patients"))&&a(l,"shared"))&&a(l,"bulkEdit"))&&a(l,"bulkEditViews"))&&a(l,"bulkStateDefaultText"),e))+"</span>"},useData:!0})}}):new v({stateId:this.model.get("stateId")})},getOwnerComponent(){const t=this.model.someComplete();return this.model.get("ownerMulti")?new _({viewOptions:{attributes:{disabled:t},className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(e,i,u,n,l){var s,a=e.escapeExpression,o=e.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(u,"far")||i&&o(i,"far")||e.hooks.helperMissing).call(i??(e.nullContext||{}),"circle-user",{name:"far",hash:{},data:l,loc:{start:{line:1,column:0},end:{line:1,column:21}}}))+'<span class="button__value--indeterminate">'+a(e.lambda((s=(s=(s=(s=(s=l&&o(l,"intl"))&&o(s,"patients"))&&o(s,"shared"))&&o(s,"bulkEdit"))&&o(s,"bulkEditViews"))&&o(s,"bulkOwnerDefaultText"),i))+"</span>"},useData:!0})}}):new _({owner:this.model.get("owner"),workspaces:this.model.get("workspaces"),state:{isDisabled:t}})},getDueDateComponent(){const t=this.model.someComplete();if(this.model.get("dateMulti"))return new x({state:{isDisabled:t},viewOptions:{attributes:{disabled:t},tagName:"button",className:"button-secondary w-100 due-component",triggers:{click:"click"},template:h.template({compiler:[8,">= 4.3.0"],main:function(i,u,n,l,s){var a,o=i.escapeExpression,r=i.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return o((r(n,"far")||u&&r(u,"far")||i.hooks.helperMissing).call(u??(i.nullContext||{}),"calendar-days",{name:"far",hash:{},data:s,loc:{start:{line:1,column:0},end:{line:1,column:23}}}))+'<span class="button__value--indeterminate">'+o(i.lambda((a=(a=(a=(a=(a=s&&r(s,"intl"))&&r(a,"patients"))&&r(a,"shared"))&&r(a,"bulkEdit"))&&r(a,"bulkEditViews"))&&r(a,"bulkDueDateDefaultText"),u))+"</span>"},useData:!0})}});const e=Y(this.model.get("date"));return new x({date:this.model.get("date"),state:{isDisabled:t},isOverdue:e})},getDueTimeComponent(){if(this.model.get("timeMulti"))return new D({viewOptions:{attributes:{disabled:this.model.get("dateMulti")||this.model.someComplete()},className:"button-secondary time-component w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(u,n,l,s,a){var o,r=u.escapeExpression,d=u.lookupProperty||function(c,m){if(Object.prototype.hasOwnProperty.call(c,m))return c[m]};return r((d(l,"far")||n&&d(n,"far")||u.hooks.helperMissing).call(n??(u.nullContext||{}),"clock",{name:"far",hash:{},data:a,loc:{start:{line:1,column:0},end:{line:1,column:15}}}))+' <span class="button__value--indeterminate">'+r(u.lambda((o=(o=(o=(o=(o=a&&d(a,"intl"))&&d(o,"patients"))&&d(o,"shared"))&&d(o,"bulkEdit"))&&d(o,"bulkEditViews"))&&d(o,"bulkDueTimeDefaultText"),n))+"</span>"},useData:!0})}});const t=this.model.get("time"),e=this.model.get("dateMulti")&&!t||!this.model.get("date")||this.model.someComplete(),i=Y(this.model.get("date"),t);return new D({time:t,state:{isDisabled:e},isOverdue:i})},getDurationComponent(){const t=this.model.someComplete();return this.model.get("durationMulti")?new U({viewOptions:{className:"button-secondary w-100",attributes:{disabled:t},template:h.template({compiler:[8,">= 4.3.0"],main:function(e,i,u,n,l){var s,a=e.escapeExpression,o=e.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(u,"far")||i&&o(i,"far")||e.hooks.helperMissing).call(i??(e.nullContext||{}),"stopwatch",{name:"far",hash:{},data:l,loc:{start:{line:1,column:0},end:{line:1,column:19}}}))+'<span class="button__value--indeterminate">'+a(e.lambda((s=(s=(s=(s=(s=l&&o(l,"intl"))&&o(s,"patients"))&&o(s,"shared"))&&o(s,"bulkEdit"))&&o(s,"bulkEditViews"))&&o(s,"bulkDurationDefaultText"),i))+"</span>"},useData:!0})}}):new U({duration:this.model.get("duration"),state:{isDisabled:t}})},showState(){const t=this.getStateComponent();this.listenTo(t,"change:state",e=>{this.model.setState(e)}),this.showChildView("state",t)},showOwner(){const t=this.getOwnerComponent();this.listenTo(t,"change:owner",e=>{this.model.setOwner(e)}),this.showChildView("owner",t)},showDueDateTime(){this.showDueDate(),this.showDueTime()},showDueDate(){const t=this.getDueDateComponent();this.listenTo(t,"change:due",e=>{this.model.setDueDate(e)}),this.showChildView("dueDate",t)},showDueTime(){const t=this.getDueTimeComponent();this.listenTo(t,"change:time",e=>{this.model.setDueTime(e)}),this.showChildView("dueTime",t)},showDuration(){const t=this.getDurationComponent();this.listenTo(t,"change:duration",e=>{this.model.setDuration(e)}),this.showChildView("duration",t)}}),Se=g.extend({modelEvents:{"change:applyOwner":"render","change:ownerMulti":"render"},className:"u-margin--t-4 u-margin--l-16",template:h.template({1:function(t,e,i,u,n){return" disabled"},3:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fas")||e&&l(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-check",{name:"fas",hash:{},data:n,loc:{start:{line:3,column:24},end:{line:3,column:46}}}))},5:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fal")||e&&l(e,"fal")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square",{name:"fal",hash:{},data:n,loc:{start:{line:3,column:54},end:{line:3,column:70}}}))},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return`
    <button class="button--checkbox js-apply-owner"`+((l=a(i,"if").call(s,e!=null?a(e,"ownerMulti"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:51},end:{line:2,column:85}}}))!=null?l:"")+`>
      `+((l=a(i,"if").call(s,e!=null?a(e,"applyOwner"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.program(5,n,0),data:n,loc:{start:{line:3,column:6},end:{line:3,column:78}}}))!=null?l:"")+"<span>"+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=(l=n&&a(n,"intl"))&&a(l,"patients"))&&a(l,"shared"))&&a(l,"bulkEdit"))&&a(l,"bulkEditViews"))&&a(l,"bulkEditFlowBodyTemplate"))&&a(l,"applyOwnerLabel"),e))+`</span>
    </button>`},useData:!0}),triggers:{"click .js-apply-owner":"click:select"},onClickSelect(){this.model.set("applyOwner",!this.model.get("applyOwner"))}}),Lt=g.extend({modelEvents:{"change:stateMulti":"showState","change:ownerMulti":"showOwner"},className:"modal__content--sidebar",template:xe,regions:{state:"[data-state-region]",owner:"[data-owner-region]",applyOwner:"[data-apply-owner-region]"},onRender(){this.showState(),this.showOwner(),this.showApplyOwner()},getStateComponent(){return this.model.get("stateMulti")?new N({flows:this.collection,viewOptions:{className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.escapeExpression,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return s((a(i,"fas")||e&&a(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"circle-dot",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:20}}}))+'<span class="button__value--indeterminate">'+s(t.lambda((l=(l=(l=(l=(l=n&&a(n,"intl"))&&a(l,"patients"))&&a(l,"shared"))&&a(l,"bulkEdit"))&&a(l,"bulkEditViews"))&&a(l,"bulkStateDefaultText"),e))+"</span>"},useData:!0})}}):new N({flows:this.collection,stateId:this.model.get("stateId")})},getOwnerComponent(){const t=this.model.someComplete();return this.model.get("ownerMulti")?new _({viewOptions:{className:"button-secondary w-100",template:h.template({compiler:[8,">= 4.3.0"],main:function(e,i,u,n,l){var s,a=e.escapeExpression,o=e.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(u,"far")||i&&o(i,"far")||e.hooks.helperMissing).call(i??(e.nullContext||{}),"circle-user",{name:"far",hash:{},data:l,loc:{start:{line:1,column:0},end:{line:1,column:21}}}))+'<span class="button__value--indeterminate">'+a(e.lambda((s=(s=(s=(s=(s=l&&o(l,"intl"))&&o(s,"patients"))&&o(s,"shared"))&&o(s,"bulkEdit"))&&o(s,"bulkEditViews"))&&o(s,"bulkOwnerDefaultText"),i))+"</span>"},useData:!0})},state:{isDisabled:t}}):new _({owner:this.model.get("owner"),workspaces:this.model.get("workspaces"),state:{isDisabled:t}})},showState(){const t=this.getStateComponent();this.listenTo(t,"change:state",e=>{this.model.setState(e)}),this.showChildView("state",t)},showOwner(){const t=this.getOwnerComponent();this.listenTo(t,"change:owner",e=>{this.model.setOwner(e)}),this.showChildView("owner",t)},showApplyOwner(){this.showChildView("applyOwner",new Se({model:this.model}))}}),It=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||s).call(l,(a(i,"intlGet")||e&&a(e,"intlGet")||s).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkEditFlowsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:88}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:110}}}))},useData:!0}),Ve=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||s).call(l,(a(i,"intlGet")||e&&a(e,"intlGet")||s).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkEditActionsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:90}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:112}}}))},useData:!0}),Rt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||s).call(l,(a(i,"intlGet")||e&&a(e,"intlGet")||s).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkDeleteFlowsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:90}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:112}}}))},useData:!0}),Te=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||s).call(l,(a(i,"intlGet")||e&&a(e,"intlGet")||s).call(l,"patients.shared.bulkEdit.bulkEditViews.bulkDeleteActionsSuccess",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:17},end:{line:1,column:92}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"itemCount"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:114}}}))},useData:!0}),Me=k.Model.extend({initialize({collection:t}){const e=t.at(0);this.initBulkState(t,e),this.initBulkOwner(t,e),this.initBulkDueDate(t,e),this.initBulkDueTime(t,e),this.initBulkDuration(t,e)},initBulkState(t,e){const i=e.getState().id,u=t.some(n=>n.getState().id!==i);this.set({stateMulti:u,stateId:u?null:i})},initBulkOwner(t,e){const i=e.getOwner(),u=e.getProgram(),n=t.some(l=>{const s=l.getOwner().id!==i.id,a=l.getProgram().id!==u.id;return s||a});this.set({ownerMulti:n,owner:n?null:i,workspaces:u.getUserWorkspaces()})},initBulkDueDate(t,e){const i=e.get("due_date"),u=t.some(n=>n.get("due_date")!==i);this.set({dateMulti:u,date:u?null:i})},initBulkDueTime(t,e){const i=e.get("due_time"),u=t.some(n=>n.get("due_time")!==i);this.set({timeMulti:u,time:u?null:i})},initBulkDuration(t,e){const i=e.get("duration"),u=t.some(n=>n.get("duration")!==i);this.set({durationMulti:u,duration:u?null:i})},setState(t){return this.set({stateId:t.id,stateMulti:!1,stateChanged:!0})},setOwner(t){return this.set({owner:t,ownerMulti:!1,ownerChanged:!0})},setDueDate(t){return t?this.set({date:t.format("YYYY-MM-DD"),dateMulti:!1,dateChanged:!0}):this.set({date:null,time:null,dateMulti:!1,timeMulti:!1})},setDueTime(t){return this.set({time:t||null,timeMulti:!1,timeChanged:!0})},setDuration(t){return this.set({duration:t,durationMulti:!1,durationChanged:!0})},someComplete(){return this.get("collection").some(t=>t.isDone())},getData(){const{stateChanged:t,stateId:e,ownerChanged:i,owner:u,dateChanged:n,date:l,timeChanged:s,time:a,durationChanged:o,duration:r}=this.attributes,d={};return t&&(d._state=e),i&&(d._owner=ce(u,"id","type")),n&&(d.due_date=l),s&&(d.due_time=a),o&&(d.duration=r),d}}),Ae=S.extend({StateModel:Me,onStart(){const t=new Ee({collection:this.getState("collection")}),e=new Pe({model:this.getState(),collection:this.getState("collection")});this.modal=p.request("modal","show:sidebar",{headerView:t,bodyView:e,onSubmit:this.onSubmit.bind(this)}),this.listenTo(t,{delete:L(this.triggerMethod,"delete")}),this.listenTo(this.modal,{destroy:this.stop})},onSubmit(){this.modal.disableSubmit(),this.triggerMethod("save",this.getState().getData())},onStop(){this.modal.destroy()}}),Fe=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,f){if(Object.prototype.hasOwnProperty.call(w,f))return w[f]};return'<h1 class="patient-flow__name">'+r((m(i,"fas")||e&&m(e,"fas")||o).call(a,"folder-open",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:31},end:{line:1,column:52}}}))+" "+r((s=(s=m(i,"name")||(e!=null?m(e,"name"):e))!=null?s:o,typeof s===d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:1,column:53},end:{line:1,column:63}}}):s))+`</h1>
<table class="table-list">
  <td class="patient-flow__details">`+r((s=(s=m(i,"details")||(e!=null?m(e,"details"):e))!=null?s:o,typeof s===d?s.call(a,{name:"details",hash:{},data:n,loc:{start:{line:3,column:36},end:{line:3,column:49}}}):s))+"</td>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:3,column:54},end:{line:3,column:79}}}):s))+`<td class="patient-flow__meta">
    <span class="table-list__meta" data-state-region></span>
    <span class="table-list__meta" data-owner-region></span>
    <progress class="js-progress progress-bar patient-flow__progress" value=`+r(c((l=e!=null?m(e,"_progress"):e)!=null?m(l,"complete"):l,e))+" max="+r(c((l=e!=null?m(e,"_progress"):e)!=null?m(l,"total"):l,e))+"></progress>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:138},end:{line:7,column:163}}}):s))+`</td>
</table>
`},useData:!0}),je=h.template({1:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"<em>"+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"patient"))&&s(l,"dashboard"))&&s(l,"dashboardViews"))&&s(l,"newAction"),e))+"</em>"},3:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return'<span class="patient__action-attachment">'+t.escapeExpression((l(i,"far")||e&&l(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"paperclip",{name:"far",hash:{},data:n,loc:{start:{line:17,column:65},end:{line:17,column:84}}}))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`<td class="table-list__cell table-list__item-check js-no-click"><span data-check-region></span></td>
<td class="table-list__cell">
  <span class="patient__action-icon">`+r((c(i,"far")||e&&c(e,"far")||o).call(a,e!=null?c(e,"icon"):e,{name:"far",hash:{},data:n,loc:{start:{line:3,column:37},end:{line:3,column:49}}}))+"</span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:3,column:56},end:{line:3,column:81}}}):s))+`<span class="patient__action-name">
    `+r((s=(s=c(i,"name")||(e!=null?c(e,"name"):e))!=null?s:o,typeof s===d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:5,column:4},end:{line:5,column:14}}}):s))+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:5,column:14},end:{line:5,column:39}}}):s))+((l=c(i,"unless").call(a,e!=null?c(e,"name"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:6,column:4},end:{line:6,column:105}}}))!=null?l:"")+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta" data-state-region></span>`+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:58},end:{line:10,column:83}}}):s))+'<span class="table-list__meta" data-owner-region></span>'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:11,column:58},end:{line:11,column:83}}}):s))+'<span class="table-list__meta">'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:12,column:33},end:{line:12,column:58}}}):s))+"<span data-due-date-region></span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:38},end:{line:13,column:63}}}):s))+"<span data-due-time-region></span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:14,column:38},end:{line:14,column:63}}}):s))+"</span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:15,column:9},end:{line:15,column:34}}}):s))+'<span class="table-list__meta" data-form-region></span>'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:57},end:{line:16,column:82}}}):s))+((l=c(i,"if").call(a,e!=null?c(e,"hasAttachments"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:17,column:2},end:{line:17,column:98}}}))!=null?l:"")+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:17,column:98},end:{line:17,column:123}}}):s))+'<span class="patient__action-ts">'+r((c(i,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:18,column:35},end:{line:18,column:78}}}))+`</span>
</td>
`},useData:!0}),Be=g.extend({initialize(){this.patient=this.model.getPatient()},className:"patient-flow__context-trail",template:h.template({1:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`      <a class="js-back patient-flow__context-link">
        `+o((r(i,"fas")||e&&r(e,"fas")||a).call(s,"chevron-left",{name:"fas",hash:{},data:n,loc:{start:{line:4,column:8},end:{line:4,column:30}}}))+o(t.lambda((l=(l=(l=(l=n&&r(n,"intl"))&&r(l,"patients"))&&r(l,"patient"))&&r(l,"flowViews"))&&r(l,"contextBackBtn"),e))+`
      </a>
      `+o((r(i,"fas")||e&&r(e,"fas")||a).call(s,"chevron-right",{name:"fas",hash:{},data:n,loc:{start:{line:6,column:6},end:{line:6,column:29}}}))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r="function",d=t.escapeExpression,c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`
`+((l=c(i,"if").call(a,e!=null?c(e,"hasLatestList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:4},end:{line:7,column:11}}}))!=null?l:"")+'    <a class="js-patient patient-flow__context-link">'+d((s=(s=c(i,"firstName")||(e!=null?c(e,"firstName"):e))!=null?s:o,typeof s===r?s.call(a,{name:"firstName",hash:{},data:n,loc:{start:{line:8,column:53},end:{line:8,column:68}}}):s))+" "+d((s=(s=c(i,"lastName")||(e!=null?c(e,"lastName"):e))!=null?s:o,typeof s===r?s.call(a,{name:"lastName",hash:{},data:n,loc:{start:{line:8,column:69},end:{line:8,column:83}}}):s))+"</a>"+d((c(i,"fas")||e&&c(e,"fas")||o).call(a,"chevron-right",{name:"fas",hash:{},data:n,loc:{start:{line:8,column:87},end:{line:8,column:110}}}))+d((s=(s=c(i,"name")||(e!=null?c(e,"name"):e))!=null?s:o,typeof s===r?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:8,column:110},end:{line:8,column:120}}}):s))+`
  `},useData:!0}),triggers:{"click .js-back":"click:back","click .js-patient":"click:patient"},onClickBack(){p.request("history","go:latestList")},onClickPatient(){p.trigger("event-router","patient:dashboard",this.patient.id)},templateContext(){return{hasLatestList:p.request("history","has:latestList"),firstName:this.patient.get("first_name"),lastName:this.patient.get("last_name")}}}),Le=g.extend({className:"patient-flow__header",modelEvents:{editing:"onEditing",change:"render","change:_progress":"onChangeFlowProgress"},onEditing(t){this.$el.toggleClass("is-selected",t)},template:Fe,regions:{state:"[data-state-region]",owner:"[data-owner-region]"},triggers:{click:"edit"},ui:{progress:".js-progress"},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner()},showState(){if(!this.canEdit){const e=new V({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new ke({flow:this.model,stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const u=new C({model:this.model,isCompact:!0});this.showChildView("owner",u);return}const t=this.model.isDone(),e=this.model.getProgram(),i=new _({owner:this.model.getOwner(),workspaces:e.getUserWorkspaces(),isCompact:!0,state:{isDisabled:t}});this.listenTo(i,"change:owner",u=>{this.model.saveOwner(u)}),this.showChildView("owner",i)},onChangeFlowProgress(){const t=this.model.get("_progress");this.ui.progress.attr({value:t.complete,max:t.total})}}),Ie=g.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="patient-flow__empty-list">
      <h2>`+t.escapeExpression(t.lambda((l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"patient"))&&s(l,"flowViews"))&&s(l,"emptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),Re=g.extend({className:"table-list__item",modelEvents:{change:"render",editing:"onEditing"},initialize({state:t}){this.state=t,this.listenTo(t,{"select:multiple":this.showCheck,"select:none":this.showCheck}),this.flow=this.model.getFlow(),this.listenTo(this.flow,{"change:_state":this.render})},template:je,templateContext(){return{hasForm:this.model.getForm(),icon:this.model.hasOutreach()?"share-from-square":"file-lines",hasAttachments:this.model.hasAttachments()}},tagName:"tr",regions:{check:"[data-check-region]",state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",form:"[data-form-region]"},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","flow:action",this.model.get("_flow"),this.model.id)},onEditing(t){this.state.isSelected(this.model)||this.$el.toggleClass("is-selected",t)},onRender(){const t=this.canEdit;this.canEdit=!this.flow.isDone()&&this.model.canEdit(),this.showCheck(),this.showState(),this.showOwner(),this.showDueDate(),this.showDueTime(),this.showForm(),t!==this.canEdit&&(this.canEdit||this.toggleSelected(!1),this.triggerMethod("change:canEdit"))},toggleSelected(t){this.state.isBeingEdited(this.model)||this.$el.toggleClass("is-selected",t)},showCheck(){if(!this.canEdit)return;const t=this.state.isSelected(this.model);this.toggleSelected(t);const e=new J({state:{isSelected:t}});this.listenTo(e,{select(i){this.triggerMethod("select",this,!!i.shiftKey)},"change:isSelected":this.toggleSelected}),this.showChildView("check",e)},showState(){if(!this.canEdit){const t=new V({model:this.model,isCompact:!0});this.showChildView("state",t);return}this.stateComponent=new v({stateId:this.model.get("_state"),isCompact:!0}),this.listenTo(this.stateComponent,"change:state",t=>{this.model.saveState(t)}),this.showChildView("state",this.stateComponent)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.isDone(),e=this.model.getProgram();this.ownerComponent=new _({owner:this.model.getOwner(),workspaces:e.getUserWorkspaces(),isCompact:!0,state:{isDisabled:t}}),this.listenTo(this.ownerComponent,"change:owner",i=>{this.model.saveOwner(i)}),this.showChildView("owner",this.ownerComponent)},showDueDate(){if(!this.canEdit){const e=new R({model:this.model});this.showChildView("dueDate",e);return}const t=this.model.isDone();this.dueDateComponent=new x({date:this.model.get("due_date"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()}),this.listenTo(this.dueDateComponent,"change:due",e=>{this.model.saveDueDate(e)}),this.showChildView("dueDate",this.dueDateComponent)},showDueTime(){if(!this.canEdit){const e=new q({model:this.model});this.showChildView("dueTime",e);return}const t=this.model.isDone()||!this.model.get("due_date");this.dueTimeComponent=new D({time:this.model.get("due_time"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()}),this.listenTo(this.dueTimeComponent,"change:time",e=>{this.model.saveDueTime(e)}),this.showChildView("dueTime",this.dueTimeComponent)},showForm(){this.model.getForm()&&this.showChildView("form",new G({model:this.model}))}}),qe=E.extend({className:"table-list patient-flow__list",tagName:"table",childView:Re,childViewOptions(){return{state:this.getOption("state")}},childViewTriggers:{select:"select","change:canEdit":"listItem:canEdit"},emptyView:Ie,viewComparator({model:t}){return t.get("sequence")},initialize({state:t,editableCollection:e}){this.state=t,this.editableCollection=e,this.onListItemCanEdit=M(this.onListItemCanEdit,60)},onListItemCanEdit(){this.triggerMethod("change:canEdit")},onSelect(t,e){this.state.selectRange(this.editableCollection,t.model,e)}}),Ge=g.extend({className:"patient-flow__frame",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){return`
    <div class="patient-flow__layout">
      <div data-context-trail-region></div>
      <div data-header-region></div>
      <div class="patient-flow__actions">
        <div data-select-all-region></div>
        <div data-tools-region></div>
      </div>
      <div data-action-list-region></div>
    </div>
    <div class="patient-flow__sidebar" data-sidebar-region></div>
  `},useData:!0}),regions:{contextTrail:{el:"[data-context-trail-region]",replaceElement:!0},header:"[data-header-region]",sidebar:"[data-sidebar-region]",actionList:{el:"[data-action-list-region]",regionClass:T,replaceElement:!0},tools:{el:"[data-tools-region]",replaceElement:!0},selectAll:{el:"[data-select-all-region]",replaceElement:!0}}}),Q=g.extend({tagName:"button",className:"button--checkbox u-margin--r-16",attributes(){if(this.getOption("isDisabled"))return{disabled:"disabled"}},triggers:{click:"click"},getTemplate(){return this.getOption("isSelectAll")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fas")||e&&l(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-check",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0}):this.getOption("isSelectNone")||this.getOption("isDisabled")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fal")||e&&l(e,"fal")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square",{name:"fal",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:16}}}))},useData:!0}):h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fas")||e&&l(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-minus",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0})}}),j=P.patients.shared.addWorkflow.addWorkflowViews,$e=I.extend({popWidth:248,isSelectlist:!0,placeholderText:j.addWorkflowOptlist.placeholderText,itemTemplateContext(){const t=this.model.get("itemType")==="program-actions",e=this.model.get("hasOutreach")?"share-from-square":"file-lines";return{icon:{icon:t?e:"folder",type:t?"far":"fas",classes:"add-workflow__picklist-icon"}}}}),te=g.extend({tagName:"button",className:"button-primary",headingText:j.addWorkflowOptlist.headingText,template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return o((r(i,"far")||e&&r(e,"far")||a).call(s,"circle-plus",{name:"far",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:21}}}))+"<span>"+o(t.lambda((l=(l=(l=(l=(l=(l=n&&r(n,"intl"))&&r(l,"patients"))&&r(l,"shared"))&&r(l,"addWorkflow"))&&r(l,"addWorkflowViews"))&&r(l,"addButtonView"))&&r(l,"label"),e))+"</span>"+o((r(i,"far")||e&&r(e,"far")||a).call(s,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:110},end:{line:1,column:130}}}))},useData:!0}),triggers:{click:"click"},onClick(){new $e({headingText:this.getOption("headingText"),ui:this.$el,uiView:this,lists:this.getOption("lists")}).show()}}),We={new:"u-text--italic",noResults:"picklist--no-results"},qt=K.extend({StateModel:X,routerAppName:"FlowApp",childApps:{action:ee,patient:Z,bulkEditActions:Ae},eventRoutes:{"flow:action":"showActionSidebar"},stateEvents:{"change:actionsSelected":"onChangeSelected"},onChangeSelected(){this.toggleBulkSelect()},onBeforeStart(){this.resetStateDefaults(),this.showView(new Ge)},beforeStart({flowId:t}){return[p.request("entities","fetch:flows:model",t),p.request("entities","fetch:actions:collection:byFlow",t),p.request("entities","fetch:patients:model:byFlow",t)]},onFail(){p.trigger("event-router","notFound"),this.stop()},onStart({currentRoute:t},e,i,u){this.flow=e,this.actions=i,this.editableCollection=i.clone(),this.patient=u,this.addOpts=this.getAddOpts(this.flow.getProgramFlow()),this.subscribe(),this.showChildView("contextTrail",new Be({model:this.flow})),this.listenTo(this.editableCollection,"reset",this.toggleBulkSelect),this.toggleBulkSelect(),this.showHeader(),this.showActionList(),this.showSidebar(),this.listenTo(this.actions,{"change:_state":this.onActionChangeState,destroy:this.onActionDestroy}),this.listenTo(this.flow,{"change:_owner":this.onFlowChangeOwner,message:this.onFlowMessage}),this.startRoute(t)},subscribe(){p.request("ws","subscribe",ue([this.flow,...this.actions.models],"getResource"))},_setFlowProgress(){const t=this.actions.filter(i=>i.isDone()).length,e=this.actions.length;this.flow.set({_progress:{complete:t,total:e}})},_addAction(t){this.actions.add(t),this.editableCollection.add(t),this.subscribe(),this._setFlowProgress()},onActionChangeState(){this._setFlowProgress()},onActionDestroy(){this._setFlowProgress()},onFlowMessage({category:t,payload:e}){if(t!=="ActionCreated")return;const{action:i}=e;p.request("entities","fetch:actions:model",i.id).then(O(this._addAction,this))},onFlowChangeOwner(t,e){if(e.type==="teams")return;const i=t.getOwner().getTeam();this.actions.each(u=>{!u.isDone()&&u.getOwner()===i&&u.set({_owner:e})})},showHeader(){const t=new Le({model:this.flow});this.listenTo(t,{edit:this.onEditFlow}),this.showChildView("header",t)},getAddOpts(t){return t.getAddableActions().map(e=>({text:e.get("name"),itemType:e.type,hasOutreach:e.hasOutreach(),onSelect:O(this.triggerMethod,this,"add:programAction",e)}))},showAdd(){this.showChildView("tools",new te({headingText:j.addActionHeadingText,lists:[{collection:new k.Collection(this.addOpts)}]}))},toggleBulkSelect(){if(this.selected=this.getState().getSelected(this.editableCollection),this.showSelectAll(),this.selected.length){this.showBulkEditButtonView();return}this.showAdd()},showBulkEditButtonView(){const t=new De({tagName:"span",collection:this.selected});this.listenTo(t,{"click:cancel":this.onClickBulkCancel,"click:edit":this.onClickBulkEdit}),this.showChildView("tools",t)},onClickBulkCancel(){this.getState().clearSelected()},onClickBulkEdit(){const t=this.startChildApp("bulkEditActions",{state:{collection:this.selected}});this.listenTo(t,{save(e){const i=this.selected.length;this.selected.save(e).then(()=>{this.showUpdateSuccess(i),t.stop(),this.getState().clearSelected()}).catch(()=>{p.request("alert","show:error",P.patients.worklist.worklistApp.bulkEditFailure),this.getState().clearSelected(),this.restart()})},delete(){const e=this.selected.length;this.selected.destroy().then(()=>{this.showDeleteSuccess(e),t.stop(),this.getState().clearSelected()})}})},showDeleteSuccess(t){p.request("alert","show:success",z(Te,{itemCount:t}))},showUpdateSuccess(t){p.request("alert","show:success",z(Ve,{itemCount:t}))},showDisabledSelectAll(){this.showChildView("selectAll",new Q({isDisabled:!0}))},showSelectAll(){if(!this.editableCollection.length){this.showDisabledSelectAll();return}const t=new Q({isSelectAll:this.selected.length===this.editableCollection.length,isSelectNone:!this.selected.length});this.listenTo(t,"click",this.onClickBulkSelect),this.showChildView("selectAll",t)},onClickBulkSelect(){if(this.selected.length===this.editableCollection.length){this.getState().clearSelected();return}this.getState().selectMultiple(this.editableCollection.map("id"))},onAddProgramAction(t){const e=t.getAction({flowId:this.flow.id});e.saveAll().then(()=>{this._addAction(e),p.trigger("event-router","flow:action",this.flow.id,e.id)})},showActionList(){const t=new qe({collection:this.actions,editableCollection:this.editableCollection,state:this.getState()});this.listenTo(t,"change:canEdit",()=>{this.editableCollection.reset(this._getListEditable(t))}),this.showChildView("actionList",t)},_getListEditable(t){return this.flow.isDone()?[]:t.children.reduce((e,{canEdit:i,model:u})=>(i&&e.push(u),e),[])},showSidebar(){this.startChildApp("patient",{region:this.getRegion("sidebar"),patient:this.patient})},showActionSidebar(t,e){const i=this.getChildApp("action");this.listenToOnce(i,{start(u,n){this.setState("actionBeingEdited",n.id),n.trigger("editing",!0)},stop(){this.setState("actionBeingEdited",null)}}),this.startChildApp("action",{actionId:e})},onEditFlow(){p.request("sidebar","start","flow",{flow:this.flow})}}),He={"program-actions":"add:programAction","program-flows":"add:programFlow"},ze=S.extend({beforeStart(){return[p.request("entities","fetch:programs:collection"),p.request("entities","fetch:programActions:collection"),p.request("entities","fetch:programFlows:collection")]},onStart(t,e){e.comparator="name";const i=e.filter(u=>{const n=!!u.get("published_at"),l=!!u.get("archived_at");return n&&!l});e.reset(i),this.showView(new te({lists:this.getProgramsOpts(e)}))},getProgramsOpts(t){return t.map(e=>{const i=e.get("name"),u=e.getAddable(),n={itemType:"program-actions",text:j.noResultsText,isDisabled:!0};if(!u.length)return{itemClassName:We.noResults,headingText:i,collection:new k.Collection([n]),getItemSearchText:me};const l=this.getProgramItemsOpts(u);return{headingText:i,collection:new k.Collection(l)}})},getProgramItemsOpts(t){return t.map(e=>({text:e.get("name"),itemType:e.type,hasOutreach:e.type==="program-actions"&&e.hasOutreach(),onSelect:O(this.triggerMethod,this,He[e.type],e)}))}}),Ue=h.template({1:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"<em>"+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"patient"))&&s(l,"dashboard"))&&s(l,"dashboardViews"))&&s(l,"newAction"),e))+"</em>"},3:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return'<span class="patient__action-attachment">'+t.escapeExpression((l(i,"far")||e&&l(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"paperclip",{name:"far",hash:{},data:n,loc:{start:{line:16,column:65},end:{line:16,column:84}}}))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`<td class="table-list__cell">
  <span class="patient__action-icon">`+r((c(i,"far")||e&&c(e,"far")||o).call(a,e!=null?c(e,"icon"):e,{name:"far",hash:{},data:n,loc:{start:{line:2,column:37},end:{line:2,column:49}}}))+"</span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:56},end:{line:2,column:81}}}):s))+`<span class="patient__action-name">
    `+r((s=(s=c(i,"name")||(e!=null?c(e,"name"):e))!=null?s:o,typeof s===d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:4,column:4},end:{line:4,column:14}}}):s))+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:4,column:14},end:{line:4,column:39}}}):s))+((l=c(i,"unless").call(a,e!=null?c(e,"name"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:5,column:4},end:{line:5,column:105}}}))!=null?l:"")+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta" data-state-region></span>`+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:58},end:{line:9,column:83}}}):s))+'<span class="table-list__meta" data-owner-region></span>'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:58},end:{line:10,column:83}}}):s))+'<span class="table-list__meta">'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:11,column:33},end:{line:11,column:58}}}):s))+"<span data-due-date-region></span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:12,column:38},end:{line:12,column:63}}}):s))+"<span data-due-time-region></span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:38},end:{line:13,column:63}}}):s))+"</span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:14,column:9},end:{line:14,column:34}}}):s))+'<span class="table-list__meta" data-form-region></span>'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:15,column:57},end:{line:15,column:82}}}):s))+((l=c(i,"if").call(a,e!=null?c(e,"hasAttachments"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:16,column:2},end:{line:16,column:98}}}))!=null?l:"")+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:98},end:{line:16,column:123}}}):s))+'<span class="patient__action-ts">'+r((c(i,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:17,column:35},end:{line:17,column:78}}}))+`</span>
</td>
`},useData:!0}),Ye=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,f){if(Object.prototype.hasOwnProperty.call(w,f))return w[f]};return`<td class="table-list__cell">
  <span class="patient__flow-icon">`+r((m(i,"fas")||e&&m(e,"fas")||o).call(a,"folder",{name:"fas",hash:{},data:n,loc:{start:{line:2,column:35},end:{line:2,column:51}}}))+"</span>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:58},end:{line:2,column:83}}}):s))+'<span class="patient__action-name">'+r((s=(s=m(i,"name")||(e!=null?m(e,"name"):e))!=null?s:o,typeof s===d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:3,column:37},end:{line:3,column:47}}}):s))+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta">`+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:33},end:{line:6,column:58}}}):s))+'<span class="patient__flow-status action--'+r(c((l=e!=null?m(e,"stateOptions"):e)!=null?m(l,"color"):l,e))+'">'+r((m(i,"fa")||e&&m(e,"fa")||o).call(a,(l=e!=null?m(e,"stateOptions"):e)!=null?m(l,"iconType"):l,(l=e!=null?m(e,"stateOptions"):e)!=null?m(l,"icon"):l,{name:"fa",hash:{},data:n,loc:{start:{line:7,column:72},end:{line:7,column:118}}}))+"</span>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:125},end:{line:7,column:150}}}):s))+"</span>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:8,column:9},end:{line:8,column:34}}}):s))+'<span class="table-list__meta" data-owner-region></span>'+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:58},end:{line:9,column:83}}}):s))+'<progress class="progress-bar patient__flow-progress" value='+r(c((l=e!=null?m(e,"_progress"):e)!=null?m(l,"complete"):l,e))+" max="+r(c((l=e!=null?m(e,"_progress"):e)!=null?m(l,"total"):l,e))+"></progress>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:124},end:{line:10,column:149}}}):s))+'<span class="patient__action-ts">'+r((m(i,"formatDateTime")||e&&m(e,"formatDateTime")||o).call(a,e!=null?m(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:11,column:35},end:{line:11,column:78}}}))+`</span>
</td>
`},useData:!0}),Ne=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`<div>
  <span class="patient__tab--selected">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"patient"))&&o(l,"dashboard"))&&o(l,"dashboardViews"))&&o(l,"dashboardBtn"),e))+`</span>
  <button class="patient__tab js-archive">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"patient"))&&o(l,"dashboard"))&&o(l,"dashboardViews"))&&o(l,"archiveBtn"),e))+`</button>
</div>
<div class="patient__actions" data-add-workflow-region>
  <span class="button-primary">
    <span class="js-loading">
      `+a((o(i,"far")||e&&o(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"circle-plus",{name:"far",hash:{},data:n,loc:{start:{line:12,column:6},end:{line:12,column:27}}}))+`
      <span>`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"patient"))&&o(l,"dashboard"))&&o(l,"dashboardViews"))&&o(l,"actionLoading"),e))+`</span>
    </span>
  </span>
</div>
<div data-content-region></div>
`},useData:!0}),Qe=g.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="patient__empty-list">
      <h2>`+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"patient"))&&s(l,"dashboard"))&&s(l,"dashboardViews"))&&s(l,"emptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),se=A.extend({modelEvents:{editing:"onEditing",change:"onChange"},onChange(){this.view.render()},onEditing(t){this.$el.toggleClass("is-selected",t)}}),Ke=A.extend({modelEvents:{"change:_state":"onChangeState"},onChangeState(){if(this.view.model.isDone()){$({targets:this.el,delay:300,duration:500,opacity:[1,0],easing:"easeOutQuad",complete:()=>{this.view.triggerMethod("change:visible")}});return}this.$el.css({opacity:1}),this.view.triggerMethod("change:visible")}}),Je=g.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[se,Ke],regions:{state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",form:"[data-form-region]"},template:Ue,templateContext(){return{icon:this.model.hasOutreach()?"share-from-square":"file-lines",hasAttachments:this.model.hasAttachments()}},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","patient:action",this.model.get("_patient"),this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner(),this.showDueDate(),this.showDueTime(),this.showForm()},showState(){if(!this.canEdit){const e=new V({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new v({stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new _({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0});this.listenTo(e,"change:owner",i=>{this.model.saveOwner(i)}),this.showChildView("owner",e)},showDueDate(){if(!this.canEdit){const e=new R({model:this.model});this.showChildView("dueDate",e);return}const t=new x({date:this.model.get("due_date"),isCompact:!0,isOverdue:this.model.isOverdue()});this.listenTo(t,"change:due",e=>{this.model.saveDueDate(e)}),this.showChildView("dueDate",t)},showDueTime(){if(!this.canEdit){const i=new q({model:this.model});this.showChildView("dueTime",i);return}const t=!this.model.get("due_date"),e=new D({time:this.model.get("due_time"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()});this.listenTo(e,"change:time",i=>{this.model.saveDueTime(i)}),this.showChildView("dueTime",e)},showForm(){this.model.getForm()&&this.showChildView("form",new G({model:this.model}))}}),Ze=g.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[se],regions:{owner:"[data-owner-region]"},template:Ye,templateContext(){return{stateOptions:this.model.getState().get("options")}},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","flow",this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showOwner()},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new _({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0});this.listenTo(e,"change:owner",i=>{this.model.saveOwner(i)}),this.showChildView("owner",e)}}),Xe=E.extend({childViewEvents:{"change:visible":"filter"},className:"table-list patient__list",tagName:"table",childView(t){return t.type==="flows"?Ze:Je},emptyView:Qe,viewComparator(t,e){return F("desc",t.model.get("updated_at"),e.model.get("updated_at"))},viewFilter({model:t}){return!t.isDone()}}),et=g.extend({className:"flex-region patient__content",regions:{content:{el:"[data-content-region]",regionClass:T,replaceElement:!0},addWorkflow:"[data-add-workflow-region]"},ui:{loading:".js-loading"},template:Ne,triggers:{"click .js-archive":"click:archive"},onClickArchive(){p.trigger("event-router","patient:archive",this.model.id)},onRender(){$({targets:this.ui.loading[0],opacity:.5,loop:!0,easing:"easeInOutSine",duration:400,direction:"alternate"})}}),tt=S.extend({childApps:{addWorkflow:ze},onBeforeStart({patient:t}){this.currentUser=p.request("bootstrap","currentUser"),this.patient=t,this.showView(new et({model:t})),this.currentUser.can("work:own")||this.getRegion("addWorkflow").empty(),this.getRegion("content").startPreloader()},beforeStart({patient:t}){const u={state:p.request("workspace","current").getStates().groupByDone().notDone.getFilterIds()};return[p.request("entities","fetch:actions:collection:byPatient",{patientId:t.id,filter:u}),p.request("entities","fetch:flows:collection:byPatient",{patientId:t.id,filter:u})]},onStart(t,e,i){this.collection=new k.Collection([...e.models,...i.models]),this.showChildView("content",new Xe({collection:this.collection})),this.startAddWorkflow()},startAddWorkflow(){if(!this.currentUser.can("work:own"))return;const t=this.startChildApp("addWorkflow",{region:this.getRegion("addWorkflow"),patient:this.patient});this.listenTo(t,{"add:programAction":this.onAddProgramAction,"add:programFlow":this.onAddProgramFlow})},onAddProgramAction(t){const e=t.getAction({patientId:this.patient.id});e.saveAll().then(()=>{this.collection.unshift(e),p.trigger("event-router","patient:action",this.patient.id,e.id)})},onAddProgramFlow(t){const e=t.getFlow(this.patient.id);e.saveAll().then(()=>{p.trigger("event-router","flow",e.id)})}}),st=h.template({1:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return'<span class="patient__action-attachment">'+t.escapeExpression((l(i,"far")||e&&l(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"paperclip",{name:"far",hash:{},data:n,loc:{start:{line:13,column:65},end:{line:13,column:84}}}))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`<td class="table-list__cell">
  <span class="patient__action-icon">`+r((c(i,"far")||e&&c(e,"far")||o).call(a,e!=null?c(e,"icon"):e,{name:"far",hash:{},data:n,loc:{start:{line:2,column:37},end:{line:2,column:49}}}))+"</span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:56},end:{line:2,column:81}}}):s))+'<span class="patient__action-name">'+r((s=(s=c(i,"name")||(e!=null?c(e,"name"):e))!=null?s:o,typeof s===d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:3,column:37},end:{line:3,column:47}}}):s))+`</span>
</td>
<td class="table-list__cell patient__list-meta">
  <span class="table-list__meta" data-state-region></span>`+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:58},end:{line:6,column:83}}}):s))+'<span class="table-list__meta" data-owner-region></span>'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:58},end:{line:7,column:83}}}):s))+'<span class="table-list__meta">'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:8,column:33},end:{line:8,column:58}}}):s))+"<span data-due-date-region></span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:38},end:{line:9,column:63}}}):s))+"<span data-due-time-region></span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:10,column:38},end:{line:10,column:63}}}):s))+"</span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:11,column:9},end:{line:11,column:34}}}):s))+'<span class="table-list__meta" data-form-region></span>'+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:12,column:57},end:{line:12,column:82}}}):s))+((l=c(i,"if").call(a,e!=null?c(e,"hasAttachments"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:13,column:2},end:{line:13,column:98}}}))!=null?l:"")+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:98},end:{line:13,column:123}}}):s))+'<span class="patient__action-ts">'+r((c(i,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:14,column:35},end:{line:14,column:78}}}))+"</span>"+r((s=(s=c(i,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:14,column:85},end:{line:14,column:110}}}):s))+`</td>
`},useData:!0}),lt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,f){if(Object.prototype.hasOwnProperty.call(w,f))return w[f]};return`    <td class="table-list__cell">
      <span class="patient__flow-icon">`+r((m(i,"fas")||e&&m(e,"fas")||o).call(a,"folder",{name:"fas",hash:{},data:n,loc:{start:{line:2,column:39},end:{line:2,column:55}}}))+"</span>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:62},end:{line:2,column:87}}}):s))+'<span class="patient__action-name">'+r((s=(s=m(i,"name")||(e!=null?m(e,"name"):e))!=null?s:o,typeof s===d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:3,column:41},end:{line:3,column:51}}}):s))+`</span>
    </td>
    <td class="table-list__cell patient__list-meta">
      <span class="table-list__meta" data-state-region></span>`+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:62},end:{line:6,column:87}}}):s))+'<span class="table-list__meta" data-owner-region></span>'+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:62},end:{line:7,column:87}}}):s))+'<progress class="progress-bar patient__flow-progress" value='+r(c((l=e!=null?m(e,"_progress"):e)!=null?m(l,"complete"):l,e))+" max="+r(c((l=e!=null?m(e,"_progress"):e)!=null?m(l,"total"):l,e))+"></progress>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:8,column:128},end:{line:8,column:153}}}):s))+'<span class="patient__action-ts">'+r((m(i,"formatDateTime")||e&&m(e,"formatDateTime")||o).call(a,e!=null?m(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:9,column:39},end:{line:9,column:82}}}))+"</span>"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:89},end:{line:9,column:114}}}):s))+`</td>
`},useData:!0}),nt=g.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="patient__empty-list">
      <h2>`+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"patient"))&&s(l,"archive"))&&s(l,"archiveViews"))&&s(l,"emptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),le=A.extend({modelEvents:{editing:"onEditing",change:"onChange"},onChange(){this.view.render()},onEditing(t){this.$el.toggleClass("is-selected",t)}}),ne=A.extend({modelEvents:{"change:_state":"onChangeState"},onChangeState(){if(!this.view.model.isDone()){$({targets:this.el,delay:300,duration:500,opacity:[1,0],easing:"easeOutQuad",complete:()=>{this.view.triggerMethod("change:visible")}});return}this.$el.css({opacity:1}),this.view.triggerMethod("change:visible")}}),it=g.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[le,ne],regions:{state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",form:"[data-form-region]"},template:st,templateContext(){return{icon:this.model.hasOutreach()?"share-from-square":"file-lines",hasAttachments:this.model.hasAttachments()}},triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","patient:action",this.model.get("_patient"),this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner(),this.showDueDay(),this.showDueTime(),this.showForm()},showState(){if(!this.canEdit){const e=new V({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new v({stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new _({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0,state:{isDisabled:!0}});this.showChildView("owner",e)},showDueDay(){if(!this.canEdit){const e=new R({model:this.model});this.showChildView("dueDate",e);return}const t=new x({date:this.model.get("due_date"),isCompact:!0,state:{isDisabled:!0},isOverdue:this.model.isOverdue()});this.showChildView("dueDate",t)},showDueTime(){if(!this.canEdit){const e=new q({model:this.model});this.showChildView("dueTime",e);return}const t=new D({time:this.model.get("due_time"),isCompact:!0,state:{isDisabled:!0},isOverdue:this.model.isOverdue()});this.showChildView("dueTime",t)},showForm(){this.model.getForm()&&this.showChildView("form",new G({model:this.model}))}}),at=g.extend({className:"table-list__item",tagName:"tr",modelEvents:{"change:_owner":"render"},behaviors:[le,ne],regions:{state:"[data-state-region]",owner:"[data-owner-region]"},template:lt,triggers:{click:"click","click .js-no-click":"prevent-row-click"},onClick(){p.trigger("event-router","flow",this.model.id)},onRender(){this.canEdit=this.model.canEdit(),this.showState(),this.showOwner()},showState(){if(!this.canEdit){const e=new V({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new v({stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const i=new C({model:this.model,isCompact:!0});this.showChildView("owner",i);return}const t=this.model.getProgram(),e=new _({owner:this.model.getOwner(),workspaces:t.getUserWorkspaces(),isCompact:!0,state:{isDisabled:!0}});this.showChildView("owner",e)}}),ot=E.extend({childViewEvents:{"change:visible":"filter"},className:"table-list patient__list",tagName:"table",childView(t){return t.type==="flows"?at:it},emptyView:nt,viewComparator({model:t},{model:e}){return F("desc",t.get("updated_at"),e.get("updated_at"))},viewFilter({model:t}){return t.type==="patient-events"||t.isDone()}}),rt=g.extend({className:"flex-region patient__content",regions:{content:{el:"[data-content-region]",regionClass:T,replaceElement:!0}},template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`
    <div>
      <button class="patient__tab js-dashboard">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"patient"))&&o(l,"archive"))&&o(l,"archiveViews"))&&o(l,"dashboardBtn"),e))+`</button>
      <span class="patient__tab--selected">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"patient"))&&o(l,"archive"))&&o(l,"archiveViews"))&&o(l,"archiveBtn"),e))+`</span>
    </div>
    <div data-content-region></div>
  `},useData:!0}),triggers:{"click .js-dashboard":"click:dashboard"},onClickDashboard(){p.trigger("event-router","patient:dashboard",this.model.id)}}),ct=S.extend({onBeforeStart({patient:t}){this.showView(new rt({model:t})),this.getRegion("content").startPreloader()},beforeStart({patient:t}){const u={state:p.request("workspace","current").getStates().groupByDone().done.getFilterIds()};return[p.request("entities","fetch:actions:collection:byPatient",{patientId:t.id,filter:u}),p.request("entities","fetch:flows:collection:byPatient",{patientId:t.id,filter:u})]},onStart({patient:t},e,i){this.collection=new k.Collection([...e.models,...i.models]),this.showChildView("content",new ot({collection:this.collection}))}}),ut=g.extend({className:"patient__context-trail",template:h.template({1:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`      <a class="js-back patient__context-link">
        `+o((r(i,"fas")||e&&r(e,"fas")||a).call(s,"chevron-left",{name:"fas",hash:{},data:n,loc:{start:{line:4,column:8},end:{line:4,column:30}}}))+o(t.lambda((l=(l=(l=(l=n&&r(n,"intl"))&&r(l,"patients"))&&r(l,"patient"))&&r(l,"patientViews"))&&r(l,"contextBackBtn"),e))+`
      </a>
      `+o((r(i,"fas")||e&&r(e,"fas")||a).call(s,"chevron-right",{name:"fas",hash:{},data:n,loc:{start:{line:6,column:6},end:{line:6,column:29}}}))+`
    `},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r="function",d=t.escapeExpression,c=t.lookupProperty||function(m,w){if(Object.prototype.hasOwnProperty.call(m,w))return m[w]};return`
`+((l=c(i,"if").call(a,e!=null?c(e,"hasLatestList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:4},end:{line:7,column:11}}}))!=null?l:"")+d((s=(s=c(i,"first_name")||(e!=null?c(e,"first_name"):e))!=null?s:o,typeof s===r?s.call(a,{name:"first_name",hash:{},data:n,loc:{start:{line:7,column:11},end:{line:7,column:27}}}):s))+" "+d((s=(s=c(i,"last_name")||(e!=null?c(e,"last_name"):e))!=null?s:o,typeof s===r?s.call(a,{name:"last_name",hash:{},data:n,loc:{start:{line:7,column:28},end:{line:7,column:43}}}):s))+`
  `},useData:!0}),triggers:{"click .js-back":"click:back"},modelEvents:{"change:first_name change:last_name":"render"},onClickBack(){p.request("history","go:latestList")},templateContext(){return{hasLatestList:p.request("history","has:latestList")}}}),mt=g.extend({className:"patient__frame",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){return`
    <div class="patient__layout">
        <div data-context-trail-region></div>
        <div data-content-region></div>
    </div>
    <div class="patient__sidebar" data-sidebar-region></div>
  `},useData:!0}),regions:{contextTrail:{el:"[data-context-trail-region]",replaceElement:!0},sidebar:"[data-sidebar-region]",content:{el:"[data-content-region]",regionClass:T,replaceElement:!0}},onRender(){this.showChildView("contextTrail",new ut({model:this.model}))}}),Gt=K.extend({eventRoutes(){return{"patient:dashboard":L(this.startCurrent,"dashboard"),"patient:archive":L(this.startCurrent,"archive"),"patient:action":this.startPatientAction}},childApps:{dashboard:tt,archive:ct,action:ee,patient:Z},currentAppOptions(){return{region:this.getRegion("content"),patient:this.getOption("patient")}},onBeforeStart(){this.getRegion().startPreloader()},beforeStart({patientId:t}){return p.request("entities","fetch:patients:model",t)},onFail(t,{response:e}){e.status===410&&(p.trigger("event-router","notFound"),this.stop())},onStart({currentRoute:t},e){this.patient=e,this.setView(new mt({model:e})),this.showSidebar(),this.startRoute(t),this.showView()},startPatientAction(t,e){const i=this.getChildApp("action");this.listenToOnce(i,{start(u,n){this.editActionList(n)},fail(){this.startCurrent("dashboard")}}),this.startChildApp("action",{actionId:e,patientId:t})},startActionList(t){return t.isDone()?this.startCurrent("archive"):this.startCurrent("dashboard")},editActionList(t){const e=this.getCurrent()||this.startActionList(t);if(!e.isRunning()){this.listenToOnce(e,"start",()=>{t.trigger("editing",!0)});return}t.trigger("editing",!0)},showSidebar(){this.startChildApp("patient",{region:this.getRegion("sidebar"),patient:this.patient})}}),$t=k.Model.extend({preinitialize(){const e=p.request("workspace","current").getStates(),{done:i,notDone:u}=e.groupByDone();this.states={done:i,notDone:u,all:e}},defaults(){const t=this.get("isDoneOnly"),e=this.states.done.map("id"),i=this.states.notDone.map("id");return{customFilters:{},states:t?e:i,flowStates:i}},initialize(){this.initStates(),this.setFiltersCount=M(this.setFiltersCount,30),this.on("change:customFilters change:states change:flowStates change:listType",this.setFiltersCount),this.setFiltersCount()},isFlowType(){return this.get("listType")==="flows"},initStates(){const t=this.getAvailableStates().map("id");this.set({states:W(this.get("states"),t),flowStates:W(this.get("flowStates"),t)})},getFiltersState(){return{filtersCount:this.get("filtersCount"),customFilters:this.get("customFilters"),states:this.get("states"),flowStates:this.get("flowStates")}},_isSameIds(t,e){return de(H(t),H(e))},setFiltersCount(){const{states:t,flowStates:e}=this.defaults(),i=he(pe(this.get("customFilters"),we)),u=this._isSameIds(this.get("states"),t)?0:1;if(this.isFlowType())return this.set("filtersCount",i+u);const n=this._isSameIds(this.get("flowStates"),e)?0:1;return this.set("filtersCount",i+u+n)},getAvailableStates(){return this.get("isDoneOnly")?this.states.done:this.states.all},setDefaultFilterStates(){return this.set(this.defaults())},selectStatesFilter(t,e,i="states"){const u=B(this.get(`${i}`));return e?this.set(i,[...u,t]):this.set(i,ge(u,t))},selectFlowStatesFilter(t,e){return this.selectStatesFilter(t,e,"flowStates")},getFilter(t){return this.get("customFilters")[t]},setFilter(t,e){const i=B(this.get("customFilters"));return i[t]=e,this.set("customFilters",i)}}),dt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return'<span class="list__title-filter-name">'+o((l=(l=r(i,"name")||(e!=null?r(e,"name"):e))!=null?l:a,typeof l=="function"?l.call(s,{name:"name",hash:{},data:n,loc:{start:{line:1,column:38},end:{line:1,column:48}}}):l))+"</span>"+o((r(i,"far")||e&&r(e,"far")||a).call(s,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:55},end:{line:1,column:75}}}))},useData:!0}),ht=h.template({1:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return"      "+t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||s).call(l,(a(i,"intlGet")||e&&a(e,"intlGet")||s).call(l,"patients.shared.listViews.countView.flowsCount",{name:"intlGet",hash:{},data:n,loc:{start:{line:4,column:22},end:{line:4,column:80}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"count"):e},data:n,loc:{start:{line:4,column:6},end:{line:4,column:98}}}))+`
`},3:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return"      "+t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||s).call(l,(a(i,"intlGet")||e&&a(e,"intlGet")||s).call(l,"patients.shared.listViews.countView.actionsCount",{name:"intlGet",hash:{},data:n,loc:{start:{line:6,column:22},end:{line:6,column:82}}}),{name:"formatMessage",hash:{itemCount:e!=null?a(e,"count"):e},data:n,loc:{start:{line:6,column:6},end:{line:6,column:100}}}))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
  <strong>
`+((l=s(i,"if").call(e??(t.nullContext||{}),e!=null?s(e,"isFlowList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(3,n,0),data:n,loc:{start:{line:3,column:4},end:{line:7,column:11}}}))!=null?l:"")+`  </strong>
`},useData:!0}),pt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
  <div>`+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(s,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(s,"patients.shared.listViews.countView.maximumListCount",{name:"intlGet",hash:{},data:n,loc:{start:{line:2,column:23},end:{line:2,column:87}}}),{name:"formatMessage",hash:{isFlowList:e!=null?r(e,"isFlowList"):e,totalInDb:e!=null?r(e,"totalInDb"):e,maximumCount:e!=null?r(e,"maximumCount"):e},data:n,loc:{start:{line:2,column:7},end:{line:2,column:157}}}))+`</div>
  <div>`+o(t.lambda((l=(l=(l=(l=(l=n&&r(n,"intl"))&&r(l,"patients"))&&r(l,"shared"))&&r(l,"listViews"))&&r(l,"countView"))&&r(l,"narrowFilters"),e))+`</div>
`},useData:!0}),wt=h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
  <div>
    `+o((r(i,"formatMessage")||e&&r(e,"formatMessage")||a).call(s,(r(i,"intlGet")||e&&r(e,"intlGet")||a).call(s,"patients.shared.listViews.countView.maximumListCountNarrowed",{name:"intlGet",hash:{},data:n,loc:{start:{line:3,column:20},end:{line:3,column:92}}}),{name:"formatMessage",hash:{isFlowList:e!=null?r(e,"isFlowList"):e,maximumCount:e!=null?r(e,"maximumCount"):e,itemCount:e!=null?r(e,"count"):e},data:n,loc:{start:{line:3,column:4},end:{line:3,column:158}}}))+`
  </div>
  <div>`+o(t.lambda((l=(l=(l=(l=(l=n&&r(n,"intl"))&&r(l,"patients"))&&r(l,"shared"))&&r(l,"listViews"))&&r(l,"countView"))&&r(l,"narrowFilters"),e))+`</div>
`},useData:!0}),Wt=g.extend({initialize(){const t=this.getOption("isFlowList")?"flows":"actions";this.totalInDb=fe(this.collection.getMeta(t),"total")},getTemplate(){const t=this.getOption("filteredCollection");if(!this.collection||!t.length)return h.template({compiler:[8,">= 4.3.0"],main:function(u,n,l,s,a){return""},useData:!0});const e=this.collection.length<this.totalInDb,i=e&&t.length<this.collection.length;return e?i?wt:pt:ht},templateContext(){const t=this.getOption("filteredCollection");return{maximumCount:this.collection.length,count:t.length,isFlowList:!!this.getOption("isFlowList"),totalInDb:this.totalInDb}}}),gt=_.extend({align:"right",popWidth:null,viewOptions:{className:"list__title-filter-button",template:dt}}),ft=h.template({1:function(t,e,i,u,n){return`      <div class="flex u-margin--r-24" data-select-all-region></div>
`},3:function(t,e,i,u,n){return" is-reduced"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return`<div class="list-page__header">
  <div class="flex list-page__title">
    <div data-title-region></div>
    <div class="schedule__list-search" data-search-region></div>
  </div>
  <div class="list-page__filters flex">
`+((l=a(i,"unless").call(s,e!=null?a(e,"isReduced"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:7,column:4},end:{line:9,column:15}}}))!=null?l:"")+`    <div class="flex flex-align-center w-100" data-filters-region></div>
    <div class="schedule__count`+((l=a(i,"if").call(s,e!=null?a(e,"isReduced"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:11,column:31},end:{line:11,column:66}}}))!=null?l:"")+`" data-count-region></div>
    <div class="flex u-text--nowrap" data-date-filter-region></div>
  </div>
  <table class="w-100" data-table-region></table>
</div>
<div class="flex-region list-page__list" data-list-region></div>
`},useData:!0}),Ht=g.extend({className:"flex-region",template:ft,regions:{filters:"[data-filters-region]",table:"[data-table-region]",list:{el:"[data-list-region]",regionClass:T},selectAll:"[data-select-all-region]",title:{el:"[data-title-region]",replaceElement:!0},dateFilter:"[data-date-filter-region]",search:"[data-search-region]",count:"[data-count-region]"},templateContext(){return{isReduced:this.getOption("isReduced")}}}),bt=g.extend({className:"u-text--nowrap",getTemplate(){return this.getOption("owner")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(i,"formatMessage")||e&&a(e,"formatMessage")||s).call(l,(a(i,"intlGet")||e&&a(e,"intlGet")||s).call(l,"patients.schedule.scheduleViews.titleLabelView.title",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:80}}}),{name:"formatMessage",hash:{owner:e!=null?a(e,"owner"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:94}}}))},useData:!0}):h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"schedule"))&&s(l,"scheduleViews"))&&s(l,"titleLabelView"))&&s(l,"label"),e))},useData:!0})},templateContext(){return{owner:this.getOption("owner")}}}),zt=g.extend({regions:{label:"[data-label-region]",owner:"[data-owner-filter-region]"},className:"flex list-page__title-filter",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=e??(t.nullContext||{}),s=t.hooks.helperMissing,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`
    <span class="list-page__title-icon">`+a((o(i,"far")||e&&o(e,"far")||s).call(l,"calendar-star",{name:"far",hash:{},data:n,loc:{start:{line:2,column:40},end:{line:2,column:63}}}))+`</span>
    <div data-label-region></div>
    <div data-owner-filter-region></div>
    <span class="list-page__header-icon js-title-info">`+a((o(i,"far")||e&&o(e,"far")||s).call(l,"circle-info",{name:"far",hash:{},data:n,loc:{start:{line:5,column:55},end:{line:5,column:76}}}))+`</span>
  `},useData:!0}),ui:{tooltip:".js-title-info"},initialize(){const t=p.request("bootstrap","currentUser");this.shouldShowDroplist=t.can("app:schedule:clinician_filter"),this.owner=this.model.getOwner()},onRender(){this.showLabel(),this.showOwnerDroplist(),new _e({message:P.patients.schedule.scheduleViews.scheduleTitleView.tooltip,uiView:this,ui:this.ui.tooltip,orientation:"vertical"})},showLabel(){const t=new bt({owner:this.shouldShowDroplist?null:this.owner.get("name")});this.showChildView("label",t)},showOwnerDroplist(){if(!this.shouldShowDroplist)return;const t=new gt({owner:this.owner,hasTeams:!1});this.listenTo(t,"change:owner",e=>{this.triggerMethod("change:owner",e)}),this.showChildView("owner",t)}}),Ut=g.extend({tagName:"button",className:"button--link-large",template:h.template({1:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"("+t.escapeExpression((l=(l=s(i,"filtersCount")||(e!=null?s(e,"filtersCount"):e))!=null?l:t.hooks.helperMissing,typeof l=="function"?l.call(e??(t.nullContext||{}),{name:"filtersCount",hash:{},data:n,loc:{start:{line:1,column:133},end:{line:1,column:149}}}):l))+")"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(i,"far")||e&&o(e,"far")||t.hooks.helperMissing).call(s,"sliders",{name:"far",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:17}}}))+"<span>"+a(t.lambda((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"schedule"))&&o(l,"scheduleViews"))&&o(l,"allFiltersButtonView"))&&o(l,"allFiltersButton"),e))+"</span> "+((l=o(i,"if").call(s,e!=null?o(e,"filtersCount"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:1,column:112},end:{line:1,column:157}}}))!=null?l:"")},useData:!0}),triggers:{click:"click"},modelEvents:{"change:filtersCount":"render"}}),Yt=g.extend({tagName:"button",className:"button--checkbox",attributes(){if(this.getOption("isDisabled"))return{disabled:"disabled"}},triggers:{click:"click"},getTemplate(){return this.getOption("isSelectAll")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fas")||e&&l(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-check",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0}):this.getOption("isSelectNone")||this.getOption("isDisabled")?h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fal")||e&&l(e,"fal")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square",{name:"fal",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:16}}}))},useData:!0}):h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"fas")||e&&l(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-minus",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0})}}),Nt=g.extend({template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lambda,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return`
    <td class="schedule-list__header schedule-list__header-due-date">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"schedule"))&&o(l,"scheduleViews"))&&o(l,"tableHeaderView"))&&o(l,"dueDateHeader"),e))+`</td>
    <td class="schedule-list__header schedule-list__header-state-patient">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"schedule"))&&o(l,"scheduleViews"))&&o(l,"tableHeaderView"))&&o(l,"patientHeader"),e))+`</td>
    <td class="schedule-list__header schedule-list__header-action">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"schedule"))&&o(l,"scheduleViews"))&&o(l,"tableHeaderView"))&&o(l,"actionHeader"),e))+`</td>
    <td class="schedule-list__header schedule-list__header-form">`+a(s((l=(l=(l=(l=(l=n&&o(n,"intl"))&&o(l,"patients"))&&o(l,"schedule"))&&o(l,"scheduleViews"))&&o(l,"tableHeaderView"))&&o(l,"formheader"),e))+`</td>
  `},useData:!0}),tagName:"tr"}),_t=g.extend({tagName:"tr",className(){const t="schedule-list__day-list-row";return this.getOption("state").get("isReduced")?`${t} is-reduced`:t},template:h.template({1:function(t,e,i,u,n){return"is-overdue"},3:function(t,e,i,u,n){return'<span class="u-margin--r-8" data-check-region></span>'},5:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return"        "+t.escapeExpression((l(i,"formatDateTime")||e&&l(e,"formatDateTime")||t.hooks.helperMissing).call(e??(t.nullContext||{}),e!=null?l(e,"due_time"):e,"TIME",{name:"formatDateTime",hash:{inputFormat:"HH:mm:ss"},data:n,loc:{start:{line:5,column:8},end:{line:5,column:65}}}))+`&#8203;
`},7:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return'        <span class="schedule-list__no-time">'+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"schedule"))&&s(l,"scheduleViews"))&&s(l,"dayItemView"))&&s(l,"noTime"),e))+`</span>&#8203;
`},9:function(t,e,i,u,n){return"is-reduced"},11:function(t,e,i,u,n){return"js-patient"},13:function(t,e,i,u,n){return"js-action"},15:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return'<span class="js-form schedule-list__action-form-icon">'+((l=s(i,"if").call(e??(t.nullContext||{}),e!=null?s(e,"hasOutreach"):e,{name:"if",hash:{},fn:t.program(16,n,0),inverse:t.program(18,n,0),data:n,loc:{start:{line:29,column:72},end:{line:29,column:165}}}))!=null?l:"")+"</span>"},16:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"far")||e&&l(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"share-from-square",{name:"far",hash:{},data:n,loc:{start:{line:29,column:91},end:{line:29,column:118}}}))},18:function(t,e,i,u,n){var l=t.lookupProperty||function(s,a){if(Object.prototype.hasOwnProperty.call(s,a))return s[a]};return t.escapeExpression((l(i,"far")||e&&l(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-poll-horizontal",{name:"far",hash:{},data:n,loc:{start:{line:29,column:126},end:{line:29,column:158}}}))},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",c=t.lambda,m=t.lookupProperty||function(w,f){if(Object.prototype.hasOwnProperty.call(w,f))return w[f]};return`
    <td class="schedule-list__action-list-cell schedule-list__due-time `+((l=m(i,"if").call(a,e!=null?m(e,"isOverdue"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:71},end:{line:2,column:105}}}))!=null?l:"")+`">
      `+((l=m(i,"unless").call(a,e!=null?m(e,"isReduced"):e,{name:"unless",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:3,column:6},end:{line:3,column:91}}}))!=null?l:"")+`
`+((l=m(i,"if").call(a,e!=null?m(e,"due_time"):e,{name:"if",hash:{},fn:t.program(5,n,0),inverse:t.program(7,n,0),data:n,loc:{start:{line:4,column:6},end:{line:8,column:13}}}))!=null?l:"")+`    </td>
    <td class="schedule-list__action-list-cell schedule-list__patient">
      <div class="schedule-list__patient-details">
        <span class="schedule-list__patient-sidebar-icon">
          <button class="js-patient-sidebar-button">
            `+r((m(i,"far")||e&&m(e,"far")||o).call(a,"address-card",{name:"far",hash:{},data:n,loc:{start:{line:14,column:12},end:{line:14,column:34}}}))+`
          </button>
        </span>&#8203;`+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:22},end:{line:16,column:47}}}):s))+'<span class="schedule-list__patient-name '+((l=m(i,"if").call(a,e!=null?m(e,"isReduced"):e,{name:"if",hash:{},fn:t.program(9,n,0),inverse:t.program(11,n,0),data:n,loc:{start:{line:17,column:49},end:{line:17,column:101}}}))!=null?l:"")+'">'+r(c((l=e!=null?m(e,"patient"):e)!=null?m(l,"first_name"):l,e))+" "+r(c((l=e!=null?m(e,"patient"):e)!=null?m(l,"last_name"):l,e))+`</span>&#8203;
      </div>
    </td>
    <td class="schedule-list__action-list-cell">
      <div class="schedule-list__action-state-name">
        <span class="schedule-list__action-state action--`+r(c((l=e!=null?m(e,"stateOptions"):e)!=null?m(l,"color"):l,e))+'">'+r((m(i,"fa")||e&&m(e,"fa")||o).call(a,(l=e!=null?m(e,"stateOptions"):e)!=null?m(l,"iconType"):l,(l=e!=null?m(e,"stateOptions"):e)!=null?m(l,"icon"):l,{name:"fa",hash:{},data:n,loc:{start:{line:22,column:83},end:{line:22,column:129}}}))+'</span><span class="schedule-list__search-helper">'+r((s=(s=m(i,"state")||(e!=null?m(e,"state"):e))!=null?s:o,typeof s===d?s.call(a,{name:"state",hash:{},data:n,loc:{start:{line:22,column:179},end:{line:22,column:190}}}):s))+"</span>&#8203;"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:22,column:204},end:{line:22,column:229}}}):s))+'<span class="'+((l=m(i,"unless").call(a,e!=null?m(e,"isReduced"):e,{name:"unless",hash:{},fn:t.program(13,n,0),inverse:t.noop,data:n,loc:{start:{line:23,column:21},end:{line:23,column:62}}}))!=null?l:"")+'">'+r((s=(s=m(i,"name")||(e!=null?m(e,"name"):e))!=null?s:o,typeof s===d?s.call(a,{name:"name",hash:{},data:n,loc:{start:{line:23,column:64},end:{line:23,column:74}}}):s))+"</span>&#8203;"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:23,column:88},end:{line:23,column:113}}}):s))+'<span class="schedule-list__search-helper">'+r((s=(s=m(i,"flow")||(e!=null?m(e,"flow"):e))!=null?s:o,typeof s===d?s.call(a,{name:"flow",hash:{},data:n,loc:{start:{line:24,column:51},end:{line:24,column:61}}}):s))+"</span>&#8203;"+r((s=(s=m(i,"remove_whitespace")||(e!=null?m(e,"remove_whitespace"):e))!=null?s:o,typeof s===d?s.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:24,column:75},end:{line:24,column:100}}}):s))+`</div>
    </td>
    <td class="schedule-list__action-list-cell schedule-list__action-details" data-details-region></td>
    <td class="schedule-list__action-list-cell schedule-list__action-form">
      `+((l=m(i,"if").call(a,e!=null?m(e,"form"):e,{name:"if",hash:{},fn:t.program(15,n,0),inverse:t.noop,data:n,loc:{start:{line:29,column:6},end:{line:29,column:179}}}))!=null?l:"")+`
    </td>
  `},useData:!0}),regions:{check:"[data-check-region]",details:"[data-details-region]"},templateContext(){const t=this.model.getState();return{isOverdue:this.model.isOverdue(),state:t.get("name"),stateOptions:t.get("options"),patient:this.model.getPatient().attributes,form:this.model.getForm(),flow:this.model.getFlow()&&this.model.getFlow().get("name"),hasOutreach:this.model.hasOutreach(),isReduced:this.isReduced}},ui:{actionName:".js-action"},triggers:{"click .js-form":"click:form","click .js-patient-sidebar-button":"click:patientSidebarButton","click .js-patient":"click:patient",click:"click"},modelEvents:{change:"render"},initialize({state:t}){this.state=t,this.flow=this.model.getFlow(),this.isReduced=t.get("isReduced"),this.listenTo(t,{"select:multiple":this.showCheck,"select:none":this.showCheck})},onRender(){const t=this.canEdit;this.canEdit=!this.model.isFlowDone()&&this.model.canEdit(),this.showDetailsTooltip(),this.showCheck(),t!==this.canEdit&&(this.canEdit||this.toggleSelected(!1),this.triggerMethod("change:canEdit"))},toggleSelected(t){this.$el.toggleClass("is-selected",t)},showCheck(){if(this.isReduced||!this.canEdit)return;const t=this.state.isSelected(this.model);this.toggleSelected(t);const e=new J({state:{isSelected:t}});this.listenTo(e,{select(i){this.triggerMethod("select",this,!!i.shiftKey)},"change:isSelected":this.toggleSelected}),this.showChildView("check",e)},onClickPatientSidebarButton(){const t=this.model.getPatient(),e=p.request("sidebar","start","patient",{patient:t});this.on("destroy",()=>e.stop())},onClickPatient(){p.trigger("event-router","patient:dashboard",this.model.get("_patient"))},onClickForm(){p.trigger("event-router","form:patientAction",this.model.id,this.model.getForm().id)},onClick(){if(!this.isReduced){if(this.flow){p.trigger("event-router","flow:action",this.flow.id,this.model.id);return}p.trigger("event-router","patient:action",this.model.get("_patient"),this.model.id)}},showDetailsTooltip(){this.model.get("details")&&this.showChildView("details",new ve({model:this.model}))}}),kt=E.extend({childView:_t,childViewOptions(){return{state:this.state}},tagName:"tr",className:"schedule-list__list-row",template:h.template({1:function(t,e,i,u,n){return"is-today"},compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,c){if(Object.prototype.hasOwnProperty.call(d,c))return d[c]};return`
    <td class="schedule-list__list-cell">
      <div class="schedule-list__row-header">
        <span class="schedule-list__date `+((l=r(i,"if").call(s,e!=null?r(e,"isToday"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:4,column:41},end:{line:4,column:71}}}))!=null?l:"")+'">'+o((r(i,"formatDateTime")||e&&r(e,"formatDateTime")||a).call(s,e!=null?r(e,"date"):e,"D",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:4,column:73},end:{line:4,column:100}}}))+`</span>
        <span class="schedule-list__month-day">`+o((r(i,"formatDateTime")||e&&r(e,"formatDateTime")||a).call(s,e!=null?r(e,"date"):e,"MMM, ddd",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:5,column:47},end:{line:5,column:81}}}))+`</span>
      </div>
      <div class="schedule-list__day-list">
        <table class="schedule-list__day-list-table w-100" data-actions-region></table>
      </div>
    </td>
  `},useData:!0}),templateContext(){const t=y(this.model.get("date")),e=y();return{isToday:t.isSame(e,"day")}},childViewContainer:"[data-actions-region]",viewComparator(t,e){return F("asc",t.model.get("due_time"),e.model.get("due_time"),"24")},initialize({state:t}){this.state=t,this.listenTo(t,"change:searchQuery",this.searchList)},onAttach(){this.searchList(null,this.state.get("searchQuery"))},childViewTriggers:{render:"listItem:render","change:canEdit":"change:canEdit",select:"select"},onSelect(t,e){this.triggerMethod("select:list:item",t,e)},onListItemRender(t){const e=y(this.model.get("date"));t.searchString=`${e.format("D")} ${e.format("MMM, ddd")} ${t.$el.text()}`},searchList(t,e){if(!e){this.removeFilter();return}const i=ye(e);this.setFilter(function({searchString:u}){return be(i,function(n){return n.test(u)})})}}),vt=g.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="table-empty-list">
      <h2>`+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"schedule"))&&s(l,"scheduleViews"))&&s(l,"emptyView"))&&s(l,"noScheduledActions"),e))+`</h2>
    </td>
  `},useData:!0})}),yt=g.extend({tagName:"tr",template:h.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,u,n){var l,s=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="table-empty-list">
      <h2>`+t.escapeExpression(t.lambda((l=(l=(l=(l=(l=n&&s(n,"intl"))&&s(l,"patients"))&&s(l,"schedule"))&&s(l,"scheduleViews"))&&s(l,"emptyFindInListView"))&&s(l,"noResults"),e))+`</h2>
    </td>
  `},useData:!0})}),Qt=E.extend({tagName:"table",className:"schedule-list__table",childView:kt,childViewOptions(t){if(t)return{collection:t.get("actions"),state:this.state}},childViewTriggers:{"select:list:item":"select","change:canEdit":"listItem:canEdit"},childViewEvents:{"render:children":"onChildFilter"},emptyView(){return this.collection.length&&this.state.get("searchQuery")?yt:vt},viewComparator(t,e){return F("asc",t.model.get("date"),e.model.get("date"))},viewFilter(t){return this.isAttached()&&this.state.get("searchQuery")?!t.isEmpty():t.model.get("date")!=="null"},initialize({state:t,editableCollection:e}){this.state=t,this.editableCollection=e,this.onListItemCanEdit=M(this.onListItemCanEdit,60)},onListItemCanEdit(){this.triggerMethod("change:canEdit")},onRenderChildren(){this.setVisibleChildren()},onChildFilter:M(function(){this.filter()},10),setVisibleChildren(){const t=this.children.reduce((e,i)=>e.concat(i.children.pluck("model")),[]);this.triggerMethod("filtered",t)},onSelect(t,e){this.state.selectRange(this.editableCollection,t.model,e)}});export{Ut as A,Bt as B,Wt as C,$t as F,Ht as L,Ce as M,Gt as P,Qt as S,Nt as T,zt as a,qt as b,Lt as c,gt as d,Ae as e,De as f,Rt as g,Te as h,It as i,Ve as j,Yt as k};
