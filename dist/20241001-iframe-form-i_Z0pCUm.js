import{E,F as T,n as A,r as d,J as y,K as C,e as w,L as b,M as x,N as F}from"./20241001-index-D02Jnlqv.js";import{r as K,c as L,d as q,R as a,B as f,b as Y}from"./20241001-runtime-o4UarWTm.js";import{A as R}from"./20241001-app-eXHVC7QN.js";import{$ as m}from"./20241001-parsePhoneNumber-A9fHhQc-.js";var _={exports:{}};/**
 * backbone.eventrouter - A highly opinionated, simplistic Backbone.Router coupled with a Backbone.Radio.Channel
 * @version v1.1.0
 * @link https://github.com/RoundingWellOS/backbone.eventrouter
 * @license MIT
 */(function(t,e){(function(r,n){t.exports=n(K,L(),q)})(E,function(r,n,h){r="default"in r?r.default:r,n="default"in n?n.default:n;var g=/(\(\?)?:\w+/,v=n.EventRouter=n.Router.extend({constructor:function(s){r.extend(this,r.pick(s,["channelName","routeTriggers"])),this.cid=r.uniqueId("bber"),this._ch=n.Radio.channel(r.result(this,"channelName")),this.listenTo(this._ch,"all",this.navigateFromEvent),n.Router.apply(this,arguments),this._initRoutes()},channelName:"event-router",getChannel:function(){return this._ch},_initRoutes:function(){this._routeTriggers=r.result(this,"routeTriggers",{}),r.each(this._routeTriggers,this._addRouteTrigger,this)},_addRouteTrigger:function(s,i){s=r.isArray(s)?s:[s],r.each(s,function(u){this.route(u,i,r.bind(this._ch.trigger,this._ch,i))},this)},addRouteTrigger:function(s,i){return this._routeTriggers[i]=s,this._addRouteTrigger(s,i),this},route:function(s,i,u){var c=n.Router.prototype.route;if(r.isFunction(i)||!u)return s=c.call(this,s,i,u),n.history.handlers[0].cid=this.cid,s;var p=r.bind(function(){var l=r.drop(arguments,0);this.trigger("before:route",i,l),this.trigger.apply(this,["before:route:"+i].concat(l)),this._storeRouteTrigger([i].concat(l)),u.apply(this,l),this._clearRouteTrigger()},this);return s=c.call(this,s,i,p),n.history.handlers[0].cid=this.cid,s},_storeRouteTrigger:function(s){this._routeArgs=this._routeArgs||[],this._routeArgs.push(s)},_getCurrentRouteTrigger:function(){return r.last(this._routeArgs)||[]},_clearRouteTrigger:function(){this._routeArgs.pop()},_isTriggeredFromRoute:function(){var s=this._getCurrentRouteTrigger();return arguments.length!==s.length?!1:arguments.length===r.union(arguments,s).length},navigateFromEvent:function(s){var i=this.getDefaultRoute(s);if(!i){var u=r.drop(arguments,0);return this.trigger.apply(this,["noMatch"].concat(u)),this}if(this._isTriggeredFromRoute.apply(this,arguments))return this;var c=r.drop(arguments,1),p=this.translateRoute(i,c);return this.navigate(p,{trigger:!1})},getDefaultRoute:function(s){var i=this._routeTriggers[s];return r.isArray(i)?i[0]:i},_replaceParam:function(s,i){return s.replace(g,i)},translateRoute:function(s,i){return r.reduce(i,this._replaceParam,s)},destroy:function(){return n.history.handlers=r.reject(n.history.handlers,{cid:this.cid}),this.stopListening(),this.trigger("destroy",this),this}});return v})})(_);var N=_.exports;const M=T(N),$=R.extend({routerAppName:"",constructor:function(){this.initRouter(),this.listenTo(this.router,"noMatch",this.onNoMatch),this.on("before:stop",this.stopCurrent),R.apply(this,arguments)},initRouter(){this._routes=A(this,"eventRoutes");const t=this.getRouteTriggers();this.router=new M({routeTriggers:t}),this.on("before:destroy",()=>this.router.destroy()),this.bindRouteEvents()},onNoMatch(){this.stop(),this._currentRoute=null},getRouteTriggers(){return d(this._routes,function(t,{route:e,root:r},n){if(r)return t[n]=e,t;const g=a.request("workspace","current").get("slug");return t[n]=e?`${g}/${e}`:g,t},{})},getEventActions(t,e){return d(t,function(r,{action:n},h){return r[h]=y(e,h,n),r},{})},bindRouteEvents(){const t=this.getEventActions(this._routes,this.routeAction);this.listenTo(this.router.getChannel(),t)},routeAction(t,e,...r){this.isRunning()||this.start(),this.triggerMethod("before:appRoute",t,...r),a.request("nav","select",this.routerAppName,t,r),a.request("sidebar","close"),this.setLatestList(t,r),this._currentRoute={event:t,eventArgs:r},C(e)||(e=this[e]),e.apply(this,r),this.triggerMethod("appRoute",t,...r)},setLatestList(t,e){if(this._routes[t].isList){a.request("history","set:latestList",t,e);return}this._routes[t].clearLatestList&&a.request("history","set:latestList",!1)},startCurrent(t,e){this.stopCurrent(),this._currentAppName=t,this._currentAppOptions=e,e=w({currentRoute:this._currentRoute},e);const r=this.startChildApp(t,e);return this._current=r,r},startRoute(t,e){return this.isCurrent(t,e)?this.getCurrent().startRoute(this.getCurrentRoute()):this.startCurrent(t,e)},getCurrent(){return this._current},isCurrent(t,e){return t===this._currentAppName&&b(e,this._currentAppOptions)},getCurrentRoute(){return this._currentRoute},stopCurrent(){this._current&&(this._current.stop(),this._current=null,this._currentAppName=null,this._currentAppOptions=null)},translateEvent(t){const e=this.router.getDefaultRoute(t);return this.router.translateRoute(e,x(arguments))},replaceRoute(){const t=this.translateEvent.apply(this,arguments);this.replaceUrl(t)},navigateRoute(){const t=this.translateEvent.apply(this,arguments);f.history.navigate(t,{trigger:!1})},replaceUrl(t){f.history.navigate(t,{trigger:!1,replace:!0})}}),j={BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,SHIFT_KEY:16,ESCAPE_KEY:27,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,AT_KEY_SHIFT:50},O=Y.extend({ui:{iframe:"iframe"},onInitialize(){this.channel=a.channel(`form${this.view.model.id}`)},replies:{send(t,e={}){this.ui.iframe[0].contentWindow.postMessage({message:t,args:e},window.origin)},focus(){a.trigger("user-activity","iframe:focus",this.ui.iframe[0])}},onAttach(){this.channel.reply(this.replies,this),m(window).on("message",({originalEvent:t})=>{const{data:e,origin:r}=t;r!==window.origin||!e||!e.message||this.channel.request(e.message,e.args)})},onBeforeDetach(){m(window).off("message"),this.channel.stopReplying(F(this.replies).join(" "))}});export{O as I,$ as R,j as k};
