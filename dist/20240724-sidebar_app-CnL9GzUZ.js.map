{"version":3,"file":"20240724-sidebar_app-CnL9GzUZ.js","sources":["../src/js/views/patients/patient/sidebar/sidebar_views.js","../src/js/apps/patients/patient/sidebar/sidebar_app.js"],"sourcesContent":["import { bind } from 'underscore';\nimport Radio from 'backbone.radio';\nimport Backbone from 'backbone';\nimport { View } from 'marionette';\nimport hbs from 'handlebars-inline-precompile';\n\nimport { PATIENT_STATUS } from 'js/static';\nimport intl from 'js/i18n';\n\nimport PreloadRegion from 'js/regions/preload_region';\n\nimport 'scss/modules/widgets.scss';\n\nimport Optionlist from 'js/components/optionlist';\n\nimport { WidgetCollectionView } from 'js/views/patients/widgets/widgets_views';\n\nimport 'scss/domain/patient-sidebar.scss';\nimport './patient-sidebar.scss';\n\nconst i18n = intl.patients.patient.sidebar.sidebarViews;\n\nconst NameView = View.extend({\n  tagName: 'h1',\n  className: 'patient-sidebar__name',\n  template: hbs`{{ first_name }} {{ last_name }}`,\n  modelEvents: {\n    'change': 'render',\n  },\n});\n\nconst SidebarView = View.extend({\n  className: 'patient-sidebar flex-region',\n  template: hbs`\n    <div data-name-region></div>\n    <span class=\"patient-sidebar__icon\">{{far \"address-card\"}}</span>\n    <button class=\"button--icon patient-sidebar__menu js-menu\">{{far \"ellipsis\"}}</button>\n    <div class=\"patient-sidebar__widgets\" data-widgets-region></div>\n  `,\n  regions: {\n    name: '[data-name-region]',\n    widgets: {\n      el: '[data-widgets-region]',\n      regionClass: PreloadRegion,\n    },\n  },\n  onRender() {\n    this.showChildView('name', new NameView({\n      model: this.model,\n    }));\n\n    this.showChildView('widgets', new WidgetCollectionView({\n      model: this.model,\n      collection: this.collection,\n      itemClassName: 'patient-sidebar__section',\n    }));\n  },\n  triggers: {\n    'click @ui.menu': 'click:menu',\n  },\n  ui: {\n    menu: '.js-menu',\n  },\n  onClickMenu() {\n    const workspacePatient = this.model.getWorkspacePatient();\n    const workspacePatientStatus = workspacePatient.get('status');\n\n    const canEditPatient = this.model.canEdit();\n\n    const menuOptions = new Backbone.Collection([\n      {\n        text: canEditPatient ? i18n.menuOptions.edit : i18n.menuOptions.view,\n        onSelect: bind(this.triggerMethod, this, canEditPatient ? 'click:patientEdit' : 'click:patientView'),\n      },\n    ]);\n\n    if (workspacePatient.canEdit()) {\n      menuOptions.push({\n        text: workspacePatientStatus !== PATIENT_STATUS.ACTIVE ? i18n.menuOptions.activate : i18n.menuOptions.inactivate,\n        onSelect: bind(this.triggerMethod, this, 'click:activeStatus'),\n      });\n\n      if (workspacePatientStatus !== PATIENT_STATUS.ARCHIVED) {\n        menuOptions.push({\n          text: i18n.menuOptions.archive,\n          onSelect: () => {\n            this.showConfirmArchiveModal();\n          },\n        });\n      }\n    }\n\n    const optionlist = new Optionlist({\n      ui: this.ui.menu,\n      uiView: this,\n      headingText: i18n.menuOptions.headingText,\n      itemTemplate: hbs`{{ text }}`,\n      lists: [{ collection: menuOptions }],\n      align: 'right',\n      popWidth: 248,\n    });\n\n    optionlist.show();\n  },\n  showConfirmArchiveModal() {\n    const modal = Radio.request('modal', 'show:small', {\n      bodyText: i18n.archiveModal.bodyText,\n      headingText: i18n.archiveModal.headingText,\n      submitText: i18n.archiveModal.submitText,\n      buttonClass: 'button--red',\n      onSubmit: () => {\n        modal.destroy();\n        this.triggerMethod('click:archivedStatus');\n      },\n    });\n  },\n});\n\nexport {\n  SidebarView,\n};\n","import { map } from 'underscore';\nimport Radio from 'backbone.radio';\n\nimport App from 'js/base/app';\n\nimport { SidebarView } from 'js/views/patients/patient/sidebar/sidebar_views';\n\nexport default App.extend({\n  viewEvents: {\n    'click:patientEdit': 'showPatientModal',\n    'click:patientView': 'showPatientModal',\n    'click:activeStatus': 'toggleActiveStatus',\n    'click:archivedStatus': 'archivePatient',\n  },\n  onBeforeStart({ patient }) {\n    this.showView(new SidebarView({ model: patient }));\n\n    this.widgets = Radio.request('widgets', 'sidebarWidgets');\n\n    this.getRegion('widgets').startPreloader();\n  },\n  beforeStart({ patient }) {\n    const workspacePatient = Radio.request('entities', 'fetch:workspacePatients:byPatient', patient.id);\n    const fields = map(Radio.request('widgets', 'sidebarWidgets:fields'), fieldName => {\n      return Radio.request('entities', 'fetch:patientFields:model', patient.id, fieldName);\n    });\n    const values = this.widgets.invoke('fetchValues', patient.id);\n\n    return [workspacePatient, ...fields, ...values];\n  },\n  onStart({ patient }) {\n    this.patient = patient;\n\n    this.showView(new SidebarView({\n      model: this.patient,\n      collection: this.widgets,\n    }));\n  },\n  showPatientModal() {\n    Radio.request('nav', 'patient', this.patient);\n  },\n  toggleActiveStatus() {\n    this.patient.toggleActiveStatus();\n  },\n  archivePatient() {\n    this.patient.setArchivedStatus();\n  },\n});\n"],"names":["i18n","intl","NameView","View","_Handlebars2","container","depth0","helpers","partials","data","helper","alias1","alias2","alias3","alias4","lookupProperty","parent","propertyName","SidebarView","PreloadRegion","WidgetCollectionView","workspacePatient","workspacePatientStatus","canEditPatient","menuOptions","Backbone","bind","PATIENT_STATUS","Optionlist","modal","Radio","PatientSidebarApp","App","patient","fields","map","fieldName","values"],"mappings":"wbAaA,MAAMA,EAAOC,EAAK,SAAS,QAAQ,QAAQ,aACrCC,EAAWC,EAAK,OAAO,CAC3B,QAAS,KACT,UAAW,wBACX,SAAUC,EAAa,SAAS,CAC9B,SAAY,CAAC,EAAG,UAAU,EAC1B,KAAQ,SAAUC,EAAWC,EAAQC,EAASC,EAAUC,EAAM,CAC5D,IAAIC,EACFC,EAASL,IAA0BD,EAAU,aAAe,CAAE,GAC9DO,EAASP,EAAU,MAAM,cACzBQ,EAAS,WACTC,EAAST,EAAU,iBACnBU,EAAiBV,EAAU,gBAAkB,SAAUW,EAAQC,EAAc,CAC3E,GAAI,OAAO,UAAU,eAAe,KAAKD,EAAQC,CAAY,EAC3D,OAAOD,EAAOC,CAAY,CAGtC,EACM,OAAOH,GAAQJ,GAAUA,EAASK,EAAeR,EAAS,YAAY,IAAMD,GAAU,KAAOS,EAAeT,EAAQ,YAAY,EAAIA,KAAY,KAAOI,EAASE,EAAQ,OAAOF,IAAWG,EAASH,EAAO,KAAKC,EAAQ,CACrN,KAAQ,aACR,KAAQ,CAAE,EACV,KAAQF,EACR,IAAO,CACL,MAAS,CACP,KAAQ,EACR,OAAU,CACX,EACD,IAAO,CACL,KAAQ,EACR,OAAU,EACX,CACF,CACF,CAAA,EAAIC,EAAM,EAAK,IAAMI,GAAQJ,GAAUA,EAASK,EAAeR,EAAS,WAAW,IAAMD,GAAU,KAAOS,EAAeT,EAAQ,WAAW,EAAIA,KAAY,KAAOI,EAASE,EAAQ,OAAOF,IAAWG,EAASH,EAAO,KAAKC,EAAQ,CAClO,KAAQ,YACR,KAAQ,CAAE,EACV,KAAQF,EACR,IAAO,CACL,MAAS,CACP,KAAQ,EACR,OAAU,EACX,EACD,IAAO,CACL,KAAQ,EACR,OAAU,EACX,CACF,CACT,CAAO,EAAIC,EAAM,CACZ,EACD,QAAW,EACf,CAAG,EACD,YAAa,CACX,OAAU,QACX,CACH,CAAC,EACKQ,EAAcf,EAAK,OAAO,CAC9B,UAAW,8BACX,SAAUC,EAAa,SAAS,CAC9B,SAAY,CAAC,EAAG,UAAU,EAC1B,KAAQ,SAAUC,EAAWC,EAAQC,EAASC,EAAUC,EAAM,CAC5D,IAAIE,EAASL,IAA0BD,EAAU,aAAe,CAAE,GAChEO,EAASP,EAAU,MAAM,cACzBQ,EAASR,EAAU,iBACnBU,EAAiBV,EAAU,gBAAkB,SAAUW,EAAQC,EAAc,CAC3E,GAAI,OAAO,UAAU,eAAe,KAAKD,EAAQC,CAAY,EAC3D,OAAOD,EAAOC,CAAY,CAGtC,EACM,MAAO;AAAA;AAAA,0CAAmFJ,GAAQE,EAAeR,EAAS,KAAK,GAAKD,GAAUS,EAAeT,EAAQ,KAAK,GAAKM,GAAQ,KAAKD,EAAQ,eAAgB,CAClN,KAAQ,MACR,KAAQ,CAAE,EACV,KAAQF,EACR,IAAO,CACL,MAAS,CACP,KAAQ,EACR,OAAU,EACX,EACD,IAAO,CACL,KAAQ,EACR,OAAU,EACX,CACF,CACT,CAAO,CAAC,EAAI;AAAA,iEAA+EI,GAAQE,EAAeR,EAAS,KAAK,GAAKD,GAAUS,EAAeT,EAAQ,KAAK,GAAKM,GAAQ,KAAKD,EAAQ,WAAY,CACzM,KAAQ,MACR,KAAQ,CAAE,EACV,KAAQF,EACR,IAAO,CACL,MAAS,CACP,KAAQ,EACR,OAAU,EACX,EACD,IAAO,CACL,KAAQ,EACR,OAAU,EACX,CACF,CACT,CAAO,CAAC,EAAI;AAAA;AAAA,GACP,EACD,QAAW,EACf,CAAG,EACD,QAAS,CACP,KAAM,qBACN,QAAS,CACP,GAAI,wBACJ,YAAaU,CACd,CACF,EACD,UAAW,CACT,KAAK,cAAc,OAAQ,IAAIjB,EAAS,CACtC,MAAO,KAAK,KACb,CAAA,CAAC,EACF,KAAK,cAAc,UAAW,IAAIkB,EAAqB,CACrD,MAAO,KAAK,MACZ,WAAY,KAAK,WACjB,cAAe,0BAChB,CAAA,CAAC,CACH,EACD,SAAU,CACR,iBAAkB,YACnB,EACD,GAAI,CACF,KAAM,UACP,EACD,aAAc,CACZ,MAAMC,EAAmB,KAAK,MAAM,oBAAmB,EACjDC,EAAyBD,EAAiB,IAAI,QAAQ,EACtDE,EAAiB,KAAK,MAAM,QAAO,EACnCC,EAAc,IAAIC,EAAS,WAAW,CAAC,CAC3C,KAAMF,EAAiBvB,EAAK,YAAY,KAAOA,EAAK,YAAY,KAChE,SAAU0B,EAAK,KAAK,cAAe,KAAMH,EAAiB,oBAAsB,mBAAmB,CACpG,CAAA,CAAC,EACEF,EAAiB,YACnBG,EAAY,KAAK,CACf,KAAMF,IAA2BK,EAAe,OAAS3B,EAAK,YAAY,SAAWA,EAAK,YAAY,WACtG,SAAU0B,EAAK,KAAK,cAAe,KAAM,oBAAoB,CACrE,CAAO,EACGJ,IAA2BK,EAAe,UAC5CH,EAAY,KAAK,CACf,KAAMxB,EAAK,YAAY,QACvB,SAAU,IAAM,CACd,KAAK,wBAAuB,CAC7B,CACX,CAAS,GAGc,IAAI4B,EAAW,CAChC,GAAI,KAAK,GAAG,KACZ,OAAQ,KACR,YAAa5B,EAAK,YAAY,YAC9B,aAAcI,EAAa,SAAS,CAClC,SAAY,CAAC,EAAG,UAAU,EAC1B,KAAQ,SAAUC,EAAWC,EAAQC,EAASC,EAAUC,EAAM,CAC5D,IAAIC,EACFK,EAAiBV,EAAU,gBAAkB,SAAUW,EAAQC,EAAc,CAC3E,GAAI,OAAO,UAAU,eAAe,KAAKD,EAAQC,CAAY,EAC3D,OAAOD,EAAOC,CAAY,CAG1C,EACU,OAAOZ,EAAU,kBAAkBK,GAAUA,EAASK,EAAeR,EAAS,MAAM,IAAMD,GAAU,KAAOS,EAAeT,EAAQ,MAAM,EAAIA,KAAY,KAAOI,EAASL,EAAU,MAAM,cAAe,OAAOK,GAAW,WAAaA,EAAO,KAAKJ,IAA0BD,EAAU,aAAe,IAAI,CACvS,KAAQ,OACR,KAAQ,CAAE,EACV,KAAQI,EACR,IAAO,CACL,MAAS,CACP,KAAQ,EACR,OAAU,CACX,EACD,IAAO,CACL,KAAQ,EACR,OAAU,EACX,CACF,CACb,CAAW,EAAIC,EAAM,CACZ,EACD,QAAW,EACnB,CAAO,EACD,MAAO,CAAC,CACN,WAAYc,CACpB,CAAO,EACD,MAAO,QACP,SAAU,GAChB,CAAK,EACU,KAAI,CAChB,EACD,yBAA0B,CACxB,MAAMK,EAAQC,EAAM,QAAQ,QAAS,aAAc,CACjD,SAAU9B,EAAK,aAAa,SAC5B,YAAaA,EAAK,aAAa,YAC/B,WAAYA,EAAK,aAAa,WAC9B,YAAa,cACb,SAAU,IAAM,CACd6B,EAAM,QAAO,EACb,KAAK,cAAc,sBAAsB,CAC1C,CACP,CAAK,CACF,CACH,CAAC,EC9McE,EAAAC,EAAI,OAAO,CACxB,WAAY,CACV,oBAAqB,mBACrB,oBAAqB,mBACrB,qBAAsB,qBACtB,uBAAwB,gBACzB,EACD,cAAc,CACZ,QAAAC,CACJ,EAAK,CACD,KAAK,SAAS,IAAIf,EAAY,CAC5B,MAAOe,CACR,CAAA,CAAC,EACF,KAAK,QAAUH,EAAM,QAAQ,UAAW,gBAAgB,EACxD,KAAK,UAAU,SAAS,EAAE,eAAc,CACzC,EACD,YAAY,CACV,QAAAG,CACJ,EAAK,CACD,MAAMZ,EAAmBS,EAAM,QAAQ,WAAY,oCAAqCG,EAAQ,EAAE,EAC5FC,EAASC,EAAIL,EAAM,QAAQ,UAAW,uBAAuB,EAAGM,GAC7DN,EAAM,QAAQ,WAAY,4BAA6BG,EAAQ,GAAIG,CAAS,CACpF,EACKC,EAAS,KAAK,QAAQ,OAAO,cAAeJ,EAAQ,EAAE,EAC5D,MAAO,CAACZ,EAAkB,GAAGa,EAAQ,GAAGG,CAAM,CAC/C,EACD,QAAQ,CACN,QAAAJ,CACJ,EAAK,CACD,KAAK,QAAUA,EACf,KAAK,SAAS,IAAIf,EAAY,CAC5B,MAAO,KAAK,QACZ,WAAY,KAAK,OAClB,CAAA,CAAC,CACH,EACD,kBAAmB,CACjBY,EAAM,QAAQ,MAAO,UAAW,KAAK,OAAO,CAC7C,EACD,oBAAqB,CACnB,KAAK,QAAQ,oBACd,EACD,gBAAiB,CACf,KAAK,QAAQ,mBACd,CACH,CAAC"}