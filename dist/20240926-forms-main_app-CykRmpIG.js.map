{"version":3,"file":"20240926-forms-main_app-CykRmpIG.js","sources":["../src/js/views/forms/form/widgets/widget_header_view.js","../src/js/apps/forms/widgets/widgets_header_app.js","../src/js/views/forms/form/form_views.js","../src/js/apps/forms/form/form_app.js","../src/js/apps/forms/form/form-patient_app.js","../src/js/apps/forms/form/form-preview_app.js","../src/js/apps/forms/forms-main_app.js"],"sourcesContent":["import { View } from 'marionette';\nimport hbs from 'handlebars-inline-precompile';\n\nimport 'scss/modules/widgets.scss';\n\nimport { WidgetCollectionView } from 'js/views/patients/widgets/widgets_views';\n\nimport './form-widgets.scss';\n\nconst FormWidgetsHeaderView = View.extend({\n  className: 'form-widgets flex',\n  template: hbs`<div data-widgets-region></div>`,\n  regions: {\n    widgets: '[data-widgets-region]',\n  },\n  onRender({ model, collection }) {\n    this.showChildView('widgets', new WidgetCollectionView({\n      model: model,\n      collection: collection,\n      className: 'flex flex-wrap',\n      itemClassName: 'form-widgets__section',\n    }));\n  },\n});\n\nexport {\n  FormWidgetsHeaderView,\n};\n","import Radio from 'backbone.radio';\n\nimport App from 'js/base/app';\n\nimport { FormWidgetsHeaderView } from 'js/views/forms/form/widgets/widget_header_view';\n\nexport default App.extend({\n  beforeStart({ patient, form }) {\n    const workspacePatient = Radio.request('entities', 'fetch:workspacePatients:byPatient', patient.id);\n    const widgets = form.getWidgets();\n    const values = widgets.invoke('fetchValues', patient.id);\n\n    return [workspacePatient, ...values];\n  },\n  onStart({ patient, form }) {\n    const widgets = form.getWidgets();\n\n    if (!widgets.length) return;\n\n    this.showView(new FormWidgetsHeaderView({\n      model: patient,\n      collection: widgets,\n    }));\n  },\n});\n","import Backbone from 'backbone';\nimport Radio from 'backbone.radio';\nimport hbs from 'handlebars-inline-precompile';\nimport { View, Region } from 'marionette';\n\nimport 'scss/modules/buttons.scss';\n\nimport intl from 'js/i18n';\n\nconst i18n = intl.forms.form.formViews;\n\nimport Droplist from 'js/components/droplist';\nimport Tooltip from 'js/components/tooltip';\n\nimport IframeFormBehavior from 'js/behaviors/iframe-form';\n\nimport './form.scss';\n\nconst ContextTrailView = View.extend({\n  className: 'form__context-trail',\n  actionTemplate: hbs`<a class=\"js-back form__context-link\">{{fas \"chevron-left\" }}{{ @intl.forms.form.formViews.contextTrailView.backBtn }}</a>`,\n  patientTemplate: hbs`<a class=\"js-dashboard form__context-link\">{{fas \"chevron-left\" }}{{ @intl.forms.form.formViews.contextTrailView.backDashboard }}</a>`,\n  getTemplate() {\n    if (!this.action) return this.patientTemplate;\n\n    return this.actionTemplate;\n  },\n  initialize({ patient, action }) {\n    this.patient = patient;\n    this.action = action;\n  },\n  triggers: {\n    'click .js-back': 'click:back',\n    'click .js-dashboard': 'click:dashboard',\n  },\n  onClickBack() {\n    Radio.request('history', 'go:back', () => {\n      if (this.action.get('_flow')) {\n        this.routeToFlow();\n        return;\n      }\n\n      this.routeToPatient();\n    });\n  },\n  onClickDashboard() {\n    this.routeToPatient();\n  },\n  routeToFlow() {\n    Radio.trigger('event-router', 'flow', this.action.get('_flow'));\n  },\n  routeToPatient() {\n    Radio.trigger('event-router', 'patient:dashboard', this.patient.id);\n  },\n});\n\nconst FormStateActionsView = View.extend({\n  className: 'flex',\n  template: hbs`\n    {{#if hasHistory}}<button class=\"js-history-button form__actions-icon{{#if shouldShowHistory}} is-selected{{/if}}\">{{far \"clock-rotate-left\"}}</button>{{/if}}\n    <button class=\"js-expand-button form__actions-icon\">{{#if isExpanded}}{{fas \"down-left-and-up-right-to-center\"}}{{else}}{{fas \"up-right-and-down-left-from-center\"}}{{/if}}</button>\n    {{#if hasAction}}<button class=\"js-sidebar-button form__actions-icon{{#if isActionShown}} is-selected{{/if}}\">{{far \"file-lines\"}}</button>{{/if}}\n  `,\n  templateContext() {\n    return {\n      isActionShown: this.isActionShown(),\n      hasHistory: this.responses && !!this.responses.length,\n      hasAction: !!this.action,\n    };\n  },\n  onRender() {\n    this.renderSidebarTooltip();\n    this.renderExpandTooltip();\n    this.renderHistoryTooltip();\n  },\n  initialize({ action, responses }) {\n    this.action = action;\n    this.responses = responses;\n\n    this.listenTo(this.responses, 'update', this.render);\n  },\n  modelEvents: {\n    'change:isExpanded': 'render',\n    'change:isActionSidebar': 'render',\n    'change:shouldShowHistory': 'render',\n  },\n  ui: {\n    sidebarButton: '.js-sidebar-button',\n    expandButton: '.js-expand-button',\n    historyButton: '.js-history-button',\n  },\n  triggers: {\n    'click @ui.sidebarButton': 'click:sidebarButton',\n    'click @ui.expandButton': 'click:expandButton',\n    'click @ui.historyButton': 'click:historyButton',\n  },\n  isActionShown() {\n    return this.model.get('isActionSidebar') && !this.model.get('isExpanded');\n  },\n  renderSidebarTooltip() {\n    const isActionShown = this.isActionShown();\n    const message = isActionShown ? i18n.formActionsView.hideActionSidebar : i18n.formActionsView.showActionSidebar;\n\n    new Tooltip({\n      message,\n      uiView: this,\n      ui: this.ui.sidebarButton,\n    });\n  },\n  renderExpandTooltip() {\n    const isExpanded = this.model.get('isExpanded');\n    const message = isExpanded ? i18n.formActionsView.decreaseWidth : i18n.formActionsView.increaseWidth;\n\n    new Tooltip({\n      message,\n      uiView: this,\n      ui: this.ui.expandButton,\n    });\n  },\n  renderHistoryTooltip() {\n    const shouldShowHistory = this.model.get('shouldShowHistory');\n    const message = shouldShowHistory ? i18n.formActionsView.currentVersion : i18n.formActionsView.responseHistory;\n\n    new Tooltip({\n      message,\n      uiView: this,\n      ui: this.ui.historyButton,\n    });\n  },\n});\n\nconst LayoutView = View.extend({\n  className: 'form__frame',\n  template: hbs`\n    <div class=\"form__layout\">\n      <div class=\"flex\">\n        <div class=\"overflow--hidden flex-grow\">\n          <div data-context-trail-region></div>\n          <div class=\"form__title\">\n            <span class=\"form__title-icon\">{{far \"square-poll-horizontal\"}}</span>\n            <span class=\"u-text--overflow\">{{patient.first_name}} {{patient.last_name}} â€” {{ name }}</span>\n          </div>\n        </div>\n        <div class=\"flex-grow\">\n          <div data-status-region>&nbsp;</div>\n          <div class=\"form__controls\">\n            <div data-state-actions-region></div>\n            <div data-form-updated-region></div>\n            <div data-form-action-region></div>\n          </div>\n        </div>\n      </div>\n      <div data-widgets-header-region></div>\n      <div data-form-region></div>\n    </div>\n    <div class=\"form__sidebar\" data-sidebar-region></div>\n  `,\n  regionClass: Region.extend({ replaceElement: true }),\n  regions: {\n    contextTrail: '[data-context-trail-region]',\n    form: '[data-form-region]',\n    formUpdated: '[data-form-updated-region]',\n    formAction: {\n      el: '[data-form-action-region]',\n      replaceElement: true,\n    },\n    sidebar: {\n      el: '[data-sidebar-region]',\n      replaceElement: false,\n    },\n    stateActions: '[data-state-actions-region]',\n    status: '[data-status-region]',\n    widgets: '[data-widgets-header-region]',\n  },\n  templateContext() {\n    return {\n      patient: this.getOption('patient').pick('first_name', 'last_name'),\n    };\n  },\n  onRender() {\n    this.showChildView('contextTrail', new ContextTrailView({\n      patient: this.getOption('patient'),\n      action: this.getOption('action'),\n    }));\n  },\n});\n\nconst IframeView = View.extend({\n  behaviors: [IframeFormBehavior],\n  className: 'form__content',\n  template: hbs`<iframe src=\"/formapp/{{#if responseId}}{{ responseId }}{{/if}}\"></iframe>`,\n  templateContext() {\n    return {\n      responseId: this.getOption('responseId'),\n    };\n  },\n});\n\nconst StoredSubmissionView = View.extend({\n  className: 'form__content',\n  template: hbs`\n    <div class=\"form__prompt\">\n      <h2 class=\"form__prompt-title\">{{ @intl.forms.form.formViews.storedSubmissionView.title }}</h2>\n      <div class=\"form__prompt-dialog\">\n        <div class=\"flex-shrink\">\n          <button class=\"button--blue button--large js-submit\">{{ @intl.forms.form.formViews.storedSubmissionView.submitButton }}</button>\n          <div class=\"u-margin--t-16\">{{formatHTMLMessage (intlGet \"forms.form.formViews.storedSubmissionView.updated\") updated=(formatDateTime updated \"TIME_OR_DAY\")}}</div>\n        </div>\n        <div class=\"flex-shrink\">\n          <button class=\"button-secondary button--large form__discard-button js-discard\" style=\"color:red\">{{ @intl.forms.form.formViews.storedSubmissionView.cancelButton }}</button>\n        </div>\n      </div>\n    </div>\n  `,\n  templateContext() {\n    return {\n      updated: this.getOption('updated'),\n    };\n  },\n  triggers: {\n    'click .js-submit': 'submit',\n    'click .js-discard': 'discard',\n  },\n  onDiscard() {\n    const modal = Radio.request('modal', 'show:small', {\n      bodyText: i18n.storedSubmissionView.discardModal.bodyText,\n      headingText: i18n.storedSubmissionView.discardModal.headingText,\n      submitText: i18n.storedSubmissionView.discardModal.submitText,\n      buttonClass: 'button--red',\n      onSubmit: () => {\n        modal.destroy();\n        this.triggerMethod('discard:submission');\n      },\n    });\n  },\n});\n\nconst PreviewView = View.extend({\n  behaviors: [IframeFormBehavior],\n  className: 'form__frame',\n  template: hbs`\n    <div class=\"form__layout\">\n      <div class=\"form__context-trail\">\n        <a class=\"js-back form__context-link\">{{fas \"chevron-left\"}}{{ @intl.forms.form.formViews.previewView.backBtn }}</a>\n        {{~fas \"chevron-right\"}}{{ @intl.forms.form.formViews.previewView.title }}\n      </div>\n      <div class=\"form__title\"><span class=\"form__title-icon\">{{far \"square-poll-horizontal\"}}</span>{{ name }}</div>\n      <div class=\"form__content\">\n        <iframe src=\"/formapp/preview\"></iframe>\n      </div>\n    </div>\n  `,\n  triggers: {\n    'click .js-back': 'click:back',\n  },\n  onClickBack() {\n    Radio.request('history', 'go:back');\n  },\n});\n\nconst StatusView = View.extend({\n  className: 'u-text-align--right',\n  template: hbs`{{formatHTMLMessage (intlGet \"forms.form.formViews.statusView.label\") date=(formatDateTime updated_at \"AT_TIME\")}}`,\n});\n\nconst ReadOnlyView = View.extend({\n  className: 'form__form-action',\n  template: hbs`\n    <button class=\"button--grey\" disabled=true>{{ @intl.forms.form.formViews.readOnlyView.buttonText }}</button>\n  `,\n});\n\nconst LockedSubmitView = View.extend({\n  className: 'form__submit-status',\n  template: hbs`\n    <div class=\"form__submit-status-icon\">\n      {{far \"lock-keyhole\"}}\n    </div>\n    <div class=\"form__submit-status-locked-text\">\n      {{ @intl.forms.form.formViews.lockedSubmitView.permissionMessage }}\n    </div>\n  `,\n});\n\nconst SaveButtonTypeDroplist = Droplist.extend({\n  align: 'right',\n  initialize({ model }) {\n    this.collection = new Backbone.Collection([\n      {\n        text: i18n.saveView.save.droplistItemText,\n        value: 'save',\n      },\n      {\n        text: i18n.saveView.saveAndGoBack.droplistItemText,\n        value: 'saveAndGoBack',\n      },\n    ]);\n\n    const currentSaveButtonType = model.get('saveButtonType');\n\n    this.setState('selected', this.collection.find({ value: currentSaveButtonType }));\n  },\n  viewOptions: {\n    className: 'button--green button__drop-list-select',\n    template: hbs`{{fas \"caret-down\"}}`,\n  },\n  picklistOptions() {\n    return {\n      headingText: i18n.saveView.droplistLabel,\n      isCheckable: true,\n    };\n  },\n});\n\nconst LastUpdatedView = View.extend({\n  className: 'form__submit-status',\n  template: hbs`\n    <div class=\"form__submit-status-icon\">\n      {{far \"shield-check\"}}\n    </div>\n    <div class=\"form__submit-status-text\">\n      <div class=\"u-text--overflow\">{{ @intl.forms.form.formViews.lastUpdatedView.storedWork }}</div>\n      {{#if updated}}\n        <div class=\"u-text--overflow\">{{formatHTMLMessage (intlGet \"forms.form.formViews.lastUpdatedView.updatedAt\") updated=(formatDateTime updated \"AGO_OR_TODAY\")}}</div>\n      {{/if}}\n    </div>\n  `,\n  templateContext() {\n    return {\n      updated: this.updated,\n    };\n  },\n  initialize({ updated }) {\n    this.updated = updated;\n\n    if (this.updated) {\n      this.renderInterval = setInterval(() => {\n        this.render();\n      }, 45000);\n    }\n  },\n  onBeforeDestroy() {\n    clearInterval(this.renderInterval);\n  },\n});\n\nconst SaveView = View.extend({\n  className: 'form__form-action',\n  regions: {\n    saveType: {\n      el: '[data-save-type-region]',\n      replaceElement: true,\n    },\n  },\n  modelEvents: {\n    'change:saveButtonType': 'render',\n  },\n  templateContext() {\n    const saveButtonType = this.model.get('saveButtonType');\n\n    return {\n      isDisabled: this.getOption('isDisabled'),\n      showSaveButton: saveButtonType === 'save',\n      showSaveGoBackButton: saveButtonType === 'saveAndGoBack',\n    };\n  },\n  template: hbs`\n    <button class=\"button--green button__drop-list-action js-save-button\" {{#if isDisabled}}disabled{{/if}}>\n      {{#if showSaveButton}}\n        {{ @intl.forms.form.formViews.saveView.save.buttonText }}\n      {{/if}}\n      {{#if showSaveGoBackButton}}\n        {{ @intl.forms.form.formViews.saveView.saveAndGoBack.buttonText }}\n      {{/if}}\n    </button>\n    <button data-save-type-region></button>\n  `,\n  triggers: {\n    'click .js-save-button': 'click:save',\n  },\n  onRender() {\n    const saveButtonTypeDroplist = this.showChildView('saveType', new SaveButtonTypeDroplist({\n      model: this.model,\n      state: {\n        isDisabled: this.getOption('isDisabled'),\n      },\n    }));\n\n    this.listenTo(saveButtonTypeDroplist, {\n      'change:selected'(selected) {\n        this.triggerMethod('select:button:type', selected.get('value'));\n      },\n    });\n  },\n});\n\nconst UpdateView = View.extend({\n  className: 'form__form-action',\n  template: hbs`\n    <button class=\"button--green\">{{ @intl.forms.form.formViews.updateView.buttonText }}</button>\n  `,\n  triggers: {\n    'click': 'click',\n  },\n});\n\nconst HistoryDroplist = Droplist.extend({\n  viewOptions: {\n    className: 'button-filter',\n    template: hbs`{{far \"clock-rotate-left\"}}{{formatDateTime updated_at \"AT_TIME\"}}{{far \"angle-down\"}}`,\n  },\n  picklistOptions: {\n    itemTemplate: hbs`{{formatDateTime updated_at \"AT_TIME\"}}`,\n  },\n});\n\nconst HistoryView = View.extend({\n  className: 'form__form-action',\n  template: hbs`\n    <div data-versions-region></div>\n    <button class=\"button--blue js-current u-margin--l-8\">{{ @intl.forms.form.formViews.historyView.currentVersionButton }}</button>\n  `,\n  regions: {\n    versions: {\n      el: '[data-versions-region]',\n      replaceElement: true,\n    },\n  },\n  triggers: {\n    'click .js-current': 'click:current',\n  },\n  initialize({ selected, collection }) {\n    const responseDroplist = this.showChildView('versions', new HistoryDroplist({\n      collection,\n      state: { selected },\n    }));\n\n    this.listenTo(responseDroplist, {\n      'change:selected'(response) {\n        this.triggerMethod('change:response', response);\n      },\n    });\n  },\n});\n\nexport {\n  LayoutView,\n  IframeView,\n  StoredSubmissionView,\n  FormStateActionsView,\n  PreviewView,\n  StatusView,\n  ReadOnlyView,\n  LockedSubmitView,\n  SaveView,\n  UpdateView,\n  HistoryView,\n  LastUpdatedView,\n};\n","import { extend, get } from 'underscore';\nimport Radio from 'backbone.radio';\nimport store from 'store';\n\nimport App from 'js/base/app';\n\nimport intl from 'js/i18n';\nimport { FORM_RESPONSE_STATUS } from 'js/static';\n\nimport PatientSidebarApp from 'js/apps/patients/patient/sidebar/sidebar_app';\nimport WidgetsHeaderApp from 'js/apps/forms/widgets/widgets_header_app';\n\nimport FormsService from 'js/services/forms';\n\nimport {\n  LayoutView,\n  IframeView,\n  StoredSubmissionView,\n  FormStateActionsView,\n  StatusView,\n  ReadOnlyView,\n  LockedSubmitView,\n  SaveView,\n  UpdateView,\n  HistoryView,\n  LastUpdatedView,\n} from 'js/views/forms/form/form_views';\n\nexport default App.extend({\n  childApps: {\n    patient: {\n      AppClass: PatientSidebarApp,\n      regionName: 'sidebar',\n      getOptions: ['patient'],\n    },\n    widgetHeader: {\n      AppClass: WidgetsHeaderApp,\n      regionName: 'widgets',\n      getOptions: ['patient', 'form'],\n    },\n  },\n  initFormState() {\n    const storedState = store.get(`form-state_${ this.currentUser.id }`);\n\n    this.setState(extend({\n      responseId: null,\n      isActionSidebar: true,\n      isExpanded: true,\n      shouldShowHistory: false,\n      saveButtonType: 'save',\n    }, storedState));\n  },\n  onBeforeStart() {\n    this.getRegion().startPreloader();\n\n    this.currentUser = Radio.request('bootstrap', 'currentUser');\n\n    this.initFormState();\n  },\n  beforeStart({ patientActionId }) {\n    this.patientActionId = patientActionId || this.patientActionId;\n\n    return [\n      Radio.request('entities', 'fetch:forms:byAction', this.patientActionId),\n      Radio.request('entities', 'fetch:actions:withResponses', this.patientActionId),\n      Radio.request('entities', 'fetch:patients:model:byAction', this.patientActionId),\n      Radio.request('entities', 'fetch:formResponses:latest', {\n        action: this.patientActionId,\n        status: FORM_RESPONSE_STATUS.ANY,\n        editor: this.currentUser.id,\n      }),\n    ];\n  },\n  onFail() {\n    Radio.request('alert', 'show:error', intl.forms.form.formApp.notFound);\n    Radio.trigger('event-router', 'default');\n  },\n  onBeforeStop() {\n    this.removeChildApp('formsService');\n  },\n  onStart(options, form, action, patient, latestResponse) {\n    this.form = form;\n    this.patient = patient;\n    this.action = action;\n    this.responses = action.getFormResponses();\n    this.latestResponse = latestResponse;\n    this.isReadOnly = form.isReadOnly();\n    this.isLocked = action.isLocked() || !action.canSubmit();\n    this.isSubmitHidden = form.isSubmitHidden();\n\n    this.listenTo(action, 'destroy', function() {\n      Radio.request('alert', 'show:success', intl.forms.form.formApp.deleteSuccess);\n      Radio.trigger('event-router', 'default');\n    });\n\n    this.startFormService();\n\n    this.setView(new LayoutView({ model: this.form, patient, action }));\n\n    this.startChildApp('widgetHeader');\n\n    this.showStateActions();\n\n    this.showSidebar();\n\n    // Note: triggers onChangeResponseId to showContent\n    this.setState({ responseId: get(this.responses.getFirstSubmission(), 'id', false) });\n\n    this.showView();\n  },\n  startFormService() {\n    const formService = this.addChildApp('formsService', FormsService, {\n      patient: this.patient,\n      action: this.action,\n      form: this.form,\n      responses: this.responses,\n      latestResponse: this.latestResponse,\n    });\n\n    if (!this.isReadOnly && !this.isLocked) this.bindEvents(formService, this.serviceEvents);\n  },\n  serviceEvents: {\n    'submit': 'onFormServiceSubmit',\n    'success': 'onFormServiceSuccess',\n    'error': 'onFormServiceError',\n    'ready': 'onFormServiceReady',\n    'update:submission': 'onFormServiceUpdateSubmission',\n    'refresh': 'onFormServiceRefresh',\n  },\n  shouldSaveAndGoBack() {\n    const saveButtonType = this.getState('saveButtonType');\n\n    return (saveButtonType === 'saveAndGoBack' && !this.isSubmitHidden);\n  },\n  onFormServiceSubmit() {\n    if (!this.shouldSaveAndGoBack()) return;\n\n    this.loadingModal = Radio.request('modal', 'show:loading');\n  },\n  onFormServiceSuccess(response) {\n    if (this.shouldSaveAndGoBack()) {\n      this.listenTo(this.loadingModal, 'destroy', () => {\n        Radio.request('history', 'go:back', () => {\n          if (this.action.get('_flow')) {\n            Radio.trigger('event-router', 'flow', this.action.get('_flow'));\n            return;\n          }\n\n          Radio.trigger('event-router', 'patient:dashboard', this.patient.id);\n        });\n      });\n\n      return;\n    }\n\n    this.responses.unshift(response);\n    this.setState({ responseId: response.id });\n  },\n  onFormServiceError(errors) {\n    if (this.loadingModal) this.loadingModal.destroy();\n\n    const status = parseInt(errors[0].status, 10);\n\n    if (status === 403) {\n      Radio.request('alert', 'show:error', intl.forms.form.formViews.lockedSubmitView.permissionMessage);\n    }\n\n    this.showFormSave();\n  },\n  onFormServiceReady() {\n    this.showFormSave();\n  },\n  onFormServiceUpdateSubmission(updated) {\n    this.showLastUpdated(updated);\n  },\n  onFormServiceRefresh() {\n    this.restart();\n  },\n  stateEvents: {\n    'change': 'onChangeState',\n    'change:isExpanded': 'showSidebar',\n    'change:isActionSidebar': 'showSidebar',\n    'change:shouldShowHistory': 'showFormActions',\n    'change:responseId': 'onChangeResponseId',\n  },\n  onChangeState(state) {\n    store.set(`form-state_${ this.currentUser.id }`, state.pick('isExpanded', 'saveButtonType'));\n  },\n  onChangeResponseId() {\n    this.showFormActions();\n    this.showContent();\n  },\n  showStateActions() {\n    const formStateActions = new FormStateActionsView({\n      model: this.getState(),\n      action: this.action,\n      responses: this.responses.filterSubmissions(),\n    });\n\n    this.listenTo(formStateActions, {\n      'click:sidebarButton': this.onClickSidebarButton,\n      'click:expandButton': this.onClickExpandButton,\n      'click:historyButton': this.onClickHistoryButton,\n    });\n\n    this.showChildView('stateActions', formStateActions);\n  },\n  onClickSidebarButton() {\n    if (this.getState('isExpanded')) {\n      this.setState({ isActionSidebar: true, isExpanded: false });\n      return;\n    }\n\n    this.toggleState('isActionSidebar');\n  },\n  onClickExpandButton() {\n    this.toggleState('isExpanded');\n  },\n  onClickHistoryButton() {\n    this.setState({ responseId: get(this.responses.getFirstSubmission(), 'id'), shouldShowHistory: !this.getState('shouldShowHistory') });\n  },\n  showContent() {\n    const responseId = this.getState('responseId');\n\n    if (this.isReadOnly || this.isLocked || responseId) {\n      this.showForm();\n      return;\n    }\n\n    const { updated } = Radio.request(`form${ this.form.id }`, 'get:storedSubmission');\n\n    if (updated) {\n      const storedSubmissionView = this.showChildView('form', new StoredSubmissionView({ updated }));\n\n      this.listenTo(storedSubmissionView, {\n        'submit'() {\n          this.showForm();\n        },\n        'discard:submission'() {\n          Radio.request(`form${ this.form.id }`, 'clear:storedSubmission');\n          this.showForm();\n          this.showFormActions();\n        },\n      });\n\n      return;\n    }\n\n    this.showForm();\n  },\n  showForm() {\n    this.showChildView('form', new IframeView({\n      model: this.form,\n      responseId: this.getState('responseId'),\n    }));\n  },\n  showSidebar() {\n    const isActionSidebar = this.getState('isActionSidebar');\n    const isExpanded = this.getState('isExpanded');\n\n    if (!isActionSidebar || isExpanded) {\n      Radio.request('sidebar', 'close');\n    }\n\n    if (isExpanded) {\n      this.stopChildApp('patient');\n      this.getRegion('sidebar').empty();\n      return;\n    }\n\n    if (isActionSidebar) {\n      this.showActionSidebar();\n    }\n\n    this.startChildApp('patient');\n  },\n  showActionSidebar() {\n    const sidebarApp = Radio.request('sidebar', 'start', 'action', { action: this.action, isShowingForm: true });\n\n    this.listenTo(sidebarApp, 'stop', () => {\n      if (this.getState('isExpanded')) return;\n      this.setState('isActionSidebar', false);\n    });\n  },\n  showFormActions() {\n    // If there's a submission this always shows\n    this.showFormStatus();\n\n    if (this.getState('shouldShowHistory')) {\n      this.showFormHistory();\n      return;\n    }\n\n    if (this.isReadOnly) {\n      this.showReadOnly();\n      return;\n    }\n\n    if (this.isLocked) {\n      this.showLockedSubmit();\n      return;\n    }\n\n    if (this.getState('responseId')) {\n      this.showFormUpdate();\n      return;\n    }\n\n    this.showFormSaveDisabled();\n  },\n  showReadOnly() {\n    this.showChildView('formAction', new ReadOnlyView());\n  },\n  showLockedSubmit() {\n    this.showChildView('formAction', new LockedSubmitView());\n  },\n  showFormStatus() {\n    if (!this.responses.getFirstSubmission()) return;\n\n    this.showChildView('status', new StatusView({\n      model: this.responses.getFirstSubmission(),\n    }));\n  },\n  showFormHistory() {\n    const selected = this.responses.get(this.getState('responseId'));\n\n    const historyView = this.showChildView('formAction', new HistoryView({ selected, collection: this.responses.filterSubmissions() }));\n\n    this.listenTo(historyView, {\n      'change:response'(response) {\n        this.setState({ responseId: response.id });\n      },\n      'click:current'() {\n        this.setState({ responseId: get(this.responses.getFirstSubmission(), 'id'), shouldShowHistory: false });\n      },\n    });\n  },\n  showFormUpdate() {\n    const updateView = this.showChildView('formAction', new UpdateView());\n\n    this.listenTo(updateView, 'click', () => {\n      this.setState({ responseId: null });\n    });\n  },\n  showLastUpdated(updated) {\n    const lastUpdatedView = new LastUpdatedView({ updated });\n\n    this.showChildView('formUpdated', lastUpdatedView);\n  },\n  showFormSaveDisabled() {\n    if (this.isSubmitHidden) {\n      this.getRegion('formAction').empty();\n      return;\n    }\n\n    this.showChildView('formAction', new SaveView({\n      isDisabled: true,\n      model: this.getState(),\n    }));\n  },\n  showFormSave() {\n    if (this.isSubmitHidden) return;\n\n    const saveView = this.showChildView('formAction', new SaveView({\n      model: this.getState(),\n    }));\n\n    this.listenTo(saveView, {\n      'click:save'() {\n        Radio.request(`form${ this.form.id }`, 'send', 'form:submit');\n        this.showFormSaveDisabled();\n      },\n      'select:button:type'(selectedSaveButtonType) {\n        this.setState({ saveButtonType: selectedSaveButtonType });\n      },\n    });\n  },\n});\n","import { extend } from 'underscore';\nimport Radio from 'backbone.radio';\nimport store from 'store';\n\nimport App from 'js/base/app';\n\nimport { FORM_RESPONSE_STATUS } from 'js/static';\n\nimport FormsService from 'js/services/forms';\n\nimport PatientSidebarApp from 'js/apps/patients/patient/sidebar/sidebar_app';\nimport WidgetsHeaderApp from 'js/apps/forms/widgets/widgets_header_app';\n\nimport {\n  LayoutView,\n  IframeView,\n  StoredSubmissionView,\n  FormStateActionsView,\n  StatusView,\n  ReadOnlyView,\n  SaveView,\n  LastUpdatedView,\n} from 'js/views/forms/form/form_views';\n\nexport default App.extend({\n  childApps: {\n    patient: {\n      AppClass: PatientSidebarApp,\n      regionName: 'sidebar',\n      getOptions: ['patient'],\n    },\n    widgetHeader: {\n      AppClass: WidgetsHeaderApp,\n      regionName: 'widgets',\n      getOptions: ['patient', 'form'],\n    },\n  },\n  initFormState() {\n    const storedState = store.get(`form-state_${ this.currentUser.id }`);\n\n    this.setState(extend({ isExpanded: true, saveButtonType: 'save' }, storedState));\n  },\n  onBeforeStart() {\n    this.getRegion().startPreloader();\n\n    this.currentUser = Radio.request('bootstrap', 'currentUser');\n\n    this.initFormState();\n  },\n  beforeStart({ formId, patientId }) {\n    return [\n      Radio.request('entities', 'fetch:patients:model', patientId),\n      Radio.request('entities', 'fetch:forms:model', formId),\n      Radio.request('entities', 'fetch:formResponses:latest', {\n        patient: patientId,\n        form: formId,\n        status: FORM_RESPONSE_STATUS.ANY,\n        editor: this.currentUser.id,\n      }),\n    ];\n  },\n  onBeforeStop() {\n    this.removeChildApp('formsService');\n  },\n  onStart(options, patient, form, latestResponse) {\n    this.patient = patient;\n    this.form = form;\n    this.latestResponse = latestResponse;\n    this.isReadOnly = this.form.isReadOnly();\n    this.isSubmitHidden = this.form.isSubmitHidden();\n\n    this.startFormService();\n\n    this.setView(new LayoutView({ model: this.form, patient }));\n\n    this.startChildApp('widgetHeader');\n\n    this.showStateActions();\n    this.showFormActions();\n\n    this.showSidebar();\n    this.showContent();\n\n    this.showView();\n  },\n  startFormService() {\n    const formService = this.addChildApp('formsService', FormsService, {\n      patient: this.patient,\n      form: this.form,\n      latestResponse: this.latestResponse,\n    });\n\n    if (!this.isReadOnly) this.bindEvents(formService, this.serviceEvents);\n  },\n  serviceEvents: {\n    'submit': 'onFormServiceSubmit',\n    'success': 'onFormServiceSuccess',\n    'error': 'onFormServiceError',\n    'ready': 'onFormServiceReady',\n    'update:submission': 'onFormServiceUpdateSubmission',\n  },\n  shouldSaveAndGoBack() {\n    const saveButtonType = this.getState('saveButtonType');\n\n    return (saveButtonType === 'saveAndGoBack' && !this.isSubmitHidden);\n  },\n  onFormServiceSubmit() {\n    if (!this.shouldSaveAndGoBack()) return;\n\n    this.loadingModal = Radio.request('modal', 'show:loading');\n  },\n  onFormServiceSuccess(response) {\n    if (this.shouldSaveAndGoBack()) {\n      this.listenTo(this.loadingModal, 'destroy', () => {\n        Radio.request('history', 'go:back', () => {\n          Radio.trigger('event-router', 'patient:dashboard', this.patient.id);\n        });\n      });\n\n      return;\n    }\n\n    this.showForm(response.id);\n    this.showChildView('status', new StatusView({ model: response }));\n    this.showFormActions();\n  },\n  onFormServiceError() {\n    if (this.loadingModal) this.loadingModal.destroy();\n\n    this.showFormSave();\n  },\n  onFormServiceReady() {\n    this.showFormSave();\n  },\n  onFormServiceUpdateSubmission(updated) {\n    this.showLastUpdated(updated);\n  },\n  stateEvents: {\n    'change': 'onChangeState',\n    'change:isExpanded': 'showSidebar',\n  },\n  onChangeState(state) {\n    store.set(`form-state_${ this.currentUser.id }`, state.pick('isExpanded', 'saveButtonType'));\n  },\n  showStateActions() {\n    const actionsView = new FormStateActionsView({\n      model: this.getState(),\n      patient: this.patient,\n    });\n\n    this.listenTo(actionsView, {\n      'click:expandButton': this.onClickExpandButton,\n    });\n\n    this.showChildView('stateActions', actionsView);\n  },\n  onClickExpandButton() {\n    this.toggleState('isExpanded');\n  },\n  showContent() {\n    if (this.isReadOnly) {\n      this.showForm();\n      return;\n    }\n\n    const { updated } = Radio.request(`form${ this.form.id }`, 'get:storedSubmission');\n\n    if (updated) {\n      const storedSubmissionView = this.showChildView('form', new StoredSubmissionView({ updated }));\n\n      this.listenTo(storedSubmissionView, {\n        'submit'() {\n          this.showForm();\n        },\n        'discard:submission'() {\n          Radio.request(`form${ this.form.id }`, 'clear:storedSubmission');\n          this.showForm();\n          this.showFormActions();\n        },\n      });\n\n      return;\n    }\n\n    this.showForm();\n  },\n  showForm(responseId) {\n    this.showChildView('form', new IframeView({\n      model: this.form,\n      responseId,\n    }));\n  },\n  showSidebar() {\n    const isExpanded = this.getState('isExpanded');\n\n    if (isExpanded) {\n      this.stopChildApp('patient');\n      this.getRegion('sidebar').empty();\n      return;\n    }\n\n    this.startChildApp('patient');\n  },\n  showFormActions() {\n    if (this.isReadOnly) {\n      this.showReadOnly();\n      return;\n    }\n\n    this.showFormSaveDisabled();\n  },\n  showReadOnly() {\n    this.showChildView('formAction', new ReadOnlyView());\n  },\n  showLastUpdated(updated) {\n    const lastUpdatedView = new LastUpdatedView({ updated });\n\n    this.showChildView('formUpdated', lastUpdatedView);\n  },\n  showFormSaveDisabled() {\n    if (this.isSubmitHidden) return;\n\n    this.showChildView('formAction', new SaveView({\n      isDisabled: true,\n      model: this.getState(),\n    }));\n  },\n  showFormSave() {\n    if (this.isSubmitHidden) return;\n\n    const saveView = this.showChildView('formAction', new SaveView({\n      model: this.getState(),\n    }));\n\n    this.listenTo(saveView, {\n      'click:save'() {\n        Radio.request(`form${ this.form.id }`, 'send', 'form:submit');\n        this.showFormSaveDisabled();\n      },\n      'select:button:type'(selectedSaveButtonType) {\n        this.setState({ saveButtonType: selectedSaveButtonType });\n      },\n    });\n  },\n});\n","import Radio from 'backbone.radio';\n\nimport App from 'js/base/app';\n\nimport FormsService from 'js/services/forms';\n\nimport { PreviewView } from 'js/views/forms/form/form_views';\n\nexport default App.extend({\n  beforeStart({ formId }) {\n    return Radio.request('entities', 'fetch:forms:model', formId);\n  },\n  onBeforeStop() {\n    this.removeChildApp('formsService');\n  },\n  onStart(options, form) {\n    this.addChildApp('formsService', FormsService, { form });\n\n    this.showView(new PreviewView({ model: form }));\n  },\n});\n","import RouterApp from 'js/base/routerapp';\n\nimport FormApp from 'js/apps/forms/form/form_app';\nimport FormPatientApp from 'js/apps/forms/form/form-patient_app';\nimport FormPreviewApp from 'js/apps/forms/form/form-preview_app';\n\nexport default RouterApp.extend({\n  routerAppName: 'FormsApp',\n\n  childApps: {\n    form: FormApp,\n    formPreview: FormPreviewApp,\n    patientForm: FormPatientApp,\n  },\n\n  eventRoutes: {\n    'form:patient': {\n      action: 'showFormPatient',\n      route: 'patient/:id/form/:id',\n    },\n    'form:patientAction': {\n      action: 'showFormAction',\n      route: 'patient-action/:id/form/:id',\n    },\n    'form:preview': {\n      action: 'showFormPreview',\n      route: 'form/:id/preview',\n    },\n  },\n  showFormAction(patientActionId, formId) {\n    this.startCurrent('form', { formId, patientActionId });\n  },\n  showFormPatient(patientId, formId) {\n    this.startCurrent('patientForm', { formId, patientId });\n  },\n  showFormPreview(formId) {\n    this.startCurrent('formPreview', { formId });\n  },\n});\n"],"names":["FormWidgetsHeaderView","View","_Handlebars2","container","depth0","helpers","partials","data","model","collection","WidgetCollectionView","WidgetsHeaderApp","App","patient","form","workspacePatient","Radio","values","widgets","i18n","intl","ContextTrailView","stack1","alias1","lookupProperty","parent","propertyName","action","FormStateActionsView","responses","message","Tooltip","LayoutView","helper","alias2","alias3","alias4","Region","IframeView","IframeFormBehavior","StoredSubmissionView","modal","PreviewView","StatusView","ReadOnlyView","LockedSubmitView","SaveButtonTypeDroplist","Droplist","Backbone","currentSaveButtonType","LastUpdatedView","updated","SaveView","saveButtonType","saveButtonTypeDroplist","selected","UpdateView","HistoryDroplist","HistoryView","responseDroplist","response","FormApp","PatientSidebarApp","storedState","store","extend","patientActionId","FORM_RESPONSE_STATUS","options","latestResponse","get","formService","FormsService","errors","state","formStateActions","responseId","storedSubmissionView","isActionSidebar","isExpanded","sidebarApp","historyView","updateView","lastUpdatedView","saveView","selectedSaveButtonType","FormPatientApp","formId","patientId","actionsView","FormPreviewApp","formsMain_app","RouterApp"],"mappings":"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"}