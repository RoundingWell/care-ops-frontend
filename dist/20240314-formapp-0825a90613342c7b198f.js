"use strict";(globalThis.webpackChunkcare_ops_frontend=globalThis.webpackChunkcare_ops_frontend||[]).push([[891],{8172:(e,t,s)=>{s.r(t),s.d(t,{startFormApp:()=>M}),s(3923);var r=s(7198),o=s(5291),n=s.n(o),i=s(8088),a=s.n(i),d=s(944),u=s.n(d),c=s(4884),m=s(5245),l=s(7201),f=s(2182);const p=Formio.Displays.displays.webform.prototype.init;Formio.Displays.displays.webform.prototype.init=function(){if(this.options.data){const e=(0,r.extend)({},this.options.data);this._submission={data:e},this._data=e}p.call(this)};const h=Formio.Evaluator.evaluator;Formio.Evaluator.evaluator=function(e,...t){try{return h(e,...t)}catch(e){(0,m.iT)(e)}};const g=Formio.Evaluator.evaluate;function v(e,t,s,o,n){return Formio.createForm(document.createElement("div"),{},{evalContext:n}).then((n=>{const i=(0,r.reduce)(o,((t,r)=>FormioUtils.evaluate(r,n.evalContext({formSubmission:t,formData:e,responseData:s}))||t),t);return n.destroy(),i}))}Formio.Evaluator.evaluate=function(e,...t){try{return g(e,...t)}catch(e){(0,m.iT)(e)}};const b=Formio.Components.components.nested,y=Formio.Components.components.select;class F extends Formio.Components.components.survey{get emptyValue(){return[]}}Formio.Components.components.survey=F;class C extends Formio.Components.components.datetime{formatValue(e){return(0,r.isString)(e)&&e.length?Formio.Utils.moment(e).format():e}}Formio.Components.components.datetime=C;class I extends y{static schema(...e){return y.schema({label:"Directory",key:"directory",type:"directory",dataSrc:"custom",searchField:!0,customOptions:{noChoicesText:"Type a minimum of 3 characters for results"}},...e)}get defaultSchema(){return I.schema()}constructor(...e){super(...e),this.updateCustomItems=(0,r.debounce)(this.updateCustomItems,300)}updateItems(e,t){this.visible?this.updateCustomItems(t,e):this.itemsLoadedResolve()}getCustomItems(e){return!e||e.length<3?Promise.resolve([]):this.evaluate(this.component.data.custom,{values:[],searchInput:e},"values")}updateCustomItems(e,t){e||this.active?(this.loading=!0,this.getCustomItems(t).then((e=>{this.loading=!1,this.setItems(e||[])})).catch((e=>{this.handleLoadingError(e)}))):this.itemsLoadedResolve()}}class w extends Formio.Components.components.button{get shouldDisabled(){return!this.component.alwaysEnable&&super.shouldDisabled}set disabled(e){this._disabled=e}get disabled(){return!this.component.alwaysEnable&&(this._disabled||this.parentDisabled)}}let q,x;function S(){window.scrollTo({top:0})}function R(e,t){return q.updateField({fieldName:e,value:t})}function E(e){return q.getField({fieldName:e})}function _({teamId:e}={}){return q.getClinicians({teamId:e})}function P(e,t){return q.getDirectory({directoryName:e,query:t})}function D(e){return q.getIcd({term:e})}function V(e){return function(e,t){return Formio.createForm(document.createElement("div"),{}).then((s=>{const o=(0,r.reduce)(e,((e,t)=>(0,r.extend)({},e,FormioUtils.evaluate(t,s.evalContext(e)))),t);return s.destroy(),o}))}(e,{getClinicians:_,getDirectory:P,getField:E,updateField:R,getIcd:D,Handlebars:u(),TEMPLATES:{},parsePhoneNumber:c.S})}Formio.use({components:{snippet:class extends b{constructor(...e){super(...e),this.noField=!0}static schema(...e){return b.schema({label:"Snippet",key:"snippet",type:"snippet",components:[],input:!1,persistent:!1,snippet:null},...e)}},directory:I,button:w}});const T=(0,r.debounce)((function(){q.request("update:storedSubmission",x)}),2e3),k=function(e,t){const s=function(e,t,s,o){return(0,r.reduce)(t,((t,s)=>{const r=e.evalContext({formSubmission:t,prevSubmission:o});return r.hasChanged=FormioUtils.evaluate("return function hasChanged(key) { return !_.isEqual(_.get(formSubmission, key), _.get(prevSubmission, key)); }",r),FormioUtils.evaluate(s,r)||t}),s)}(e,t,structuredClone(e.submission.data),x);e.data=s,e.setSubmission({data:s},{fromChangeReducers:!0,fromSubmission:!1}),x=structuredClone(e.submission.data),T()},U=(0,r.debounce)(k,100);async function $({definition:e,isReadOnly:t,storedSubmission:s,formData:o,formSubmission:n,responseData:i,loaderReducers:a,changeReducers:d,submitReducers:u,contextScripts:c,beforeSubmit:f}){const p=await V(c),b=s||await v(o,n,i,a,p);x=structuredClone(b);const y=await Formio.createForm(document.getElementById("root"),e,{readOnly:t,evalContext:p,data:b,onChange({fromChangeReducers:e},{instance:t}){e&&y.initialized||t&&t.inEditGrid||U(y,d)}});y.nosubmit=!0,q.off("form:submit"),q.off("form:errors"),q.on({"form:errors"(e){y.showErrors((0,r.map)(e,(e=>({message:e}))),!0)},"form:submit"(){y.submit()}}),y.on("prevPage",S),y.on("nextPage",S),y.on("error",(()=>{q.request("ready:form"),y._isReady=!0})),y.on("submit",(e=>{if(!y._isReady)return;if(y._isReady=!1,U.cancel(),k(y,d),T.cancel(),y.setPristine(!1),!y.checkValidity(e.data,!0,e.data))return void y.emit("error");const t=FormioUtils.evaluate(f,y.evalContext({formSubmission:e.data}));if(!t)return q.trigger("form:errors",[l.ZP.formapp.failedSubmit]),void(0,m.iT)(new Error("beforeSubmit failure."));try{const s=(0,r.extend)(function(e,t,s){return(0,r.reduce)(t,((t,o)=>{const n=e.evalContext({formSubmission:s,formData:t}),i=h(o,n);return g(i,(0,r.values)(n))||t}),{fields:{},action:{},flow:{},artifacts:{}})}(y,u,t),e,{data:t});(0,r.each)(["fields","flow","action","artifacts"],(e=>{(0,r.isEmpty)(s[e])&&delete s[e]})),q.request("submit:form",{response:s})}catch(e){q.trigger("form:errors",[l.ZP.formapp.failedSubmit]),(0,m.iT)(e)}})),q.request("ready:form"),y._isReady=!0}async function L({definition:e,contextScripts:t}){const s=await V(t);(0,r.extend)(s,{isPreview:!0}),Formio.createForm(document.getElementById("root"),e,{evalContext:s})}async function j({definition:e,formSubmission:t,contextScripts:s}){const o=await V(s);(0,r.extend)(o,{isResponse:!0}),Formio.createForm(document.getElementById("root"),e,{readOnly:!0,renderMode:"form",evalContext:o,data:t}).then((e=>{e.on("prevPage",S),e.on("nextPage",S)}))}async function A({definition:e,formData:t,formSubmission:s,responseData:r,loaderReducers:o,contextScripts:n}){const i=await V(n),a=await v(t,s,r,o,i);(await Formio.createForm(document.getElementById("root"),e,{evalContext:i,data:a})).nosubmit=!0}const B=a().Router.extend({initialize(){window.addEventListener("message",(({data:e,origin:t})=>{t===window.origin&&e&&e.message&&this.trigger(e.message,e.args)}),!1),n()(window).on("focus",(()=>{this.request("focus")})),this.request("version",f.dd.frontend),this.requestResolves={},this.on({"fetch:clinicians":this.onFetchClinicians,"fetch:directory":this.onFetchDirectory,"fetch:field":this.onFetchField,"update:field":this.onUpdateField,"fetch:icd":this.onFetchIcd})},request(e,t={}){return new Promise((s=>{this.once(e,s),parent.postMessage({message:e,args:t},window.origin)}))},requestValue({args:e,message:t,requestId:s}){return new Promise(((o,n)=>{this.requestResolves[s]={resolve:o,reject:n},parent.postMessage({message:t,args:(0,r.extend)({requestId:s},e)},window.origin)}))},resolveValue({value:e,error:t,requestId:s}){if(!this.requestResolves[s])return;const{resolve:r,reject:o}=this.requestResolves[s];delete this.requestResolves[s],t?o(t):r(e)},getClinicians(e){const t=(0,r.uniqueId)("clinicians");return this.requestValue({args:e,message:"fetch:clinicians",requestId:t})},onFetchClinicians(e){this.resolveValue(e)},getDirectory(e){const t=(0,r.uniqueId)("directory");return this.requestValue({args:e,message:"fetch:directory",requestId:t})},onFetchDirectory(e){this.resolveValue(e)},getField(e){const t=(0,r.uniqueId)("field");return this.requestValue({args:e,message:"fetch:field",requestId:t})},onFetchField(e){this.resolveValue(e)},updateField(e){const t=(0,r.uniqueId)("field");return this.requestValue({args:e,message:"update:field",requestId:t})},onUpdateField(e){this.resolveValue(e)},getIcd(e){const t=(0,r.uniqueId)("icd");return this.requestValue({args:e,message:"fetch:icd",requestId:t})},onFetchIcd(e){this.resolveValue(e)},routes:{"formapp/":"renderForm","formapp/preview":"renderPreview","formapp/:id":"renderResponse","formapp/pdf/action/:actionId":"renderActionPdf","formapp/pdf/:formId/:patientId(/:responseId)":"renderPdf"},renderForm(){this.request("fetch:form:data").then($)},renderPreview(){this.request("fetch:form").then(L)},renderResponse(e){this.request("fetch:form:response",{responseId:e}).then(j)},renderActionPdf(e){this.once("form:pdf",A),n()("body").append(`<iframe class="iframe-hidden" src="/formservice/action/${e}"></iframe>`)},renderPdf(e,t,s){this.once("form:pdf",A),n()("body").append(`<iframe class="iframe-hidden" src="/formservice/${e}/${t}${s?`/${s}`:""}"></iframe>`)}});function M(){n()("#root").append(`\n    <div class="loader__bar js-progress-bar">\n      <div class="loader__bar-progress--loop"></div>\n    </div>\n    <div class="loader__text js-loading">${l.ZP.regions.preload.loading}</div>\n  `),q=new B,a().history.start({pushState:!0})}}}]);