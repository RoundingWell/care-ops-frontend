"use strict";(globalThis.webpackChunkcare_ops_frontend=globalThis.webpackChunkcare_ops_frontend||[]).push([[255],{5087:(t,e,n)=>{n.d(e,{A:()=>i});var r=n(1359);const i=n(6492).qw.extend({triggerStart(t){this._isLoading=!0,this._fetchId=(0,r.uniqueId)("fetch");const e=(0,r.bind)(this.triggerMethod,this,"sync:data",this._fetchId,t),n=(0,r.bind)(this.triggerSyncFail,this,this._fetchId,t),i=this.beforeStart(t);i?Promise.all((0,r.isArray)(i)?i:[i]).then(e).catch(n):e()},beforeStart:r.noop,onSyncData(t,e,n=[]){this._isRunning&&this._fetchId===t&&(this._isLoading=!1,this.finallyStart.call(this,e,...n))},triggerSyncFail(t,e,...n){this._isRunning&&this._fetchId===t&&(this._isLoading=!1,this.triggerMethod("fail",e,...n))},onFail(t,e){!async function(t){if((0,r.isError)(t))throw t;if(t.response){const e=t.response.status,{errors:n}=t.responseData;throw new Error(`Error Status: ${e} - ${JSON.stringify(n)}`)}throw new Error(JSON.stringify(t))}(e)},isRunning(){return this._isRunning&&!this.isLoading()},_isLoading:!1,isLoading(){return this._isLoading}})},7353:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(1359),i=n(7084),s=n.n(i),o=n(6267);const a=s().Collection.extend((0,r.extend)({fetch(t={}){return s().Collection.prototype.fetch.call(this,t).then((t=>!t||t.ok?this:t))},parse(t){return t&&t.data?(this.cacheIncluded(t.included),this.meta=t.meta,(0,r.map)(t.data,this.parseModel,this)):t},getMeta(t){return(0,r.get)(this.meta,t)},destroy(t){const e=(0,r.clone)(this.models),n=(0,r.invoke)(e,"destroy",t);return Promise.all(n)}},o.A))},5915:(t,e,n)=>{n.d(e,{A:()=>d});var r=n(1359),i=n(7084),s=n.n(i),o=n(4697),a=n(6267),c=n(9781);const d=o.MnObject.extend({channelName:"entities",Entity:s(),constructor:function(t){this.mergeOptions(t,["Entity"]),o.MnObject.apply(this,arguments)},getCollection(t,e={}){return new this.Entity.Collection(t,e)},getModel(t,e){return t&&!(0,r.isObject)(t)&&(t={id:t}),new this.Entity.Model(t,e)},fetchCollection(t){return(new this.Entity.Collection).fetch(t)},fetchModel(t,e){return new this.Entity.Model({id:t}).fetch(e)},async fetchBy(t,e){const n=await(0,c.Ay)(t,e);if(!n||204===n.status)return Promise.resolve();const r=await n.json();if(!n.ok)return Promise.reject({response:n,responseData:r});(0,a.l)(r.included);const i=new this.Entity.Model({id:r.data.id});return i.set(i.parseModel(r.data)),Promise.resolve(i)}})},9781:(t,e,n)=>{n.d(e,{Ay:()=>g,H4:()=>p,bQ:()=>h,bt:()=>f});var r=n(1359),i=n(6447),s=n.n(i),o=n(1812);const a=[];function c(t){delete a[t]}function d(t){return encodeURIComponent(t??"")}function l(t){if((0,r.isArray)(t)){const e=encodeURIComponent((0,r.first)(t));return(0,r.reduce)((0,r.rest)(t),((t,e)=>`${t}[${encodeURIComponent(e)}]`),e)}return encodeURIComponent(t)}function u(t,e){return(0,r.isArray)(t)?`${l(e)}=${t.map(d).join()}`:(0,r.isObject)(t)?(0,r.flatten)((0,r.map)(t,((t,n)=>u(t,(0,r.flatten)([e,n]))))).join("&"):`${l(e)}=${d(t)}`}function h(t,e){return t=t.clone(),"json"===e&&204!==t.status?t.json():t.text()}async function f(t){if(!t)return;const e=await h(t,"json");return t.ok?e:Promise.reject({response:t,responseData:e})}function p(t){if("AbortError"!==t.name)throw t}const g=async(t,e)=>(function(t,e={}){const n=function(t){return(0,r.get)(a[t],"fetcher")}(t);return!!n&&(!1!==e.abort?(function(t){const e=(0,r.get)(a[t],"controller");e&&(e.abort(),c(t))}(t),!1):n)}(t,e)||async function(t,e={}){const n=await s().request("auth","getToken"),i=new AbortController,o=t;e=(0,r.extend)({signal:i.signal,dataType:"json",headers:(0,r.defaults)(e.headers,{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"})},e),n&&(e.headers.Authorization=`Bearer ${n}`),e.method&&"GET"!==e.method?e.data&&(e.body=e.data):t=function(t,e){if(!(0,r.isObject)(e))return t;const n=(i=e,(0,r.map)(i,u).join("&"));var i;return n?`${t}?${n}`:t}(t,e.data);const c=s().request("bootstrap","currentWorkspace");return c&&(e.headers.Workspace=c.id),function(t,e,n){return a[t]={fetcher:e,controller:n},e}(o,fetch(t,e),i)}(t,e)).then((async n=>(c(t),n.ok||(await async function(t){if(401!==t.status)return!1;const e=await t.clone().json();return"5000"!==(0,r.get)(e,["errors",0,"code"])}(n)&&s().request("auth","logout"),n.status>=400&&((0,o.iH)(t,e,n),String(n.headers.get("Content-Type")).includes("json")||s().trigger("event-router","unknownError",n.status)),n.status>=500&&s().trigger("event-router","unknownError",n.status)),n))).catch(p)},1185:(t,e,n)=>{var r=n(1359),i=n(8142),s=n.n(i),o=n(6232),a=n.n(o);function c(t,e,{hash:n={}}){const r=`${t}-fa-${e}`,i=`<svg class="icon svg-inline--fa fa-${e} ${n.classes||""}"><use xlink:href="#${r}"></use></svg>`;return new(s().SafeString)(i)}n(9583);const d={far:(0,r.partial)(c,"far"),fas:(0,r.partial)(c,"fas"),fal:(0,r.partial)(c,"fal"),fat:(0,r.partial)(c,"fat"),fa:c};s().registerHelper(d),a().registerHelper(d)},6267:(t,e,n)=>{n.d(e,{A:()=>d,l:()=>c});var r=n(1359),i=n(2866),s=n.n(i),o=n(7120),a=n(6749);function c(t){(0,r.each)(t,(t=>{const e=new(o.A.get(t.type))({id:t.id});e.set(e.parseModel(t))}))}const d={cacheIncluded:c,parseId:(t={},e)=>(t.id=e,t),parseRelationship:t=>t?(0,r.isArray)(t)?(0,r.map)(t,(t=>{const e={id:t.id};return t.meta&&(0,r.each)(t.meta,((t,n)=>{e[`_${(0,a.A)(n)}`]=t})),e})):t.id:t,parseRelationships(t,e){return(0,r.each)(e,((e,n)=>{t[`_${(0,a.A)(n)}`]=this.parseRelationship(e.data,n)})),t},parseModel(t){const e=this.parseId(t.attributes,t.id);return e.__cached_ts=s().utc().format(),(0,r.each)(t.meta,((t,n)=>{e[`_${(0,a.A)(n)}`]=t})),this.parseRelationships(e,t.relationships)},toRelation(t,e){if(!(0,r.isUndefined)(t))return(0,r.isNull)(t)?{data:null}:t.models?{data:t.map((({id:t,type:e})=>({id:t,type:e})))}:(0,r.isArray)(t)?{data:(0,r.map)(t,(t=>({id:t.id?t.id:t,type:e})))}:(0,r.isObject)(t)?{data:(0,r.pick)(t,"id","type")}:{data:{id:t,type:e}}}}},9472:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(1359),i=n(7084),s=n.n(i),o=n(6267);const a=s().Model.extend((0,r.extend)({destroy(t){return this.isNew()?(s().Model.prototype.destroy.call(this,t),Promise.resolve(t)):s().Model.prototype.destroy.call(this,t)},fetch(t){return s().Model.prototype.fetch.call(this,(0,r.extend)({abort:!0},t)).then((t=>!t||t.ok?this:t))},parse(t){return t&&t.data?(this.cacheIncluded(t.included),this.parseModel(t.data)):t},parseErrors({errors:t}){if(t)return(0,r.reduce)(t,((t,{source:e,detail:n})=>(t[String(e.pointer).slice(17)]=n,t)),{})},removeFEOnly:t=>(0,r.pick)(t,(function(t,e){return"id"!==e&&/^[^_]/.test(e)})),toJSONApi(t=this.attributes){return{id:this.id,type:this.type,attributes:this.removeFEOnly(t)}},save(t,e={},n){return null==t&&(n=e),e=(0,r.extend)(this.toJSONApi(e.attributes||t),e),(0,r.isEmpty)(e.attributes)&&delete e.attributes,n=(0,r.extend)({patch:!this.isNew(),data:JSON.stringify({data:e})},n),s().Model.prototype.save.call(this,t,n)},isCached(){return this.has("__cached_ts")}},o.A))},3011:(t,e,n)=>{var r=n(4641),i=n.n(r),s=n(1359),o=n(7084),a=n.n(o),c=n(2866),d=n.n(c),l=n(6447),u=n.n(l),h=n(4697),f=n(6492);const p={getEl:t=>[t],findEl:(t,e)=>t.querySelectorAll(e),detachEl(t){t.parentNode&&t.parentNode.removeChild(t)},hasContents:t=>t.hasChildNodes(),setContents(t,e){t.innerHTML=e},appendContents(t,e){t.appendChild(e)},detachContents(t){t.textContent=""}};var g=n(9781);a().ajax=t=>(t=(0,s.extend)({method:t.type},t),(0,g.Ay)(t.url,t).then((async e=>{if(!e)return;const n=await(0,g.bQ)(e,t.dataType);return e.ok?(t.success&&t.success(n),e):(t.error&&t.error(n),Promise.reject({response:e,responseData:n}))})).catch(g.H4));var m=n(9335),y=n.n(m),w=n(8759),A=n.n(w),b=n(5435),S=n.n(b),_=n(8232),x=n.n(_),$=n(7288),C=n.n($);d().extend(A()),d().extend(y()),d().extend(S()),d().extend(x()),d().extend(C());const v={SHORT:"MMM D",LONG:"ll",SLASHES:"L",TIME:"LT",AT_TIME:"lll",DATE:t=>t.isSame(d()(),"year")?t.format(v.SHORT):t.format(v.LONG),TIME_OR_DAY:t=>t.isSame(d()(),"day")?t.format(v.TIME):v.DATE(t),AGO_OR_TODAY:t=>t.isSame(d()(),"day")?t.fromNow():v.DATE(t)};n(1185);var E=n(8142),R=n.n(E),M=n(6232),k=n.n(M),O=n(9238);const T={matchText:(t,e,{hash:n={}})=>e?(n.noEscape||(t=R().escapeExpression(t)),new(R().SafeString)(((t,e,n,r)=>{if(!t)return;n=n||"strong",r=r||n;const i=(0,O.A)(e);return t.replace(i,`<${n}>$&</${r}>`)})(t,e))):t,formatDateTime:(t,e,{hash:n={}})=>t?(t=function(t,e){const n=v[e];return n?(0,s.isFunction)(n)?n(t):t.format(n):t.format(e)}(t=n.utc?d().utc(t,n.inputFormat).local():d()(t,n.inputFormat),e),!1===n.nowrap?t:new(R().SafeString)(`<span class="u-text--nowrap">${t}</span>`)):new(R().SafeString)(n.defaultHtml||"")};R().registerHelper(T),k().registerHelper(T);const j={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},D={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":"'",",":"<",".":">","/":"?","\\":"|"},I=["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],L=/textarea|input|select/i;function N(t){const e=function({data:t}){return(0,s.isString)(t)?t.toLowerCase().split(" "):t&&(0,s.isString)(t.keys)?t.keys.toLowerCase().split(" "):void 0}(t);if(!e)return;const n=t.handler;t.handler=function(t){if(this!==t.target&&i().hotkeys.isTargetInput(t.target))return;const r=function(t,e,n){const r={},i=function(t,e){let n="";return(0,s.each)(["alt","ctrl","shift"],(function(r){t[`${r}Key`]&&e!==r&&(n+=`${r}+`)})),t.metaKey&&!t.ctrlKey&&"meta"!==e&&(n+="meta+"),t.metaKey&&"meta"!==e&&n.indexOf("alt+ctrl+shift+")>-1&&(n=n.replace("alt+ctrl+shift+","hyper+")),n}(t,e);return e?r[i+e]=!0:(r[i+n]=!0,r[i+D[n]]=!0,"shift+"===i&&(r[D[n]]=!0)),r}(t,"keypress"!==t.type&&j[t.which],String.fromCharCode(t.which).toLowerCase());for(let t=0,i=e.length;t<i;t++)if(r[e[t]])return n.apply(this,arguments)}}i().hotkeys={version:"1.0.0",isTargetInput:t=>L.test(t.nodeName)||i()(t).attr("contenteditable")||(0,s.contains)(I,t.type)},(0,s.each)(["keydown","keyup","keypress"],(t=>{i().event.special[t]={add:N}}));var H=n(403);a().Model.prototype.sync=function(t,e,n){if(n=(0,s.clone)(n),"create"===t){let t=n.data||n.attrs||e.toJSON(n);(0,s.isString)(t)&&(t=JSON.parse(t)),t.data.id=(0,H.A)(),n.data=JSON.stringify(t)}return a().sync(t,e,n)};const{Region:B,View:F,CollectionView:P,setDomApi:q}=h;q(p),window._=s.default,window.$=i(),window.Backbone=a(),window.Radio=u(),window.Marionette=h,window.dayjs=d();const J=B.prototype.show;B.prototype.show=function(t,e){return t instanceof f.uA?(t.showIn(this,null,e),this):J.call(this,t,e)};const W=function(t){if(!this.isAttached())return!1;const e=t||this.$el,{left:n,top:r}=e.offset();return{left:n,top:r,outerHeight:e.outerHeight(),outerWidth:e.outerWidth()}};(0,s.extend)(F.prototype,{getBounds:W}),(0,s.extend)(P.prototype,{getBounds:W}),a().Model.prototype.dayjs=function(t){const e=this.get(t);return e||0===e?d()(e):e},RegExp.escape=function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},2099:(t,e,n)=>{var r=n(5915),i=n(9781),s=n(1359),o=n(6447),a=n.n(o),c=n(7120),d=n(7353),l=n(9472);const u="forms",h=l.A.extend({type:u,urlRoot:"/api/forms",isReadOnly(){return(0,s.get)(this.get("options"),"read_only")},isReport(){return(0,s.get)(this.get("options"),"is_report")},isSubmitHidden(){return(0,s.get)(this.get("options"),"submit_hidden")},getContext(){return{contextScripts:this.getContextScripts(),loaderReducers:this.getLoaderReducers(),changeReducers:this.getChangeReducers(),beforeSubmit:this.getBeforeSubmit(),submitReducers:this.getSubmitReducers()}},getContextScripts(){return(0,s.get)(this.get("options"),"context",[])},getLoaderReducers(){return(0,s.get)(this.get("options"),"reducers",["\n  const subm = _.extend({ patient: {} }, formSubmission,  formData);\n\n  subm.patient.fields = _.extend({}, _.get(formSubmission, 'patient.fields'), _.get(formData, 'patient.fields'));\n\n  return subm;\n"])},getChangeReducers(){return(0,s.get)(this.get("options"),"changeReducers",[])},getBeforeSubmit(){return(0,s.get)(this.get("options"),"beforeSubmit","return formSubmission;")},getSubmitReducers(){const t=(0,s.get)(this.get("options"),"submitReducers");return(0,s.size)(t)?t:["\n  formData.fields = formSubmission.fields || _.get(formSubmission, 'patient.fields');\n\n  return formData;\n"]},getWidgets(){const t=(0,s.get)(this.get("options"),["widgets","widgets"]),e=a().request("bootstrap","widgets"),n=(0,s.map)(t,(t=>e.find({slug:t})));return a().request("entities","widgets:collection",(0,s.invoke)((0,s.compact)(n),"omit","id"))},getWidgetFields(){return(0,s.get)(this.get("options"),["widgets","fields"])},getPrefillFormId(){return(0,s.get)(this.get("options"),"prefill_form_id")||this.id},getPrefillActionTag(){return(0,s.get)(this.get("options"),"prefill_action_tag")}}),f=(0,c.A)(h,u),p=d.A.extend({url:"/api/forms",model:f,comparator:"name"});new(r.A.extend({Entity:{_Model:h,Model:f,Collection:p},radioRequests:{"forms:model":"getModel","forms:collection":"getCollection","fetch:forms:model":"fetchModel","fetch:forms:collection":"fetchCollection","fetch:forms:definition":"fetchDefinition","fetch:forms:data":"fetchFormData","fetch:forms:byAction":"fetchByAction","fetch:forms:definition:byAction":"fetchDefinitionByAction"},fetchDefinition:t=>(0,i.Ay)(`/api/forms/${t}/definition`).then(i.bt),fetchFormData(t,e,n){const r=new l.A;if(t)return r.fetch({url:`/api/actions/${t}/form/fields`});const i={filter:{patient:e}};return r.fetch({url:`/api/forms/${n}/fields`,data:i})},fetchByAction(t){return this.fetchBy(`/api/actions/${t}/form`)},fetchDefinitionByAction:t=>(0,i.Ay)(`/api/actions/${t}/form/definition`).then(i.bt)}))},9238:(t,e,n)=>{n.d(e,{A:()=>o});var r=n(1359),i=n(7920),s=n(8745);const o=(0,r.memoize)((function(t){const e=(0,r.map)((0,i.A)((n=t,n=(n=(n=String(n)).replace(/\-/g," ")).replace(/[^\w\s]/g,""),(0,s.A)(n).toLowerCase())),RegExp.escape);var n;return new RegExp(`\\b${e.join("|")}`,"gi")}))},8745:(t,e,n)=>{n.d(e,{A:()=>r});const r=(t="",e)=>(t=String(t),e?t.replace(new RegExp(`^${e}+|${e}+$`,"g"),""):t.trim())},6749:(t,e,n)=>{n.d(e,{A:()=>i});var r=n(8745);const i=t=>t?(0,r.A)(t).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase():t},7920:(t,e,n)=>{n.d(e,{A:()=>s});var r=n(1359),i=n(8745);const s=(t,e)=>(0,r.isEmpty)(t)?[]:(0,i.A)(t,e).split(e||/\s+/)}}]);