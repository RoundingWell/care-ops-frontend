import{B as k,R as m,V as p,_ as w,C as $}from"./20240815-runtime-CAqY7RPi.js";import{R as oe}from"./20240815-iframe-form-BlnfdiaU.js";import{M as q,B as re,c as ce,d as ue,e as H,f as Q,g as he,h as G,i as de,j as U,C as z,F as N,L as me,S as we,A as ge,k as P,T as pe,a as fe,b as ke,P as ye}from"./20240815-schedule_views-B5zIBevr.js";import{i as F,r as b}from"./20240815-index-DnSqyJrh.js";import{A as O,C as Se,d as K}from"./20240815-app-2pU4mDct.js";import{A as J,Z as M,r as Z,e as S,J as Ce,x as _e,w as E,d as be,o as Te,D as ve,m as De,be as Oe,O as Ve,B as Me}from"./20240815-index-D3ekzYpD.js";import{d as g}from"./20240815-parsePhoneNumber-fumIcCiK.js";import{s as T,T as x,d as xe,b as Fe,D as Pe}from"./20240815-app-6Qz0j883.js";import{R as V,N as D,c as Ee,n as Ae,a as _}from"./20240815-workspaces-L0VX7Ysf.js";import{b as je,S as X}from"./20240815-build-matchers-array-fBnEJW4v.js";import"./20240815-list-pages-D55oKo6Q.js";import{P as Be}from"./20240815-prelogin_views-I_m3ZHH4.js";import{C as ee,R as te,S as Ie,a as se,O as ie,b as Re,D as Le,c as Ye,T as We,F as $e,d as qe,e as He}from"./20240815-app-frame_app-BNTyeFgW.js";import"./20240815-sidebar_app-D3aGLgBO.js";/* empty css                        */const Qe=new k.Collection(V),Ge="v6",le=k.Model.extend({defaults(){return{actionsSortId:"sortCreatedDesc",flowsSortId:"sortCreatedDesc",actionsDateFilters:{dateType:"created_at",selectedDate:null,selectedMonth:null,selectedWeek:null,relativeDate:null},flowsDateFilters:{dateType:"created_at",selectedDate:null,selectedMonth:null,selectedWeek:null,relativeDate:null},clinicianId:this.currentClinician.id,teamId:this.currentClinician.getTeam().id,noOwner:!1,lastSelectedIndex:null,actionsSelected:{},flowsSelected:{},searchQuery:"",listType:"actions"}},getFiltersState(){return{customFilters:this.get("customFilters"),states:this.get("states"),flowStates:this.get("flowStates"),listType:this.get("listType"),isDoneOnly:this.id==="done-last-thirty-days"}},preinitialize(){this.currentClinician=m.request("bootstrap","currentUser"),this.currentWorkspace=m.request("workspace","current")},initialize(){this.on("change",this.onChange),this.listenTo(m.channel("event-router"),"unknownError",this.removeStore)},getStoreKey(t){return`${t}_${this.currentClinician.id}_${this.currentWorkspace.id}-${Ge}`},getStore(t){return T.get(this.getStoreKey(t))},removeStore(){T.remove(this.getStoreKey(this.id))},onChange(){T.set(this.getStoreKey(this.id),J(this.attributes,"lastSelectedIndex","searchQuery"))},setClinicianId(t){if(t)return this.set({clinicianId:t})},setSearchQuery(t=""){return this.set({searchQuery:t.length>2?t:"",lastSelectedIndex:null})},getType(){return this.get("listType")},setType(t){return this.set({listType:t,lastSelectedIndex:null})},isFlowType(){return this.getType()==="flows"},getSort(){return this.get(`${this.getType()}SortId`)},setSort(t){this.set(`${this.getType()}SortId`,t)},setDateFilters(t){return this.set(`${this.getType()}DateFilters`,M(t))},getDateFilters(){return M(this.get(`${this.getType()}DateFilters`))},formatDateRange(t,e,l){const u=t==="due_date"?"YYYY-MM-DD":"";return`${g(e).startOf(l).format(u)},${g(e).endOf(l).format(u)}`},getDateRange({dateType:t,selectedDate:e,selectedMonth:l,selectedWeek:u,relativeDate:n}){if(e)return this.formatDateRange(t,e,"day");if(l)return this.formatDateRange(t,l,"month");if(u)return this.formatDateRange(t,u,"week");n=n||"thismonth";const{prev:s,unit:i}=Qe.get(n).pick("prev","unit"),a=g().subtract(s,i);return this.formatDateRange(t,a,i)},getStaticDateFilter(){return{"new-past-day":{created_at:g().subtract(24,"hours").format()},"updated-past-three-days":{updated_at:g().startOf("day").subtract(3,"days").format()},"done-last-thirty-days":{updated_at:g().startOf("day").subtract(30,"days").format()}}[this.id]},getEntityDateFilter(){const t=this.getStaticDateFilter();if(t)return t;const e=this.getDateFilters();return e.relativeDate==="alltime"?{}:{[e.dateType]:this.getDateRange(e)}},getEntityStatesFilter(){const t=this.get("states").join()||D;return this.isFlowType()?{state:t}:{state:t,"flow.state":this.get("flowStates").join()||D}},isOwnerTeam(){const t=this.get("clinicianId");return this.id==="shared-by"||!t},getOwner(){const t=this.get("clinicianId");return this.isOwnerTeam()?m.request("entities","teams:model",this.get("teamId")):m.request("entities","clinicians:model",t)},getEntityOwnerFilter(){const t=this.get("clinicianId");if(this.isOwnerTeam()){const e=this.get("teamId"),l=this.get("noOwner"),u=this.currentClinician.can("app:worklist:clinician_filter");return l||!u?{team:e,clinician:D}:{team:e}}return{clinician:t}},getEntityCustomFilter(){const t=this.get("customFilters");return Z(t,(e,l,u)=>(l!==null&&(e[`@${u}`]=l),e),{})},getEntityFilter(){const t={};return S(t,this.getEntityDateFilter()),S(t,this.getEntityStatesFilter()),S(t,this.getEntityOwnerFilter()),S(t,this.getEntityCustomFilter()),t}});S(le.prototype,q);const Ue=le,ze=k.Model.extend({initialize({collection:t}){const e=t.at(0);this.initBulkState(t,e),this.initBulkOwner(t,e)},initBulkState(t,e){const l=e.getState().id,u=t.some(n=>n.getState().id!==l);this.set({stateMulti:u,stateId:u?null:l})},initBulkOwner(t,e){const l=e.getOwner(),u=e.getProgram(),n=t.some(s=>{const i=s.getOwner().id!==l.id,a=s.getProgram().id!==u.id;return i||a});this.set({ownerMulti:n,owner:n?null:l,workspaces:u.getUserWorkspaces()})},setState(t){return this.set({stateId:t.id,stateMulti:!1,stateChanged:!0})},setOwner(t){return this.set({owner:t,ownerMulti:!1,ownerChanged:!0})},someComplete(){return this.get("collection").some(t=>t.isDone())},getData(){const{stateChanged:t,stateId:e,ownerChanged:l,owner:u}=this.attributes,n={};return t&&(n._state=e),l&&(n._owner=_e(u,"id","type")),n}}),Ne=O.extend({StateModel:ze,onStart(){const t=new re({collection:this.getState("collection")}),e=new ce({model:this.getState(),collection:this.getState("collection")});this.modal=m.request("modal","show:sidebar",{headerView:t,bodyView:e,onSubmit:this.onSubmit.bind(this)}),this.listenTo(t,{delete:Ce(this.triggerMethod,"delete")}),this.listenTo(this.modal,{destroy:this.stop})},onSubmit(){this.modal.disableSubmit(),!!this.getState("applyOwner")&&this.triggerMethod("applyOwner",this.getState("owner")),this.triggerMethod("save",this.getState().getData())},onStop(){this.modal.destroy()}}),Ke=new k.Collection(V),Je=p.extend({tagName:"button",className:"button-filter button__group flex-grow",template:w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(l,"formatMessage")||e&&a(e,"formatMessage")||i).call(s,(a(l,"intlGet")||e&&a(e,"intlGet")||i).call(s,"patients.shared.components.dateFilterComponent.dateTypes",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:84}}}),{name:"formatMessage",hash:{type:e!=null?a(e,"id"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:95}}}))},useData:!0}),onRender(){this.$el.toggleClass("button--blue",this.getOption("selected")===this.model.id)},triggers:{click:"click"}}),Ze=$.extend({modelEvents:{"change:dateType":"render"},className:"flex",childView:Je,childViewTriggers:{click:"click"},onClick({model:t}){this.model.set("dateType",t.id)},childViewOptions(){return{selected:this.model.get("dateType")}}}),Xe=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(l,"formatDateTime")||e&&o(e,"formatDateTime")||i).call(s,e!=null?o(e,"selectedDate"):e,"MM/DD/YYYY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:44}}}))+a((o(l,"far")||e&&o(e,"far")||i).call(s,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:44},end:{line:1,column:64}}}))},useData:!0}),et=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(l,"formatDateTime")||e&&o(e,"formatDateTime")||i).call(s,e!=null?o(e,"selectedMonth"):e,"MMM YYYY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:43}}}))+a((o(l,"far")||e&&o(e,"far")||i).call(s,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:43},end:{line:1,column:63}}}))},useData:!0}),tt=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(l,"formatDateTime")||e&&o(e,"formatDateTime")||i).call(s,e!=null?o(e,"selectedWeek"):e,"MM/DD/YYYY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:44}}}))+" - "+a((o(l,"formatDateTime")||e&&o(e,"formatDateTime")||i).call(s,e!=null?o(e,"selectedEndWeek"):e,"MM/DD/YYYY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:1,column:47},end:{line:1,column:94}}}))+a((o(l,"far")||e&&o(e,"far")||i).call(s,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:94},end:{line:1,column:114}}}))},useData:!0}),st=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(l,"formatMessage")||e&&o(e,"formatMessage")||i).call(s,(o(l,"intlGet")||e&&o(e,"intlGet")||i).call(s,"patients.shared.components.dateFilterComponent.relativeDate",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:87}}}),{name:"formatMessage",hash:{relativeTo:e!=null?o(e,"relativeDate"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:114}}}))+a((o(l,"far")||e&&o(e,"far")||i).call(s,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:114},end:{line:1,column:134}}}))},useData:!0}),it=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=t.escapeExpression,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return i(t.lambda((s=(s=(s=(s=(s=(s=(s=n&&a(n,"intl"))&&a(s,"patients"))&&a(s,"shared"))&&a(s,"components"))&&a(s,"dateFilterComponent"))&&a(s,"dateFilterViews"))&&a(s,"defaultTemplate"))&&a(s,"thisMonth"),e))+i((a(l,"far")||e&&a(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:100},end:{line:1,column:120}}}))},useData:!0}),lt=p.extend({template:w.template({1:function(t,e,l,u,n){var s,i=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,h){if(Object.prototype.hasOwnProperty.call(d,h))return d[h]};return'      <button class="button-secondary--compact u-margin--r-8 js-prev">'+o((r(l,"far")||e&&r(e,"far")||a).call(i,"angle-left",{name:"far",hash:{},data:n,loc:{start:{line:3,column:70},end:{line:3,column:90}}}))+"</button>"+o((s=(s=r(l,"remove_whitespace")||(e!=null?r(e,"remove_whitespace"):e))!=null?s:a,typeof s=="function"?s.call(i,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:3,column:99},end:{line:3,column:124}}}):s))},3:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return'      <button class="button-secondary--compact u-margin--l-8 js-next">'+t.escapeExpression((s(l,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"angle-right",{name:"far",hash:{},data:n,loc:{start:{line:11,column:70},end:{line:11,column:91}}}))+`</button>
`},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d="function",h=t.lookupProperty||function(c,f){if(Object.prototype.hasOwnProperty.call(c,f))return c[f]};return`
`+((s=h(l,"unless").call(a,e!=null?h(e,"hidePrevNextButtons"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:4},end:{line:4,column:15}}}))!=null?s:"")+`    <button class="button-filter js-date">
      `+r((h(l,"far")||e&&h(e,"far")||o).call(a,"calendar-days",{name:"far",hash:{},data:n,loc:{start:{line:6,column:6},end:{line:6,column:29}}}))+r((i=(i=h(l,"remove_whitespace")||(e!=null?h(e,"remove_whitespace"):e))!=null?i:o,typeof i===d?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:6,column:29},end:{line:6,column:54}}}):i))+r((h(l,"formatMessage")||e&&h(e,"formatMessage")||o).call(a,(h(l,"intlGet")||e&&h(e,"intlGet")||o).call(a,"patients.shared.components.dateFilterComponent.dateTypes",{name:"intlGet",hash:{},data:n,loc:{start:{line:7,column:22},end:{line:7,column:90}}}),{name:"formatMessage",hash:{type:e!=null?h(e,"dateType"):e},data:n,loc:{start:{line:7,column:6},end:{line:7,column:107}}}))+r((i=(i=h(l,"remove_whitespace")||(e!=null?h(e,"remove_whitespace"):e))!=null?i:o,typeof i===d?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:7,column:107},end:{line:7,column:132}}}):i))+`:
      <span data-date-picker-label-region></span>
    </button>`+r((i=(i=h(l,"remove_whitespace")||(e!=null?h(e,"remove_whitespace"):e))!=null?i:o,typeof i===d?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:9,column:13},end:{line:9,column:38}}}):i))+((s=h(l,"unless").call(a,e!=null?h(e,"hidePrevNextButtons"):e,{name:"unless",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:10,column:4},end:{line:12,column:15}}}))!=null?s:"")+"  "},useData:!0}),regions:{datepicker:{el:"[data-date-picker-label-region]",replaceElement:!0}},ui:{next:".js-next",prev:".js-prev",date:".js-date"},triggers:{"click @ui.prev":"click:prev","click @ui.next":"click:next","click @ui.date":"click:date"},getLabelTemplate(){return this.model.get("selectedDate")?Xe:this.model.get("selectedMonth")?et:this.model.get("selectedWeek")?tt:this.model.get("relativeDate")?st:it},onRender(){this.showChildView("datepicker",{tagName:"span",model:this.model,template:this.getLabelTemplate(),templateContext(){return this.model.get("selectedWeek")?{selectedEndWeek:this.model.dayjs("selectedWeek").endOf("week")}:{}}}),this.model.get("relativeDate")!=="alltime"&&this.getTooltips()},templateContext(){return{hidePrevNextButtons:this.model.get("relativeDate")==="alltime"}},getTooltips(){const t=this.getTooltipMessages();new x({message:t.prevMessage,uiView:this,ui:this.ui.prev}),new x({message:t.nextMessage,uiView:this,ui:this.ui.next})},getTooltipMessages(){if(this.model.get("selectedDate"))return this._getTooltipDayMessage(this.model.dayjs("selectedDate"));if(this.model.get("selectedMonth"))return this._getTooltipMonthMessage(this.model.dayjs("selectedMonth"));if(this.model.get("selectedWeek"))return this._getTooltipWeekMessage(this.model.dayjs("selectedWeek"));const t=this.model.get("relativeDate"),{prev:e,unit:l}=Ke.get(t||"thismonth").pick("prev","unit");return this[{day:"_getTooltipDayMessage",month:"_getTooltipMonthMessage",week:"_getTooltipWeekMessage"}[l]].call(this,g().subtract(e,l).startOf(l))},_getTooltipDayMessage(t){return{prevMessage:g(t).subtract(1,"day").format("MM/DD/YYYY"),nextMessage:g(t).add(1,"day").format("MM/DD/YYYY")}},_getTooltipMonthMessage(t){return{prevMessage:g(t).subtract(1,"month").format("MMM YYYY"),nextMessage:g(t).add(1,"month").format("MMM YYYY")}},_getTooltipWeekMessage(t){const e=g(t).subtract(1,"week"),l=g(t).add(1,"week");return{prevMessage:`${e.format("MM/DD/YYYY")} - ${e.endOf("week").format("MM/DD/YYYY")}`,nextMessage:`${l.format("MM/DD/YYYY")} - ${l.endOf("week").format("MM/DD/YYYY")}`}}}),nt=p.extend({template:w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i,a=t.lambda,o=t.escapeExpression,r=e??(t.nullContext||{}),d=t.hooks.helperMissing,h="function",c=t.lookupProperty||function(f,C){if(Object.prototype.hasOwnProperty.call(f,C))return f[C]};return`
    <button class="datepicker__button js-today">`+o(a((s=(s=(s=(s=(s=(s=(s=n&&c(n,"intl"))&&c(s,"patients"))&&c(s,"shared"))&&c(s,"components"))&&c(s,"dateFilterComponent"))&&c(s,"dateFilterViews"))&&c(s,"actionView"))&&c(s,"today"),e))+"</button>"+o((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:d,typeof i===h?i.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:148},end:{line:2,column:173}}}):i))+'<button class="datepicker__button js-current-week">'+o(a((s=(s=(s=(s=(s=(s=(s=n&&c(n,"intl"))&&c(s,"patients"))&&c(s,"shared"))&&c(s,"components"))&&c(s,"dateFilterComponent"))&&c(s,"dateFilterViews"))&&c(s,"actionView"))&&c(s,"week"),e))+"</button>"+o((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:d,typeof i===h?i.call(r,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:3,column:154},end:{line:3,column:179}}}):i))+'<button class="datepicker__button js-current-month">'+o(a((s=(s=(s=(s=(s=(s=(s=n&&c(n,"intl"))&&c(s,"patients"))&&c(s,"shared"))&&c(s,"components"))&&c(s,"dateFilterComponent"))&&c(s,"dateFilterViews"))&&c(s,"actionView"))&&c(s,"month"),e))+`</button>
  `},useData:!0}),triggers:{"click .js-current-week":"click:currentWeek","click .js-today":"click:today","click .js-current-month":"click:currentMonth"}}),at=p.extend({className:"date-filter",template:w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <div class="date-filter__label">`+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"shared"))&&i(s,"components"))&&i(s,"dateFilterComponent"))&&i(s,"dateFilterViews"))&&i(s,"layoutView"))&&i(s,"dateLabel"),e))+`</div>
    <div class="date-filter__toggle" data-date-type-region></div>
    <div data-component-region></div>
  `},useData:!0}),regions:{dateType:"[data-date-type-region]",component:"[data-component-region]"}}),ot=xe.extend({className:"date-filter__ranges",itemTemplate:w.template({1:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return t.escapeExpression((s(l,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"check",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:121},end:{line:1,column:136}}}))},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return t.escapeExpression((o(l,"formatMessage")||e&&o(e,"formatMessage")||a).call(i,(o(l,"intlGet")||e&&o(e,"intlGet")||a).call(i,"patients.shared.components.dateFilterComponent.relativeDate",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:87}}}),{name:"formatMessage",hash:{relativeTo:e!=null?o(e,"id"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:103}}}))+((s=o(l,"if").call(i,e!=null?o(e,"isSelected"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:1,column:103},end:{line:1,column:143}}}))!=null?s:"")},useData:!0}),itemTemplateContext(){return{isSelected:this.model===this.state.get("selected")}},viewEvents:{"picklist:item:select":"onItemSelect"},onItemSelect({model:t}){this.triggerMethod("select",t.id)}}),A=new k.Collection(V),j={day:"setDate",week:"setWeek",month:"setMonth"},rt=k.Model.extend({setRelativeDate(t,e){this.set({relativeDate:t,selectedDate:null,selectedWeek:null,selectedMonth:null,dateType:e})},setMonth(t,e){this.set({relativeDate:null,selectedDate:null,selectedWeek:null,selectedMonth:t,dateType:e||this.get("dateType")})},setWeek(t,e){this.set({relativeDate:null,selectedDate:null,selectedWeek:t,selectedMonth:null,dateType:e||this.get("dateType")})},setDate(t,e){this.set({relativeDate:null,selectedDate:t,selectedWeek:null,selectedMonth:null,dateType:e||this.get("dateType")})},incrementBackward(){if(this.dayjs("selectedDate")){this.setDate(this.dayjs("selectedDate").subtract(1,"day"));return}if(this.dayjs("selectedMonth")){this.setMonth(this.dayjs("selectedMonth").subtract(1,"month").startOf("month"));return}if(this.dayjs("selectedWeek")){this.setWeek(this.dayjs("selectedWeek").subtract(1,"week").startOf("week"));return}const t=this.get("relativeDate")||"thismonth",{prev:e,unit:l}=A.get(t).pick("prev","unit");this[j[l]].call(this,g().subtract(e+1,l).startOf(l))},incrementForward(){if(this.dayjs("selectedDate")){this.setDate(this.dayjs("selectedDate").add(1,"day"));return}if(this.dayjs("selectedMonth")){this.setMonth(this.dayjs("selectedMonth").add(1,"month").startOf("month"));return}if(this.dayjs("selectedWeek")){this.setWeek(this.dayjs("selectedWeek").add(1,"week").startOf("week"));return}const t=this.get("relativeDate")||"thismonth",{prev:e,unit:l}=A.get(t).pick("prev","unit");this[j[l]].call(this,g().add(1-e,l).startOf(l))}}),B=new k.Collection([...V,{id:"calendar"},{id:"alltime"}]),ct=["create_at","updated_at","due_date"],ut=Fe.extend({stateEvents:{change:"show","change:selectedDate":"onChangeStateSelectedDate","change:selectedMonth":"onChangeStateSelectedMonth"},getActionsView(){const t=new nt;return this.listenTo(t,{"click:today":this.onClickToday,"click:currentWeek":this.onClickCurrentWeek,"click:currentMonth":this.onClickCurrentMonth}),t},onClickToday(){this.triggerMethod("select:today")},onClickCurrentWeek(){this.triggerMethod("select:currentWeek")},onClickCurrentMonth(){this.triggerMethod("select:currentMonth")},onSelectToday:E,regionOptions:E}),ne=Se.extend({dateTypes:ct,StateModel:rt,stateEvents:{change:"show"},ViewClass:lt,viewOptions(){return{model:this.getState()}},viewEvents:{"click:date"(){this.showPop()},"click:prev"(){this.getState().incrementBackward()},"click:next"(){this.getState().incrementForward()}},initialize(){this.dateTypes=new k.Collection(Ee(this.getOption("dateTypes"),"id")),this.dateTypeState=new k.Model({dateType:this.getState("dateType")})},showPop(){const t=this.getView().getBounds(this.getView().$el);this.popView=new at,this.popView.listenTo(this,"destroy",this.popView.destroy),this.listenTo(this.popView,"destroy",()=>{this.setState("dateType",this.dateTypeState.get("dateType"))}),this.showRanges(),this.showDateTypes(),m.request("app","show:pop",this.popView,{popWidth:256,...t})},showDateTypes(){this.popView.showChildView("dateType",new Ze({collection:this.dateTypes,model:this.dateTypeState}))},showRanges(){const t=this.getState(),{selectedDate:e,selectedMonth:l,selectedWeek:u,relativeDate:n}=t.pick("selectedDate","selectedMonth","selectedWeek","relativeDate"),s=B.get(n||!e&&!l&&!u&&"thismonth"),i=new ot({lists:[{collection:B}],state:{selected:s}});this.listenTo(i,"select",a=>{if(a==="calendar"){this.showDatePicker();return}t.setRelativeDate(a,this.dateTypeState.get("dateType")),this.popView.destroy()}),this.popView.showChildView("component",i)},showDatePicker(){const t=this.getState(),e=new ut({state:t.pick("selectedDate","selectedMonth"),canSelectMonth:!0});this.listenTo(e,{"select:currentWeek"(){t.setRelativeDate("thisweek",this.dateTypeState.get("dateType")),this.popView.destroy()},"select:today"(){t.setRelativeDate("today",this.dateTypeState.get("dateType")),this.popView.destroy()},"select:currentMonth"(){t.setRelativeDate("thismonth",this.dateTypeState.get("dateType")),this.popView.destroy()},"change:selectedDate"(l){t.setDate(l,this.dateTypeState.get("dateType")),this.popView.destroy()},"change:selectedMonth"(l){t.setMonth(l,this.dateTypeState.get("dateType")),this.popView.destroy()}}),e.showIn(this.popView.getRegion("component"))}}),ht=w.template({1:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return'<div class="worklist-list__flow-name">'+t.escapeExpression((s=(s=i(l,"flowName")||(e!=null?i(e,"flowName"):e))!=null?s:t.hooks.helperMissing,typeof s=="function"?s.call(e??(t.nullContext||{}),{name:"flowName",hash:{},data:n,loc:{start:{line:15,column:58},end:{line:15,column:72}}}):s))+"</div>"},3:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return'<span class="worklist-list__display-icon u-margin--l-8">'+t.escapeExpression((s(l,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"paperclip",{name:"far",hash:{},data:n,loc:{start:{line:28,column:80},end:{line:28,column:99}}}))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d=t.lambda,h="function",c=t.lookupProperty||function(f,C){if(Object.prototype.hasOwnProperty.call(f,C))return f[C]};return`<td class="table-list__cell table-list__item-check js-no-click"><span data-check-region></span></td>
<td class="table-list__cell w-15">
  <span class="worklist-list__patient-sidebar-icon">
    <button class="button-secondary--compact js-patient-sidebar-button">
      `+r((c(l,"far")||e&&c(e,"far")||o).call(a,"address-card",{name:"far",hash:{},data:n,loc:{start:{line:5,column:6},end:{line:5,column:28}}}))+`&#8203;
    </button>
  </span>
  <div class="worklist-list__patient-name js-patient">
    `+r(d((s=e!=null?c(e,"patient"):e)!=null?c(s,"first_name"):s,e))+" "+r(d((s=e!=null?c(e,"patient"):e)!=null?c(s,"last_name"):s,e))+`&#8203;
  </div>
</td>
<td class="table-list__cell worklist-list__item-name">
  <span class="worklist-list__action-icon">`+r((c(l,"far")||e&&c(e,"far")||o).call(a,e!=null?c(e,"icon"):e,{name:"far",hash:{},data:n,loc:{start:{line:13,column:43},end:{line:13,column:55}}}))+"</span>"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:62},end:{line:13,column:87}}}):i))+`<div class="worklist-list__name">
    `+((s=c(l,"if").call(a,e!=null?c(e,"flowName"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:15,column:4},end:{line:15,column:85}}}))!=null?s:"")+"&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:15,column:92},end:{line:15,column:117}}}):i))+r((i=(i=c(l,"name")||(e!=null?c(e,"name"):e))!=null?i:o,typeof i===h?i.call(a,{name:"name",hash:{},data:n,loc:{start:{line:16,column:4},end:{line:16,column:14}}}):i))+"&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:21},end:{line:16,column:46}}}):i))+`</div>
</td>
<td class="table-list__cell worklist-list__meta">
  <span class="worklist-list__display-icon u-margin--r-16" data-details-region></span>&#8203;`+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:20,column:93},end:{line:20,column:118}}}):i))+'<span class="table-list__meta" data-state-region></span>&#8203;<span class="worklist-list__search-helper">'+r((i=(i=c(l,"state")||(e!=null?c(e,"state"):e))!=null?i:o,typeof i===h?i.call(a,{name:"state",hash:{},data:n,loc:{start:{line:21,column:108},end:{line:21,column:119}}}):i))+"</span>&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:21,column:133},end:{line:21,column:158}}}):i))+'<span class="table-list__meta" data-owner-region></span>&#8203;<span class="worklist-list__search-helper">'+r((i=(i=c(l,"owner")||(e!=null?c(e,"owner"):e))!=null?i:o,typeof i===h?i.call(a,{name:"owner",hash:{},data:n,loc:{start:{line:22,column:108},end:{line:22,column:119}}}):i))+"</span>&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:22,column:133},end:{line:22,column:158}}}):i))+'<span class="table-list__meta">'+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:23,column:33},end:{line:23,column:58}}}):i))+"<span data-due-date-region></span>"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:24,column:38},end:{line:24,column:63}}}):i))+"<span data-due-time-region></span>"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:25,column:38},end:{line:25,column:63}}}):i))+"</span>"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:26,column:9},end:{line:26,column:34}}}):i))+'<span class="table-list__meta" data-form-region></span>'+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:27,column:57},end:{line:27,column:82}}}):i))+`&#8203;
  `+((s=c(l,"if").call(a,e!=null?c(e,"hasAttachments"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:28,column:2},end:{line:28,column:113}}}))!=null?s:"")+"&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:28,column:120},end:{line:28,column:145}}}):i))+`</td>
<td class="table-list__cell worklist-list__action-ts w-7-5">`+r((c(l,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"created_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:30,column:60},end:{line:30,column:103}}}))+`&#8203;</td>
<td class="table-list__cell worklist-list__action-ts w-7-5">`+r((c(l,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:31,column:60},end:{line:31,column:103}}}))+`&#8203;</td>
`},useData:!0}),dt=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(l,"formatMessage")||e&&a(e,"formatMessage")||i).call(s,(a(l,"intlGet")||e&&a(e,"intlGet")||i).call(s,"patients.worklist.actionViews.actionListTooltips",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:76}}}),{name:"formatMessage",hash:{team:e!=null?a(e,"owner"):e,title:e!=null?a(e,"worklistId"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:106}}}))},useData:!0}),mt=p.extend({tagName:"tr",template:w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="table-empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"worklist"))&&i(s,"actionViews"))&&i(s,"actionEmptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),wt=p.extend({className:"table-list__item work-list__item",tagName:"tr",template:ht,regions:{check:"[data-check-region]",state:"[data-state-region]",owner:"[data-owner-region]",dueDate:"[data-due-date-region]",dueTime:"[data-due-time-region]",form:"[data-form-region]",details:"[data-details-region]"},templateContext(){const t=this.model.getState();return{isOverdue:this.model.isOverdue(),state:t.get("name"),stateOptions:t.get("options"),flowName:this.flow&&this.flow.get("name"),patient:this.model.getPatient().attributes,owner:this.model.getOwner().get("name"),icon:this.model.hasOutreach()?"share-from-square":"file-lines",hasAttachments:this.model.hasAttachments()}},initialize({state:t}){this.state=t,this.flow=this.model.getFlow(),this.listenTo(t,{"select:multiple":this.showCheck,"select:none":this.showCheck})},modelEvents:{change:"render"},triggers:{click:"click","click .js-patient-sidebar-button":"click:patientSidebarButton","click .js-patient":"click:patient","click .js-no-click":"prevent-row-click"},onClick(){if(this.flow){m.trigger("event-router","flow:action",this.flow.id,this.model.id);return}m.trigger("event-router","patient:action",this.model.get("_patient"),this.model.id)},onClickPatient(){m.trigger("event-router","patient:dashboard",this.model.get("_patient"))},onRender(){this.showForm(),this.showDetailsTooltip();const t=this.canEdit;this.canEdit=!this.model.isFlowDone()&&this.model.canEdit(),this.showCheck(),this.showState(),this.showOwner(),this.showDueDate(),this.showDueTime(),t!==this.canEdit&&(this.canEdit||this.toggleSelected(!1),this.triggerMethod("change:canEdit"))},toggleSelected(t){this.$el.toggleClass("is-selected",t)},showCheck(){if(!this.canEdit)return;const t=this.state.isSelected(this.model);this.toggleSelected(t);const e=new ee({state:{isSelected:t}});this.listenTo(e,{select(l){this.triggerMethod("select",this,!!l.shiftKey)},"change:isSelected":this.toggleSelected}),this.showChildView("check",e)},showState(){if(!this.canEdit){const t=new te({model:this.model,isCompact:!0});this.showChildView("state",t);return}this.stateComponent=new Ie({stateId:this.model.get("_state"),isCompact:!0}),this.listenTo(this.stateComponent,"change:state",t=>{this.model.saveState(t)}),this.showChildView("state",this.stateComponent)},showOwner(){if(!this.canEdit){const l=new se({model:this.model,isCompact:!0});this.showChildView("owner",l);return}const t=this.model.isDone(),e=this.model.getProgram();this.ownerComponent=new ie({owner:this.model.getOwner(),workspaces:e.getUserWorkspaces(),isCompact:!0,state:{isDisabled:t}}),this.listenTo(this.ownerComponent,"change:owner",l=>{this.model.saveOwner(l)}),this.showChildView("owner",this.ownerComponent)},showDueDate(){if(!this.canEdit){const e=new Re({model:this.model});this.showChildView("dueDate",e);return}const t=this.model.isDone();this.dueDateComponent=new Le({date:this.model.get("due_date"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()}),this.listenTo(this.dueDateComponent,"change:due",e=>{this.model.saveDueDate(e)}),this.showChildView("dueDate",this.dueDateComponent)},showDueTime(){if(!this.canEdit){const e=new Ye({model:this.model});this.showChildView("dueTime",e);return}const t=this.model.isDone()||!this.model.get("due_date");this.dueTimeComponent=new We({time:this.model.get("due_time"),isCompact:!0,state:{isDisabled:t},isOverdue:this.model.isOverdue()}),this.listenTo(this.dueTimeComponent,"change:time",e=>{this.model.saveDueTime(e)}),this.showChildView("dueTime",this.dueTimeComponent)},showForm(){this.model.getForm()&&this.showChildView("form",new $e({model:this.model}))},showDetailsTooltip(){this.model.get("details")&&this.showChildView("details",new qe({model:this.model}))}}),gt=w.template({1:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return'<div class="worklist-list__flow-name">'+t.escapeExpression((s=(s=i(l,"flowName")||(e!=null?i(e,"flowName"):e))!=null?s:t.hooks.helperMissing,typeof s=="function"?s.call(e??(t.nullContext||{}),{name:"flowName",hash:{},data:n,loc:{start:{line:15,column:58},end:{line:15,column:72}}}):s))+"</div>"},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d=t.lambda,h="function",c=t.lookupProperty||function(f,C){if(Object.prototype.hasOwnProperty.call(f,C))return f[C]};return`<td class="table-list__cell table-list__item-check js-no-click"><span data-check-region></span></td>
<td class="table-list__cell w-15">
  <span class="worklist-list__patient-sidebar-icon">
    <button class="button-secondary--compact js-patient-sidebar-button">
      `+r((c(l,"far")||e&&c(e,"far")||o).call(a,"address-card",{name:"far",hash:{},data:n,loc:{start:{line:5,column:6},end:{line:5,column:28}}}))+`&#8203;
    </button>
  </span>
  <div class="worklist-list__patient-name js-patient">
    `+r(d((s=e!=null?c(e,"patient"):e)!=null?c(s,"first_name"):s,e))+" "+r(d((s=e!=null?c(e,"patient"):e)!=null?c(s,"last_name"):s,e))+`&#8203;
  </div>
</td>
<td class="table-list__cell w-30">
  <span class="worklist-list__flow-icon">`+r((c(l,"fas")||e&&c(e,"fas")||o).call(a,"folder",{name:"fas",hash:{},data:n,loc:{start:{line:13,column:41},end:{line:13,column:57}}}))+"</span>"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:13,column:64},end:{line:13,column:89}}}):i))+`<div class="worklist-list__name">
    `+((s=c(l,"if").call(a,e!=null?c(e,"flowName"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:15,column:4},end:{line:15,column:85}}}))!=null?s:"")+"&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:15,column:92},end:{line:15,column:117}}}):i))+r((i=(i=c(l,"name")||(e!=null?c(e,"name"):e))!=null?i:o,typeof i===h?i.call(a,{name:"name",hash:{},data:n,loc:{start:{line:16,column:4},end:{line:16,column:14}}}):i))+"&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:16,column:21},end:{line:16,column:46}}}):i))+`</div>
</td>
<td class="table-list__cell w-40">
  <span class="table-list__meta" data-state-region></span>&#8203;<span class="worklist-list__search-helper">`+r((i=(i=c(l,"state")||(e!=null?c(e,"state"):e))!=null?i:o,typeof i===h?i.call(a,{name:"state",hash:{},data:n,loc:{start:{line:20,column:108},end:{line:20,column:119}}}):i))+"</span>&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:20,column:133},end:{line:20,column:158}}}):i))+'<span class="table-list__meta" data-owner-region></span>&#8203;<span class="worklist-list__search-helper">'+r((i=(i=c(l,"owner")||(e!=null?c(e,"owner"):e))!=null?i:o,typeof i===h?i.call(a,{name:"owner",hash:{},data:n,loc:{start:{line:21,column:108},end:{line:21,column:119}}}):i))+"</span>&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:21,column:133},end:{line:21,column:158}}}):i))+'<progress class="progress-bar worklist-list__flow-progress" value='+r(d((s=e!=null?c(e,"_progress"):e)!=null?c(s,"complete"):s,e))+" max="+r(d((s=e!=null?c(e,"_progress"):e)!=null?c(s,"total"):s,e))+"></progress>&#8203;"+r((i=(i=c(l,"remove_whitespace")||(e!=null?c(e,"remove_whitespace"):e))!=null?i:o,typeof i===h?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:22,column:137},end:{line:22,column:162}}}):i))+`</td>
<td class="table-list__cell worklist-list__action-ts w-7-5">`+r((c(l,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"created_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:24,column:60},end:{line:24,column:103}}}))+`&#8203;</td>
<td class="table-list__cell worklist-list__action-ts w-7-5">`+r((c(l,"formatDateTime")||e&&c(e,"formatDateTime")||o).call(a,e!=null?c(e,"updated_at"):e,"TIME_OR_DAY",{name:"formatDateTime",hash:{},data:n,loc:{start:{line:25,column:60},end:{line:25,column:103}}}))+`&#8203;</td>
`},useData:!0}),pt=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(l,"formatMessage")||e&&a(e,"formatMessage")||i).call(s,(a(l,"intlGet")||e&&a(e,"intlGet")||i).call(s,"patients.worklist.flowViews.flowListTooltips",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:72}}}),{name:"formatMessage",hash:{team:e!=null?a(e,"owner"):e,title:e!=null?a(e,"worklistId"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:102}}}))},useData:!0}),ft=p.extend({tagName:"tr",template:w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="table-empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"worklist"))&&i(s,"flowViews"))&&i(s,"flowEmptyView"),e))+`</h2>
    </td>
  `},useData:!0})}),kt=p.extend({className:"table-list__item work-list__item",tagName:"tr",template:gt,regions:{check:"[data-check-region]",state:"[data-state-region]",owner:"[data-owner-region]"},templateContext(){return{patient:this.model.getPatient().attributes,owner:this.model.getOwner().get("name"),state:this.model.getState().get("name")}},modelEvents:{change:"render"},triggers:{click:"click","click .js-patient-sidebar-button":"click:patientSidebarButton","click .js-patient":"click:patient","click .js-no-click":"prevent-row-click"},initialize({state:t}){this.state=t,this.listenTo(t,{"select:multiple":this.showCheck,"select:none":this.showCheck})},onClick(){m.trigger("event-router","flow",this.model.id)},onClickPatient(){m.trigger("event-router","patient:dashboard",this.model.get("_patient"))},onRender(){const t=this.canEdit;this.canEdit=this.model.canEdit(),this.showCheck(),this.showState(),this.showOwner(),t!==this.canEdit&&(this.canEdit||this.toggleSelected(!1),this.triggerMethod("change:canEdit"))},toggleSelected(t){this.$el.toggleClass("is-selected",t)},showCheck(){if(!this.canEdit)return;const t=this.state.isSelected(this.model);this.toggleSelected(t);const e=new ee({state:{isSelected:t}});this.listenTo(e,{select(l){this.triggerMethod("select",this,!!l.shiftKey)},"change:isSelected":this.toggleSelected}),this.showChildView("check",e)},showState(){if(!this.model.isDone()||!this.canEdit){const e=new te({model:this.model,isCompact:!0});this.showChildView("state",e);return}const t=new He({stateId:this.model.get("_state"),isCompact:!0});this.listenTo(t,"change:state",e=>{this.model.saveState(e)}),this.showChildView("state",t)},showOwner(){if(!this.canEdit){const l=new se({model:this.model,isCompact:!0});this.showChildView("owner",l);return}const t=this.model.isDone(),e=this.model.getProgram();this.ownerComponent=new ie({owner:this.model.getOwner(),workspaces:e.getUserWorkspaces(),isCompact:!0,state:{isDisabled:t}}),this.listenTo(this.ownerComponent,"change:owner",l=>{this.model.saveOwner(l)}),this.showChildView("owner",this.ownerComponent)}}),yt=w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){return`<div class="list-page__header">
  <div class="flex list-page__title">
    <div data-title-region></div>
    <div class="worklist-list__toggle" data-toggle-region></div>
    <div class="u-margin--l-16" data-search-region></div>
  </div>
  <div class="list-page__filters flex">
    <div class="flex u-margin--r-24" data-select-all-region></div>
    <div class="flex flex-align-center w-100" data-filters-region></div>
    <div class="flex">
      <span class="worklist-list__count" data-count-region></span>
      <span class="u-margin--r-16 u-text--nowrap" data-date-filter-region></span>
      <span class="worklist-list__filter-sort" data-sort-region></span>
    </div>
  </div>
  <table class="worklist__header w-100 js-list-header" data-table-region></table>
</div>
<div class="flex-region list-page__list js-list" data-list-region></div>
`},useData:!0}),St=w.template({1:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"    "+t.escapeExpression(t.lambda((s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"worklist"))&&i(s,"tableHeaderTemplate"))&&i(s,"flowHeader"),e))+`
`},3:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"    "+t.escapeExpression(t.lambda((s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"worklist"))&&i(s,"tableHeaderTemplate"))&&i(s,"actionHeader"),e))+`
`},5:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"    "+t.escapeExpression(t.lambda((s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"worklist"))&&i(s,"tableHeaderTemplate"))&&i(s,"flowAttrHeader"),e))+`
`},7:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"    "+t.escapeExpression(t.lambda((s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"worklist"))&&i(s,"tableHeaderTemplate"))&&i(s,"actionAttrHeader"),e))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=t.lambda,a=t.escapeExpression,o=e??(t.nullContext||{}),r=t.lookupProperty||function(d,h){if(Object.prototype.hasOwnProperty.call(d,h))return d[h]};return`<td class="table-list__header table-list__item-check"></td>
<td class="table-list__header w-15">`+a(i((s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"worklist"))&&r(s,"tableHeaderTemplate"))&&r(s,"patientHeader"),e))+`</td>
<td class="table-list__header worklist-list__name-header">
`+((s=r(l,"if").call(o,e!=null?r(e,"isFlowList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(3,n,0),data:n,loc:{start:{line:4,column:2},end:{line:8,column:9}}}))!=null?s:"")+`</td>
<td class="table-list__header worklist-list__meta-header">
`+((s=r(l,"if").call(o,e!=null?r(e,"isFlowList"):e,{name:"if",hash:{},fn:t.program(5,n,0),inverse:t.program(7,n,0),data:n,loc:{start:{line:11,column:2},end:{line:15,column:9}}}))!=null?s:"")+`</td>
<td class="table-list__header w-7-5">`+a(i((s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"worklist"))&&r(s,"tableHeaderTemplate"))&&r(s,"createdHeader"),e))+`</td>
<td class="table-list__header w-7-5">`+a(i((s=(s=(s=(s=n&&r(n,"intl"))&&r(s,"patients"))&&r(s,"worklist"))&&r(s,"tableHeaderTemplate"))&&r(s,"updatedHeader"),e))+`</td>
`},useData:!0}),y=F.patients.worklist.worklistViews,Ct=p.extend({className:"flex-region",template:yt,regions:{dateFilter:"[data-date-filter-region]",filters:"[data-filters-region]",toggle:"[data-toggle-region]",sort:"[data-sort-region]",table:"[data-table-region]",list:{el:"[data-list-region]",regionClass:Be},selectAll:"[data-select-all-region]",title:{el:"[data-title-region]",replaceElement:!0},search:"[data-search-region]",count:"[data-count-region]"},childViewEvents:{"update:listDom":"fixWidth"},triggers:{"click @ui.select":"click:select"},ui:{listHeader:".js-list-header",list:".js-list",select:".js-select"},initialize(){const t=m.channel("user-activity");this.listenTo(t,"window:resize",this.fixWidth)},fixWidth(){if(!this.isRendered())return;const t=this.ui.listHeader.width(),e=this.ui.list.contents().width(),l=parseInt(this.ui.list.css("paddingRight"),10),u=t-e;this.ui.list.css({paddingRight:`${l-u}px`})}}),I=p.extend({tagName:"button",className:"button--checkbox",attributes(){if(this.getOption("isDisabled"))return{disabled:"disabled"}},triggers:{click:"click"},getTemplate(){return this.getOption("isSelectAll")?w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return t.escapeExpression((s(l,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-check",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0}):this.getOption("isSelectNone")||this.getOption("isDisabled")?w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return t.escapeExpression((s(l,"fal")||e&&s(e,"fal")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square",{name:"fal",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:16}}}))},useData:!0}):w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return t.escapeExpression((s(l,"fas")||e&&s(e,"fas")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"square-minus",{name:"fas",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0})}}),_t=p.extend({template:w.template({1:function(t,e,l,u,n){return"button--blue"},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i,a=e??(t.nullContext||{}),o=t.hooks.helperMissing,r=t.escapeExpression,d=t.lambda,h=t.lookupProperty||function(c,f){if(Object.prototype.hasOwnProperty.call(c,f))return c[f]};return`
    <button class="`+((s=h(l,"unless").call(a,e!=null?h(e,"isFlowList"):e,{name:"unless",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:19},end:{line:2,column:64}}}))!=null?s:"")+' button-filter button__group js-toggle-actions">'+r((h(l,"far")||e&&h(e,"far")||o).call(a,"file-lines",{name:"far",hash:{},data:n,loc:{start:{line:2,column:112},end:{line:2,column:132}}}))+"<span>"+r(d((s=(s=(s=(s=(s=n&&h(n,"intl"))&&h(s,"patients"))&&h(s,"worklist"))&&h(s,"worklistViews"))&&h(s,"typeToggleView"))&&h(s,"actionsButton"),e))+"</span></button>"+r((i=(i=h(l,"remove_whitespace")||(e!=null?h(e,"remove_whitespace"):e))!=null?i:o,typeof i=="function"?i.call(a,{name:"remove_whitespace",hash:{},data:n,loc:{start:{line:2,column:226},end:{line:2,column:251}}}):i))+'<button class="'+((s=h(l,"if").call(a,e!=null?h(e,"isFlowList"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:3,column:19},end:{line:3,column:56}}}))!=null?s:"")+' button-filter button__group js-toggle-flows">'+r((h(l,"fas")||e&&h(e,"fas")||o).call(a,"folder",{name:"fas",hash:{},data:n,loc:{start:{line:3,column:102},end:{line:3,column:118}}}))+"<span>"+r(d((s=(s=(s=(s=(s=n&&h(n,"intl"))&&h(s,"patients"))&&h(s,"worklist"))&&h(s,"worklistViews"))&&h(s,"typeToggleView"))&&h(s,"flowsButton"),e))+`</span></button>
  `},useData:!0}),templateContext(){return{isFlowList:this.getOption("isFlowList")}},triggers:{"click .js-toggle-actions":"click:toggleActions","click .js-toggle-flows":"click:toggleFlows"},ui:{buttons:"button"},onClickToggleActions(){this.triggerMethod("toggle:listType","actions")},onClickToggleFlows(){this.triggerMethod("toggle:listType","flows")}}),bt=p.extend({className:"u-margin--l-24 u-margin--r-16",template:w.template({1:function(t,e,l,u,n){return"button--blue"},3:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return t.escapeExpression((s(l,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),"xmark",{name:"far",hash:{},data:n,loc:{start:{line:3,column:90},end:{line:3,column:105}}}))},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=e??(t.nullContext||{}),a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return`
    <button class="button-filter-toggle `+((s=a(l,"if").call(i,e!=null?a(e,"noOwner"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:40},end:{line:2,column:74}}}))!=null?s:"")+`">
      `+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&a(n,"intl"))&&a(s,"patients"))&&a(s,"worklist"))&&a(s,"worklistViews"))&&a(s,"noOwnerToggleView"))&&a(s,"noOwner"),e))+((s=a(l,"if").call(i,e!=null?a(e,"noOwner"):e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n,loc:{start:{line:3,column:75},end:{line:3,column:112}}}))!=null?s:"")+`
    </button>
  `},useData:!0}),triggers:{click:"click"}}),Tt={"owned-by":["list"],"shared-by":["arrow-right-arrow-left"],"new-past-day":["angle-left","1"],"updated-past-three-days":["angle-left","3"],"done-last-thirty-days":["3","0"]},vt=p.extend({className:"u-text--nowrap",getTemplate(){return this.getOption("owner")?w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(l,"formatMessage")||e&&a(e,"formatMessage")||i).call(s,(a(l,"intlGet")||e&&a(e,"intlGet")||i).call(s,"patients.worklist.worklistViews.listTitleLabelView.listTitles",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:89}}}),{name:"formatMessage",hash:{owner:e!=null?a(e,"owner"):e,title:e!=null?a(e,"worklistId"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:120}}}))},useData:!0}):w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s=e??(t.nullContext||{}),i=t.hooks.helperMissing,a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return t.escapeExpression((a(l,"formatMessage")||e&&a(e,"formatMessage")||i).call(s,(a(l,"intlGet")||e&&a(e,"intlGet")||i).call(s,"patients.worklist.worklistViews.listTitleLabelView.listLabels",{name:"intlGet",hash:{},data:n,loc:{start:{line:1,column:16},end:{line:1,column:89}}}),{name:"formatMessage",hash:{title:e!=null?a(e,"worklistId"):e},data:n,loc:{start:{line:1,column:0},end:{line:1,column:108}}}))},useData:!0})},templateContext(){return{owner:this.getOption("owner"),worklistId:K(this.getOption("worklistId"))}}}),Dt=p.extend({regions:{label:"[data-label-region]",owner:"[data-owner-filter-region]",ownerToggle:"[data-owner-toggle-region]"},className:"flex list-page__title-filter",template:w.template({1:function(t,e,l,u,n){var s=t.lookupProperty||function(i,a){if(Object.prototype.hasOwnProperty.call(i,a))return i[a]};return"        "+t.escapeExpression((s(l,"far")||e&&s(e,"far")||t.hooks.helperMissing).call(e??(t.nullContext||{}),e,{name:"far",hash:{},data:n,loc:{start:{line:4,column:8},end:{line:4,column:20}}}))+`
`},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=e??(t.nullContext||{}),a=t.lookupProperty||function(o,r){if(Object.prototype.hasOwnProperty.call(o,r))return o[r]};return`
    <span class="list-page__title-icon">
`+((s=a(l,"each").call(i,e!=null?a(e,"icons"):e,{name:"each",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:3,column:6},end:{line:5,column:15}}}))!=null?s:"")+`    </span>
    <div data-label-region></div>
    <div data-owner-filter-region></div>
    <span class="list-page__header-icon js-title-info">`+t.escapeExpression((a(l,"far")||e&&a(e,"far")||t.hooks.helperMissing).call(i,"circle-info",{name:"far",hash:{},data:n,loc:{start:{line:9,column:55},end:{line:9,column:76}}}))+`</span>
    <div data-owner-toggle-region></div>
  `},useData:!0}),ui:{tooltip:".js-title-info"},templateContext(){return{owner:this.owner.get("name"),worklistId:K(this.model.id),icons:Tt[this.model.id]}},initialize(){const t=m.request("bootstrap","currentUser");this.canViewAssignedActions=t.can("app:worklist:clinician_filter"),this.shouldShowTeam=this.model.id!=="owned-by",this.shouldShowClinician=this.model.id!=="shared-by",this.shouldShowDroplist=this.shouldShowClinician&&this.canViewAssignedActions||this.shouldShowTeam,this.owner=this.model.getOwner()},onRender(){this.showLabel(),this.showOwnerDroplist(),this.showOwnerToggle();const t=this.model.isFlowType()?pt:dt;new x({message:b(t,this.templateContext()),uiView:this,ui:this.ui.tooltip,orientation:"vertical"})},showLabel(){const t=new vt({owner:this.shouldShowDroplist?null:this.owner.get("name"),worklistId:this.model.id});this.showChildView("label",t)},showOwnerDroplist(){if(!this.shouldShowDroplist)return;const t=y.titleOwnerDroplist,e=new ue({owner:this.owner,hasClinicians:this.shouldShowClinician&&this.canViewAssignedActions,hasTeams:this.shouldShowTeam,hasCurrentClinician:this.shouldShowClinician,headingText:this.shouldShowClinician?t.ownerFilterHeadingText:t.teamsFilterHeadingText,placeholderText:this.shouldShowClinician?t.ownerFilterPlaceholderText:t.teamsFilterPlaceholderText});this.listenTo(e,"change:owner",l=>{this.triggerMethod("change:owner",l)}),this.showChildView("owner",e)},showOwnerToggle(){if(this.shouldShowClinician||!this.canViewAssignedActions)return;const t=new bt({model:this.model});this.listenTo(t,"click",()=>{this.triggerMethod("toggle:noOwner")}),this.showChildView("ownerToggle",t)}}),Ot=p.extend({tagName:"button",className:"button--link-large",template:w.template({1:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return"("+t.escapeExpression((s=(s=i(l,"filtersCount")||(e!=null?i(e,"filtersCount"):e))!=null?s:t.hooks.helperMissing,typeof s=="function"?s.call(e??(t.nullContext||{}),{name:"filtersCount",hash:{},data:n,loc:{start:{line:1,column:133},end:{line:1,column:149}}}):s))+")"},compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=e??(t.nullContext||{}),a=t.escapeExpression,o=t.lookupProperty||function(r,d){if(Object.prototype.hasOwnProperty.call(r,d))return r[d]};return a((o(l,"far")||e&&o(e,"far")||t.hooks.helperMissing).call(i,"sliders",{name:"far",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:17}}}))+"<span>"+a(t.lambda((s=(s=(s=(s=(s=n&&o(n,"intl"))&&o(s,"patients"))&&o(s,"worklist"))&&o(s,"worklistViews"))&&o(s,"allFiltersButtonView"))&&o(s,"allFiltersButton"),e))+"</span> "+((s=o(l,"if").call(i,e!=null?o(e,"filtersCount"):e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:1,column:112},end:{line:1,column:157}}}))!=null?s:"")},useData:!0}),triggers:{click:"click"},modelEvents:{"change:filtersCount":"render"}}),Vt=p.extend({template:St,tagName:"tr",templateContext(){return{isFlowList:this.getOption("isFlowList")}}}),Mt=p.extend({tagName:"tr",template:w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=t.lookupProperty||function(a,o){if(Object.prototype.hasOwnProperty.call(a,o))return a[o]};return`
    <td class="table-empty-list">
      <h2>`+t.escapeExpression(t.lambda((s=(s=(s=(s=(s=n&&i(n,"intl"))&&i(s,"patients"))&&i(s,"worklist"))&&i(s,"worklistViews"))&&i(s,"emptyFindInListView"))&&i(s,"noResults"),e))+`</h2>
    </td>
  `},useData:!0})}),xt=$.extend({className:"table-list",tagName:"table",childView(){return this.isFlowList?kt:wt},emptyView(){return this.collection.length&&this.state.get("searchQuery")?Mt:this.isFlowList?ft:mt},childViewOptions(){return{state:this.state}},childViewTriggers:{render:"listItem:render","change:canEdit":"listItem:canEdit","click:patientSidebarButton":"click:patientSidebarButton",select:"select"},onListItemRender(t){t.searchString=t.$el.text()},onListItemCanEdit(){this.triggerMethod("change:canEdit")},initialize({state:t,editableCollection:e}){this.state=t,this.editableCollection=e,this.isFlowList=t.isFlowType(),this.onListItemCanEdit=be(this.onListItemCanEdit,60),this.listenTo(t,"change:searchQuery",this.searchList)},onAttach(){this.triggerMethod("update:listDom",this),this.searchList(null,this.state.get("searchQuery"))},onRenderChildren(){this.isAttached()&&(this.triggerMethod("update:listDom",this),this.triggerMethod("filtered",this.children.map("model")))},onSelect(t,e){this.state.selectRange(this.editableCollection,t.model,e)},searchList(t,e){if(!e){this.removeFilter();return}const l=je(e);this.setFilter(function({searchString:u}){return Te(l,function(n){return n.test(u)})})}}),Ft=Pe.extend({align:"right",popWidth:248,picklistOptions:{headingText:y.sortDroplist.headingText},viewOptions:{className:"button-filter",template:w.template({compiler:[8,">= 4.3.0"],main:function(t,e,l,u,n){var s,i=e??(t.nullContext||{}),a=t.hooks.helperMissing,o=t.escapeExpression,r=t.lookupProperty||function(d,h){if(Object.prototype.hasOwnProperty.call(d,h))return d[h]};return o((r(l,"far")||e&&r(e,"far")||a).call(i,"arrow-down-arrow-up",{name:"far",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:29}}}))+o((s=(s=r(l,"text")||(e!=null?r(e,"text"):e))!=null?s:a,typeof s=="function"?s.call(i,{name:"text",hash:{},data:n,loc:{start:{line:1,column:29},end:{line:1,column:37}}}):s))+o((r(l,"far")||e&&r(e,"far")||a).call(i,"angle-down",{name:"far",hash:{},data:n,loc:{start:{line:1,column:37},end:{line:1,column:57}}}))},useData:!0})}});function R(t,e,l){const u=t.getPatient().getField(e);return u?Me(u.get("value"),l):null}const Pt=k.Model.extend({defaults:{direction:"desc",field_key:"value",entities:["actions","flows"]},getComparator(){const t=this.get("comparator");if(t)return t.bind(this);const e=this.get("field_name"),l=this.get("field_key").split("."),u=this.get("direction"),n=this.get("sort_type");return(s,i)=>{const a=R(s.model,e,l),o=R(i.model,e,l);return n==="numeric"?Ae(u,a,o):_(u,a,o)}}}),Et=k.Collection.extend({model:Pt,getByType(t){const e=this.clone(),l=this.filter(u=>u.get("entities").includes(t));return e.reset(l),e},getInclude(){const t=ve(this.map("field_name"));return De(Oe(t),e=>`patient.patient-fields.${e}`).join(",")}}),L=function(t,e){return _(this.get("direction"),t.model.getPatient().getSortName(),e.model.getPatient().getSortName())},Y=function(t,e){return _(this.get("direction"),t.model.get("updated_at"),e.model.get("updated_at"))},W=function(t,e){return _(this.get("direction"),t.model.get("created_at"),e.model.get("created_at"))},At=[{id:"sortPatientAsc",text:y.sortPatientOptions.asc,direction:"asc",comparator:L},{id:"sortPatientDesc",text:y.sortPatientOptions.desc,comparator:L},{id:"sortDueAsc",text:y.sortDueOptions.asc,entities:["actions"],direction:"asc",comparator(t,e){const l=t.model.get("due_date"),u=e.model.get("due_date");return l===u?_(this.get("direction"),t.model.get("due_time"),e.model.get("due_time"),"24"):_(this.get("direction"),l,u)}},{id:"sortDueDesc",text:y.sortDueOptions.desc,entities:["actions"],comparator(t,e){const l=t.model.get("due_date"),u=e.model.get("due_date");return l===u?_(this.get("direction"),t.model.get("due_time"),e.model.get("due_time")):_(this.get("direction"),l,u)}},{id:"sortUpdateAsc",text:y.sortUpdateOptions.asc,direction:"asc",comparator:Y},{id:"sortUpdateDesc",text:y.sortUpdateOptions.desc,comparator:Y},{id:"sortCreatedAsc",text:y.sortCreatedOptions.asc,direction:"asc",comparator:W},{id:"sortCreatedDesc",text:y.sortCreatedOptions.desc,comparator:W}];function jt(t){const e=m.request("settings","get","sorting");return new Et(Ve(At,e)).getByType(t)}const Bt=O.extend({StateModel:N}),v=O.extend({StateModel:Ue,childApps:{filters:{AppClass:Bt,restartWithParent:!1},bulkEditActions:H,bulkEditFlows:Ne},stateEvents:{"change:listType change:clinicianId change:teamId change:noOwner":"restart","change:customFilters change:states change:flowStates":"restart","change:actionsDateFilters change:flowsDateFilters":"restart","change:actionsSortId change:flowsSortId":"onChangeStateSort","change:actionsSelected change:flowsSelected":"onChangeSelected","change:searchQuery":"onChangeSearchQuery"},startFiltersApp({setDefaults:t}={}){const e=this.startChildApp("filters",{state:this.getState().getFiltersState()}),l=e.getState();e.listenTo(l,"change",()=>{this.setState(l.getFiltersState())}),t&&l.setDefaultFilterStates(),this.setState(l.getFiltersState())},onChangeStateSort(){this.isRunning()&&this.getChildView("list").setComparator(this.getComparator())},onChangeSelected(){this.toggleBulkSelect()},onChangeSearchQuery(t){this.currentSearchQuery=t.get("searchQuery")},initListState(){const t=this.getState().getStore(this.worklistId);if(this.getState().setSearchQuery(this.currentSearchQuery),t){this.setState(t),this.getState().setClinicianId(this.clinicianId),this.startFiltersApp();return}this.setState({id:this.worklistId}),this.getState().setClinicianId(this.clinicianId),this.startFiltersApp({setDefaults:!0})},onBeforeStop(){this.collection=null,this.isRestarting()||this.stopChildApp("filters")},onBeforeStart({worklistId:t,clinicianId:e}){if(this.isRestarting()){this.getChildApp("filters").setState(this.getState().getFiltersState()),this.getRegion("count").empty(),this.showTypeViews(),this.getRegion("list").startPreloader();return}this.worklistId=t,this.clinicianId=e,this.initListState(),this.setView(new Ct),this.showDisabledSelectAll(),this.showSearchView(),this.showFiltersButtonView(),this.showTypeViews(),this.getRegion("list").startPreloader(),this.showView()},beforeStart(){const t=this.getState().getType(),e={filter:this.getState().getEntityFilter(),include:this.sortOptions.getInclude()};return t==="actions"&&(e.fields={flows:["name","state"]}),m.request("entities",`fetch:${t}:collection`,{data:e})},onStart(t,e){this.collection=e,this.filteredCollection=e.clone(),this.editableCollection=e.clone(),this.listenTo(this.filteredCollection,"reset",this.showCountView),this.showCountView(),this.listenTo(this.editableCollection,"reset",this.toggleBulkSelect),this.toggleBulkSelect(),this.showList()},showTypeViews(){this.showListTitle(),this.showTypeToggleView(),this.showDateFilter(),this.showSortDroplist(),this.showTableHeaders()},showList(){const t=new xt({collection:this.collection,editableCollection:this.editableCollection,state:this.getState(),viewComparator:this.getComparator()});this.listenTo(t,{filtered(e){this.filteredCollection.reset(e),this.editableCollection.reset(this._getListEditable(t))},"change:canEdit"(){this.editableCollection.reset(this._getListEditable(t))},"click:patientSidebarButton"({model:e}){const l=m.request("sidebar","start","patient",{patient:e.getPatient()});t.on("destroy",()=>l.stop())}}),this.showChildView("list",t)},_getListEditable(t){return t.children.reduce((e,{canEdit:l,model:u})=>(l&&e.push(u),e),[])},showFiltersButtonView(){const e=this.getChildApp("filters").getState(),l=new Ot({model:e});this.listenTo(l,"click",()=>{m.request("sidebar","start","filters",{filtersState:e})}),this.showChildView("filters",l)},toggleBulkSelect(){if(this.selected=this.getState().getSelected(this.editableCollection),this.showSelectAll(),this.selected.length){this.showBulkEditButtonView();return}this.showFiltersButtonView()},showBulkEditButtonView(){const t=new Q({isFlowType:this.getState().isFlowType(),collection:this.selected});this.listenTo(t,{"click:cancel":this.onClickBulkCancel,"click:edit":this.onClickBulkEdit}),this.showChildView("filters",t)},onClickBulkCancel(){this.getState().clearSelected()},onClickBulkEdit(){const t=this.getState().isFlowType()?"bulkEditFlows":"bulkEditActions",e=this.startChildApp(t,{state:{collection:this.selected}});this.listenTo(e,{applyOwner(l){this.selected.applyOwner(l)},save(l){const u=this.selected.length;this.selected.save(l).then(()=>{this.showUpdateSuccess(u),e.stop(),this.getState().clearSelected()}).catch(()=>{m.request("alert","show:error",F.patients.worklist.worklistApp.bulkEditFailure),this.getState().clearSelected(),this.restart()})},delete(){const l=this.selected.length;this.selected.destroy().then(()=>{this.showDeleteSuccess(l),e.stop(),this.getState().clearSelected()})}})},showDeleteSuccess(t){if(this.getState().isFlowType()){m.request("alert","show:success",b(he,{itemCount:t}));return}m.request("alert","show:success",b(G,{itemCount:t}))},showUpdateSuccess(t){if(this.getState().isFlowType()){m.request("alert","show:success",b(de,{itemCount:t}));return}m.request("alert","show:success",b(U,{itemCount:t}))},showDisabledSelectAll(){this.showChildView("selectAll",new I({isDisabled:!0}))},showSelectAll(){if(!this.editableCollection.length){this.showDisabledSelectAll();return}const t=new I({isSelectAll:this.selected.length===this.editableCollection.length,isSelectNone:!this.selected.length});this.listenTo(t,"click",this.onClickBulkSelect),this.showChildView("selectAll",t)},onClickBulkSelect(){if(this.selected.length===this.editableCollection.length){this.getState().clearSelected();return}this.getState().selectMultiple(this.editableCollection.map("id"))},getSortOption(t){const e=this.sortOptions.get(t);if(!e){const u=this.getState().defaults()[`${this.getState().getType()}SortId`];return this.sortOptions.get(u)}return e},getComparator(){const t=this.getState().getSort();return this.getSortOption(t).getComparator()},showCountView(){const t=new z({isFlowList:this.getState().isFlowType(),collection:this.collection,filteredCollection:this.filteredCollection});this.showChildView("count",t)},showDateFilter(){if(this.getState().getStaticDateFilter())return;const t=this.getState().isFlowType()?["created_at","updated_at"]:["created_at","updated_at","due_date"],e=new ne({dateTypes:t,state:this.getState().getDateFilters()});this.listenTo(e.getState(),"change",({attributes:l})=>{this.getState().setDateFilters(l)}),this.showChildView("dateFilter",e)},showSortDroplist(){this.sortOptions=jt(this.getState().getType());const t=new Ft({collection:this.sortOptions,state:{selected:this.getSortOption(this.getState().getSort())}});this.listenTo(t.getState(),"change:selected",(e,l)=>{this.getState().setSort(l.id)}),this.showChildView("sort",t)},showTableHeaders(){const t=new Vt({isFlowList:this.getState().isFlowType()});this.showChildView("table",t)},showListTitle(){const t=new Dt({model:this.getState()});this.listenTo(t,{"change:owner"({id:e,type:l}){l==="teams"?this.setState({teamId:e,clinicianId:null}):this.setState({clinicianId:e,teamId:null})},"toggle:noOwner"(){this.toggleState("noOwner")}}),this.showChildView("title",t)},showTypeToggleView(){const t=new _t({isFlowList:this.getState().isFlowType()});this.listenTo(t,"toggle:listType",e=>{this.getState().setType(e)}),this.showChildView("toggle",t)},showSearchView(){const t=new X({state:{query:this.getState("searchQuery")}});this.listenTo(t.getState(),"change:query",(e,l)=>{this.getState().setSearchQuery(l)}),this.showChildView("search",t)}}),It=new k.Collection(V),Rt="v6",ae=k.Model.extend({defaults(){return{clinicianId:this.currentClinician.id,dateFilters:{dateType:"due_date",selectedDate:null,selectedMonth:null,selectedWeek:null,relativeDate:null},lastSelectedIndex:null,actionsSelected:{},searchQuery:""}},getFiltersState(){return{customFilters:this.get("customFilters"),states:this.get("states"),flowStates:this.get("flowStates"),listType:this.getType()}},preinitialize(){this.currentClinician=m.request("bootstrap","currentUser"),this.currentWorkspace=m.request("workspace","current")},initialize(){this.on("change",this.onChange),this.listenTo(m.channel("event-router"),"unknownError",this.removeStore)},getStoreKey(){return`schedule_${this.currentClinician.id}_${this.currentWorkspace.id}-${Rt}`},getStore(){return T.get(this.getStoreKey())},removeStore(){T.remove(this.getStoreKey())},onChange(){T.set(this.getStoreKey(),J(this.attributes,"filtersCount","lastSelectedIndex","searchQuery"))},setSearchQuery(t=""){return this.set({searchQuery:t.length>2?t:"",lastSelectedIndex:null})},getType(){return"actions"},setDateFilters(t){this.set("dateFilters",M(t))},getDateFilters(){return M(this.get("dateFilters"))},formatDateRange(t,e){const l="YYYY-MM-DD";return`${g(t).startOf(e).format(l)},${g(t).endOf(e).format(l)}`},getDateRange({selectedDate:t,selectedMonth:e,selectedWeek:l,relativeDate:u}){if(t)return this.formatDateRange(t,"day");if(e)return this.formatDateRange(e,"month");if(l)return this.formatDateRange(l,"week");u=u||"thismonth";const{prev:n,unit:s}=It.get(u).pick("prev","unit"),i=g().subtract(n,s);return this.formatDateRange(i,s)},getEntityDateFilter(){const t=this.getDateFilters();return t.relativeDate==="alltime"?{}:{due_date:this.getDateRange(t)}},getEntityStatesFilter(){return{state:this.get("states").join()||D,"flow.state":this.get("flowStates").join()||D}},getOwner(){const t=this.get("clinicianId");return m.request("entities","clinicians:model",t)},getEntityOwnerFilter(){return{clinician:this.get("clinicianId")}},getEntityCustomFilter(){const t=this.get("customFilters");return Z(t,(e,l,u)=>(l!==null&&(e[`@${u}`]=l),e),{})},getEntityFilter(){const t={};return S(t,this.getEntityDateFilter()),S(t,this.getEntityStatesFilter()),S(t,this.getEntityOwnerFilter()),S(t,this.getEntityCustomFilter()),t}});S(ae.prototype,q);const Lt=ae,Yt=O.extend({StateModel:N}),Wt=O.extend({StateModel:Lt,childApps:{filters:{AppClass:Yt,restartWithParent:!1},bulkEditActions:H},stateEvents:{"change:clinicianId change:dateFilters change:customFilters change:states change:flowStates":"restart","change:actionsSelected":"onChangeSelected","change:searchQuery":"onChangeSearchQuery"},startFiltersApp({setDefaults:t}={}){const e=this.startChildApp("filters",{state:this.getState().getFiltersState()}),l=e.getState();e.listenTo(l,"change",()=>{this.setState(l.getFiltersState())}),t&&l.setDefaultFilterStates(),this.setState(l.getFiltersState())},onChangeSelected(){this.toggleBulkSelect()},onChangeSearchQuery(t){this.currentSearchQuery=t.get("searchQuery")},initListState(){const t=this.getState().getStore();if(this.getState().setSearchQuery(this.currentSearchQuery),t){this.setState(t),this.startFiltersApp();return}const e=m.request("bootstrap","currentUser");this.setState({id:`schedule_${e.id}`}),this.startFiltersApp({setDefaults:!0})},onBeforeStop(){this.collection=null,this.isRestarting()||this.stopChildApp("filters")},onBeforeStart(){if(this.isRestarting()){this.getChildApp("filters").setState(this.getState().getFiltersState()),this.getRegion("count").empty(),this.getRegion("list").startPreloader();return}this.initListState(),this.setView(new me({isReduced:this.getState("isReduced")})),this.showDisabledSelectAll(),this.showSearchView(),this.showTableHeaders(),this.showScheduleTitle(),this.showDateFilter(),this.showFiltersButtonView(),this.getRegion("list").startPreloader(),this.showView()},beforeStart(){const t=this.getState().getEntityFilter(),e={flows:["name","state"]};return m.request("entities","fetch:actions:collection",{data:{filter:t,fields:e}})},onStart(t,e){this.collection=e,this.filteredCollection=e.clone(),this.editableCollection=e.clone(),this.listenTo(this.filteredCollection,"reset",this.showCountView),this.showCountView(),this.listenTo(this.editableCollection,"reset",this.toggleBulkSelect),this.toggleBulkSelect(),this.showList()},showList(){const t=new we({collection:this.collection.groupByDate(),editableCollection:this.editableCollection,state:this.getState()});this.listenTo(t,{filtered(e){this.filteredCollection.reset(e),this.editableCollection.reset(this._getListEditable(t))},"change:canEdit"(){this.editableCollection.reset(this._getListEditable(t))}}),this.showChildView("list",t)},_getListEditable(t){return t.children.reduce((e,l)=>l.children.reduce((u,{canEdit:n,model:s})=>(n&&u.push(s),u),e),[])},showFiltersButtonView(){const e=this.getChildApp("filters").getState(),l=new ge({model:e});this.listenTo(l,"click",()=>{m.request("sidebar","start","filters",{filtersState:e})}),this.showChildView("filters",l)},toggleBulkSelect(){if(this.selected=this.getState().getSelected(this.editableCollection),this.showSelectAll(),this.selected.length){this.showBulkEditButtonView();return}this.showFiltersButtonView()},showBulkEditButtonView(){const t=new Q({collection:this.selected});this.listenTo(t,{"click:cancel":this.onClickBulkCancel,"click:edit":this.onClickBulkEdit}),this.showChildView("filters",t)},onClickBulkCancel(){this.getState().clearSelected()},onClickBulkEdit(){const t=this.startChildApp("bulkEditActions",{state:{collection:this.selected}});this.listenTo(t,{save(e){const l=this.selected.length;this.selected.save(e).then(()=>{if(m.request("alert","show:success",b(U,{itemCount:l})),t.stop(),e.due_date&&this.selected.some(u=>u.changed.due_date)){this.getState().clearSelected(),this.restart();return}this.getState().clearSelected()}).catch(()=>{m.request("alert","show:error",F.patients.schedule.scheduleApp.bulkEditFailure),this.getState().clearSelected(),this.restart()})},delete(){const e=this.selected.length;this.selected.destroy().then(()=>{m.request("alert","show:success",b(G,{itemCount:e})),t.stop(),this.getState().clearSelected(),this.showList()})}})},showDisabledSelectAll(){this.showChildView("selectAll",new P({isDisabled:!0}))},showSelectAll(){if(!this.editableCollection.length){this.showDisabledSelectAll();return}const t=new P({isSelectAll:this.selected.length===this.editableCollection.length,isSelectNone:!this.selected.length});this.listenTo(t,"click",this.onClickBulkSelect),this.showChildView("selectAll",t)},onClickBulkSelect(){if(this.selected.length===this.editableCollection.length){this.getState().clearSelected();return}this.getState().selectMultiple(this.editableCollection.map("id"))},showCountView(){const t=new z({collection:this.collection,filteredCollection:this.filteredCollection});this.showChildView("count",t)},showDateFilter(){const t=["due_date"],e=new ne({dateTypes:t,state:this.getState().getDateFilters()});this.listenTo(e.getState(),"change",({attributes:l})=>{this.getState().setDateFilters(l)}),this.showChildView("dateFilter",e)},showTableHeaders(){const t=new pe;this.showChildView("table",t)},showScheduleTitle(){const t=new fe({model:this.getState()});this.listenTo(t,"change:owner",({id:e})=>{this.setState({clinicianId:e})}),this.showChildView("title",t)},showSearchView(){const t=new X({state:{query:this.getState("searchQuery")}});this.listenTo(t.getState(),"change:query",(e,l)=>{this.getState().setSearchQuery(l)}),this.showChildView("search",t)}}),is=oe.extend({routerAppName:"PatientsApp",childApps:{flow:ke,patient:ye,ownedBy:v,forTeam:v,newPastDay:v,pastThree:v,lastThirty:v,schedule:Wt},eventRoutes:{worklist:{action:"showPatientsWorklist",route:"worklist/:id",isList:!0},"patient:dashboard":{action:"showPatient",route:"patient/dashboard/:id"},"patient:archive":{action:"showPatient",route:"patient/archive/:id"},"patient:action":{action:"showPatient",route:"patient/:id/action/:id"},flow:{action:"showFlow",route:"flow/:id"},"flow:action":{action:"showFlow",route:"flow/:id/action/:id"},schedule:{action:"showSchedule",route:"schedule",isList:!0}},showPatient(t){this.startRoute("patient",{patientId:t})},showPatientsWorklist(t,e){const l={"owned-by":"ownedBy","shared-by":"forTeam","new-past-day":"newPastDay","updated-past-three-days":"pastThree","done-last-thirty-days":"lastThirty"};if(!l[t]){m.trigger("event-router","notFound");return}this.startCurrent(l[t],{worklistId:t,clinicianId:e})},showFlow(t){this.startRoute("flow",{flowId:t})},showSchedule(){this.startCurrent("schedule")}});export{is as default};
